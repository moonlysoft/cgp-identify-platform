(function(E,m){typeof exports=="object"&&typeof module!="undefined"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(E=typeof globalThis!="undefined"?globalThis:E||self,m(E["@nhost/core"]={}))})(this,function(E){"use strict";var Ia=Object.defineProperty,Pa=Object.defineProperties;var Na=Object.getOwnPropertyDescriptors;var wt=Object.getOwnPropertySymbols;var xn=Object.prototype.hasOwnProperty,_n=Object.prototype.propertyIsEnumerable;var An=(E,m,L)=>m in E?Ia(E,m,{enumerable:!0,configurable:!0,writable:!0,value:L}):E[m]=L,G=(E,m)=>{for(var L in m||(m={}))xn.call(m,L)&&An(E,L,m[L]);if(wt)for(var L of wt(m))_n.call(m,L)&&An(E,L,m[L]);return E},ee=(E,m)=>Pa(E,Na(m));var St=(E,m)=>{var L={};for(var R in E)xn.call(E,R)&&m.indexOf(R)<0&&(L[R]=E[R]);if(E!=null&&wt)for(var R of wt(E))m.indexOf(R)<0&&_n.call(E,R)&&(L[R]=E[R]);return L};/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var m=function(){return m=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},m.apply(this,arguments)};function L(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function R(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s}function D(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var I;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(I||(I={}));var Pe;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(Pe||(Pe={}));var Tt=I.Start,Rt=I.Stop,He=I.Raise,Ge=I.Send,ar=I.Cancel,In=I.NullEvent,bt=I.Assign;I.After,I.DoneState;var or=I.Log,Pn=I.Init,Ot=I.Invoke;I.ErrorExecution;var ur=I.ErrorPlatform,Nn=I.ErrorCustom,cr=I.Update,Cn=I.Choose,kn=I.Pure,lr=".",fr={},At="xstate.guard",Dn="",Ne=!0,We;function xt(t,e,r){r===void 0&&(r=lr);var n=Ce(t,r),i=Ce(e,r);return x(i)?x(n)?i===n:!1:x(n)?n in i:Object.keys(n).every(function(s){return s in i?xt(n[s],i[s]):!1})}function dr(t){try{return x(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function _t(t,e){try{return ve(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function Un(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function Ce(t,e){if(Un(t))return t.value;if(ve(t))return ze(t);if(typeof t!="string")return t;var r=_t(t,e);return ze(r)}function ze(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function ke(t,e){for(var r={},n=Object.keys(t),i=0;i<n.length;i++){var s=n[i];r[s]=e(t[s],s,t,i)}return r}function hr(t,e,r){var n,i,s={};try{for(var a=R(Object.keys(t)),o=a.next();!o.done;o=a.next()){var c=o.value,f=t[c];!r(f)||(s[c]=e(f,c,t))}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}var Mn=function(t){return function(e){var r,n,i=e;try{for(var s=R(t),a=s.next();!a.done;a=s.next()){var o=a.value;i=i[o]}}catch(c){r={error:c}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}};function Ln(t,e){return function(r){var n,i,s=r;try{for(var a=R(t),o=a.next();!o.done;o=a.next()){var c=o.value;s=s[e][c]}}catch(f){n={error:f}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}}function Ye(t){if(!t)return[[]];if(x(t))return[[t]];var e=C(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:Ye(t[r]).map(function(i){return[r].concat(i)})}));return e}function C(t){var e;return(e=[]).concat.apply(e,D([],_(t),!1))}function vr(t){return ve(t)?t:[t]}function J(t){return t===void 0?[]:vr(t)}function Je(t,e,r){var n,i;if(P(t))return t(e,r.data);var s={};try{for(var a=R(Object.keys(t)),o=a.next();!o.done;o=a.next()){var c=o.value,f=t[c];P(f)?s[c]=f(e,r.data):s[c]=f}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}function jn(t){return/^(done|error)\./.test(t)}function pr(t){return!!(t instanceof Promise||t!==null&&(P(t)||typeof t=="object")&&P(t.then))}function $n(t){return t!==null&&typeof t=="object"&&"transition"in t&&typeof t.transition=="function"}function mr(t,e){var r,n,i=_([[],[]],2),s=i[0],a=i[1];try{for(var o=R(t),c=o.next();!c.done;c=o.next()){var f=c.value;e(f)?s.push(f):a.push(f)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return[s,a]}function yr(t,e){return ke(t.states,function(r,n){if(!!r){var i=(x(e)?void 0:e[n])||(r?r.current:void 0);if(!!i)return{current:i,states:yr(r,i)}}})}function Fn(t,e){return{current:e,states:yr(t,e)}}function Er(t,e,r,n){var i=t&&r.reduce(function(s,a){var o,c,f=a.assignment,u={state:n,action:a,_event:e},p={};if(P(f))p=f(s,e.data,u);else try{for(var d=R(Object.keys(f)),l=d.next();!l.done;l=d.next()){var h=l.value,v=f[h];p[h]=P(v)?v(s,e.data,u):v}}catch(y){o={error:y}}finally{try{l&&!l.done&&(c=d.return)&&c.call(d)}finally{if(o)throw o.error}}return Object.assign({},s,p)},t);return i}var De=function(){};function ve(t){return Array.isArray(t)}function P(t){return typeof t=="function"}function x(t){return typeof t=="string"}function gr(t,e){if(!!t)return x(t)?{type:At,name:t,predicate:e?e[t]:void 0}:P(t)?{type:At,name:t.name,predicate:t}:t}function Bn(t){try{return"subscribe"in t&&P(t.subscribe)}catch{return!1}}var ae=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();We={},We[ae]=function(){return this},We[Symbol.observable]=function(){return this};function le(t){return!!t&&"__xstatenode"in t}function Vn(t){return!!t&&typeof t.send=="function"}function It(t,e){return x(t)||typeof t=="number"?m({type:t},e):t}function V(t,e){if(!x(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=It(t);return m({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function pe(t,e){var r=vr(e).map(function(n){return typeof n=="undefined"||typeof n=="string"||le(n)?{target:n,event:t}:m(m({},n),{event:t})});return r}function qn(t){if(!(t===void 0||t===Dn))return J(t)}function wr(t,e,r,n,i){var s=t.options.guards,a={state:i,cond:e,_event:n};if(e.type===At)return((s==null?void 0:s[e.name])||e.predicate)(r,n.data,a);var o=s==null?void 0:s[e.type];if(!o)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return o(r,n.data,a)}function Sr(t){return typeof t=="string"?{type:t}:t}function Pt(t,e,r){if(typeof t=="object")return t;var n=function(){};return{next:t,error:e||n,complete:r||n}}function Xe(t,e){return"".concat(t,":invocation[").concat(e,"]")}var Qe=V({type:Pn});function Nt(t,e){return e&&e[t]||void 0}function Ue(t,e){var r;if(x(t)||typeof t=="number"){var n=Nt(t,e);P(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(P(t))r={type:t.name||t.toString(),exec:t};else{var n=Nt(t.type,e);if(P(n))r=m(m({},t),{exec:n});else if(n){var i=n.type||t.type;r=m(m(m({},n),t),{type:i})}else r=t}return r}var Ze=function(t,e){if(!t)return[];var r=ve(t)?t:[t];return r.map(function(n){return Ue(n,e)})};function Ct(t){var e=Ue(t);return m(m({id:x(t)?t:e.id},e),{type:e.type})}function Kn(t){return x(t)?{type:He,event:t}:kt(t,{to:Pe.Internal})}function Hn(t){return{type:He,_event:V(t.event)}}function kt(t,e){return{to:e?e.to:void 0,type:Ge,event:P(t)?t:It(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:P(t)?t.name:dr(t)}}function Gn(t,e,r,n){var i={_event:r},s=V(P(t.event)?t.event(e,r.data,i):t.event),a;if(x(t.delay)){var o=n&&n[t.delay];a=P(o)?o(e,r.data,i):o}else a=P(t.delay)?t.delay(e,r.data,i):t.delay;var c=P(t.to)?t.to(e,r.data,i):t.to;return m(m({},t),{to:c,_event:s,event:s.data,delay:a})}var Wn=function(t,e,r){return m(m({},t),{value:x(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},zn=function(t){return{type:ar,sendId:t}};function Yn(t){var e=Ct(t);return{type:I.Start,activity:e,exec:void 0}}function Jn(t){var e=P(t)?t:Ct(t);return{type:I.Stop,activity:e,exec:void 0}}function Xn(t,e,r){var n=P(t.activity)?t.activity(e,r.data):t.activity,i=typeof n=="string"?{id:n}:n,s={type:I.Stop,activity:i};return s}var Qn=function(t){return{type:bt,assignment:t}};function Zn(t,e){var r=e?"#".concat(e):"";return"".concat(I.After,"(").concat(t,")").concat(r)}function et(t,e){var r="".concat(I.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function tt(t,e){var r="".concat(I.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Me(t,e){var r="".concat(I.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Dt(t,e,r,n,i,s){s===void 0&&(s=!1);var a=_(s?[[],i]:mr(i,function(d){return d.type===bt}),2),o=a[0],c=a[1],f=o.length?Er(r,n,o,e):r,u=s?[r]:void 0,p=C(c.map(function(d){var l;switch(d.type){case He:return Hn(d);case Ge:var h=Gn(d,f,n,t.options.delays);return h;case or:return Wn(d,f,n);case Cn:{var v=d,y=(l=v.conds.find(function(k){var B=gr(k.cond,t.options.guards);return!B||wr(t,B,f,n,e)}))===null||l===void 0?void 0:l.actions;if(!y)return[];var w=_(Dt(t,e,f,n,Ze(J(y),t.options.actions),s),2),g=w[0],S=w[1];return f=S,u==null||u.push(f),g}case kn:{var y=d.get(f,n.data);if(!y)return[];var N=_(Dt(t,e,f,n,Ze(J(y),t.options.actions),s),2),A=N[0],M=N[1];return f=M,u==null||u.push(f),A}case Rt:return Xn(d,f,n);case bt:{f=Er(f,n,[d],e),u==null||u.push(f);break}default:var b=Ue(d,t.options.actions),T=b.exec;if(T&&u){var O=u.length-1;b=m(m({},b),{exec:function(k){for(var B=[],z=1;z<arguments.length;z++)B[z-1]=arguments[z];T.apply(void 0,D([u[O]],_(B),!1))}})}return b}}).filter(function(d){return!!d}));return[p,f]}var Le=function(t,e){var r=e(t);return r};function Tr(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[ae]=function(){return this},e}function ei(t,e,r,n){var i,s=Sr(t.src),a=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[s.type],o=t.data?Je(t.data,r,n):void 0,c=a?ti(a,t.id,o):Tr(t.id);return c.meta=t,c}function ti(t,e,r){var n=Tr(e);if(n.deferred=!0,le(t)){var i=n.state=Le(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return i}}return n}function ri(t){try{return typeof t.send=="function"}catch{return!1}}function ni(t){return ri(t)&&"id"in t}function ii(t){var e;return m((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[ae]=function(){return this},e),t)}var rt=function(t){return t.type==="atomic"||t.type==="final"};function me(t){return Object.keys(t.states).map(function(e){return t.states[e]}).filter(function(e){return e.type!=="history"})}function Rr(t){var e=[t];return rt(t)?e:e.concat(C(me(t).map(Rr)))}function ye(t,e){var r,n,i,s,a,o,c,f,u=new Set(t),p=Ut(u),d=new Set(e);try{for(var l=R(d),h=l.next();!h.done;h=l.next())for(var v=h.value,y=v.parent;y&&!d.has(y);)d.add(y),y=y.parent}catch(O){r={error:O}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var w=Ut(d);try{for(var g=R(d),S=g.next();!S.done;S=g.next()){var v=S.value;if(v.type==="compound"&&(!w.get(v)||!w.get(v).length))p.get(v)?p.get(v).forEach(function(k){return d.add(k)}):v.initialStateNodes.forEach(function(k){return d.add(k)});else if(v.type==="parallel")try{for(var N=(a=void 0,R(me(v))),A=N.next();!A.done;A=N.next()){var M=A.value;d.has(M)||(d.add(M),p.get(M)?p.get(M).forEach(function(k){return d.add(k)}):M.initialStateNodes.forEach(function(k){return d.add(k)}))}}catch(k){a={error:k}}finally{try{A&&!A.done&&(o=N.return)&&o.call(N)}finally{if(a)throw a.error}}}}catch(O){i={error:O}}finally{try{S&&!S.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}try{for(var b=R(d),T=b.next();!T.done;T=b.next())for(var v=T.value,y=v.parent;y&&!d.has(y);)d.add(y),y=y.parent}catch(O){c={error:O}}finally{try{T&&!T.done&&(f=b.return)&&f.call(b)}finally{if(c)throw c.error}}return d}function br(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(rt(n))return n.key}else return{}}var i={};return r.forEach(function(s){i[s.key]=br(s,e)}),i}function Ut(t){var e,r,n=new Map;try{for(var i=R(t),s=i.next();!s.done;s=i.next()){var a=s.value;n.has(a)||n.set(a,[]),a.parent&&(n.has(a.parent)||n.set(a.parent,[]),n.get(a.parent).push(a))}}catch(o){e={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}function si(t,e){var r=ye([t],e);return br(t,Ut(r))}function nt(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function ai(t){return D([],_(new Set(C(D([],_(t.map(function(e){return e.ownEvents})),!1)))),!1)}function je(t,e){return e.type==="compound"?me(e).some(function(r){return r.type==="final"&&nt(t,r)}):e.type==="parallel"?me(e).every(function(r){return je(t,r)}):!1}function oi(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function Or(t){return new Set(C(t.map(function(e){return e.tags})))}function Ar(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(x(t)||x(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(i){return Ar(t[i],e[i])})}function ui(t){return typeof t!="object"||t===null?!1:"value"in t&&"_event"in t}function ci(t,e){var r=t.exec,n=m(m({},t),{exec:r!==void 0?function(){return r(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0});return n}var ne=function(){function t(e){var r=this,n;this.actions=[],this.activities=fr,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||fr,this.meta=oi(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return ai(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=Qe;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=Qe;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),x(e))return[e];var i=Object.keys(e);return i.concat.apply(i,D([],_(i.map(function(s){return n.toStrings(e[s],r).map(function(a){return s+r+a})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=L(e,["configuration","transitions","tags","machine"]);return m(m({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return xt(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;De(!!this.machine);var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),li={deferEvents:!1},xr=function(){function t(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=m(m({},li),e)}return t.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},t.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},t.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(r){throw this.clear(),r}finally{this.processingEvent=!1}},t}(),Mt=new Map,fi=0,it={bookId:function(){return"x:".concat(fi++)},register:function(t,e){return Mt.set(t,e),t},get:function(t){return Mt.get(t)},free:function(t){Mt.delete(t)}};function Lt(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function di(){var t=Lt();if(t&&"__xstate__"in t)return t.__xstate__}function hi(t){if(!!Lt()){var e=di();e&&e.register(t)}}function vi(t,e){e===void 0&&(e={});var r=t.initialState,n=new Set,i=[],s=!1,a=function(){if(!s){for(s=!0;i.length>0;){var f=i.shift();r=t.transition(r,f,c),n.forEach(function(u){return u.next(r)})}s=!1}},o=ii({id:e.id,send:function(f){i.push(f),a()},getSnapshot:function(){return r},subscribe:function(f,u,p){var d=Pt(f,u,p);return n.add(d),d.next(r),{unsubscribe:function(){n.delete(d)}}}}),c={parent:e.parent,self:o,id:e.id||"anonymous",observers:n};return r=t.start?t.start(c):r,o}var pi={sync:!1,autoForward:!1},q;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(q||(q={}));var mi=function(){function t(e,r){var n=this;r===void 0&&(r=t.defaultOptions),this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=q.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(u,p){if(ve(u))return n.batch(u),n.state;var d=V(It(u,p));if(n.status===q.Stopped)return n.state;if(n.status!==q.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(d.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(d.data)));return n.scheduler.schedule(function(){n.forward(d);var l=n.nextState(d);n.update(l,d)}),n._state},this.sendTo=function(u,p){var d=n.parent&&(p===Pe.Parent||n.parent.id===p),l=d?n.parent:x(p)?n.children.get(p)||it.get(p):Vn(p)?p:void 0;if(!l){if(!d)throw new Error("Unable to send event to child '".concat(p,"' from service '").concat(n.id,"'."));return}"machine"in l?l.send(m(m({},u),{name:u.name===Nn?"".concat(Me(n.id)):u.name,origin:n.sessionId})):l.send(u.data)};var i=m(m({},t.defaultOptions),r),s=i.clock,a=i.logger,o=i.parent,c=i.id,f=c!==void 0?c:e.id;this.id=f,this.logger=a,this.clock=s,this.parent=o,this.options=i,this.scheduler=new xr({deferEvents:this.options.deferEvents}),this.sessionId=it.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:Le(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(e,r){var n,i;try{for(var s=R(e.actions),a=s.next();!a.done;a=s.next()){var o=a.value;this.exec(o,e,r)}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.update=function(e,r){var n,i,s,a,o,c,f,u,p=this;if(e._sessionid=this.sessionId,this._state=e,this.options.execute&&this.execute(this.state),this.children.forEach(function(O){p.state.children[O.id]=O}),this.devTools&&this.devTools.send(r.data,e),e.event)try{for(var d=R(this.eventListeners),l=d.next();!l.done;l=d.next()){var h=l.value;h(e.event)}}catch(O){n={error:O}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}try{for(var v=R(this.listeners),y=v.next();!y.done;y=v.next()){var h=y.value;h(e,e.event)}}catch(O){s={error:O}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(s)throw s.error}}try{for(var w=R(this.contextListeners),g=w.next();!g.done;g=w.next()){var S=g.value;S(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(O){o={error:O}}finally{try{g&&!g.done&&(c=w.return)&&c.call(w)}finally{if(o)throw o.error}}var N=je(e.configuration||[],this.machine);if(this.state.configuration&&N){var A=e.configuration.find(function(O){return O.type==="final"&&O.parent===p.machine}),M=A&&A.doneData?Je(A.doneData,e.context,r):void 0;try{for(var b=R(this.doneListeners),T=b.next();!T.done;T=b.next()){var h=T.value;h(tt(this.id,M))}}catch(O){f={error:O}}finally{try{T&&!T.done&&(u=b.return)&&u.call(b)}finally{if(f)throw f.error}}this.stop()}},t.prototype.onTransition=function(e){return this.listeners.add(e),this.status===q.Running&&e(this.state,this.state.event),this},t.prototype.subscribe=function(e,r,n){var i=this;if(!e)return{unsubscribe:function(){}};var s,a=n;return typeof e=="function"?s=e:(s=e.next.bind(e),a=e.complete.bind(e)),this.listeners.add(s),this.status!==q.NotStarted&&s(this.state),a&&(this.status===q.Stopped?a():this.onDone(a)),{unsubscribe:function(){s&&i.listeners.delete(s),a&&i.doneListeners.delete(a)}}},t.prototype.onEvent=function(e){return this.eventListeners.add(e),this},t.prototype.onSend=function(e){return this.sendListeners.add(e),this},t.prototype.onChange=function(e){return this.contextListeners.add(e),this},t.prototype.onStop=function(e){return this.stopListeners.add(e),this},t.prototype.onDone=function(e){return this.doneListeners.add(e),this},t.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},t.prototype.start=function(e){var r=this;if(this.status===q.Running)return this;this.machine._init(),it.register(this.sessionId,this),this.initialized=!0,this.status=q.Running;var n=e===void 0?this.initialState:Le(this,function(){return ui(e)?r.machine.resolveState(e):r.machine.resolveState(ne.from(e,r.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){r.update(n,Qe)}),this},t.prototype.stop=function(){var e,r,n,i,s,a,o,c,f,u,p=this;try{for(var d=R(this.listeners),l=d.next();!l.done;l=d.next()){var h=l.value;this.listeners.delete(h)}}catch(T){e={error:T}}finally{try{l&&!l.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}try{for(var v=R(this.stopListeners),y=v.next();!y.done;y=v.next()){var h=y.value;h(),this.stopListeners.delete(h)}}catch(T){n={error:T}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}try{for(var w=R(this.contextListeners),g=w.next();!g.done;g=w.next()){var h=g.value;this.contextListeners.delete(h)}}catch(T){s={error:T}}finally{try{g&&!g.done&&(a=w.return)&&a.call(w)}finally{if(s)throw s.error}}try{for(var S=R(this.doneListeners),N=S.next();!N.done;N=S.next()){var h=N.value;this.doneListeners.delete(h)}}catch(T){o={error:T}}finally{try{N&&!N.done&&(c=S.return)&&c.call(S)}finally{if(o)throw o.error}}if(!this.initialized)return this;D([],_(this.state.configuration),!1).sort(function(T,O){return O.order-T.order}).forEach(function(T){var O,k;try{for(var B=R(T.definition.exit),z=B.next();!z.done;z=B.next()){var ce=z.value;p.exec(ce,p.state)}}catch(gt){O={error:gt}}finally{try{z&&!z.done&&(k=B.return)&&k.call(B)}finally{if(O)throw O.error}}}),this.children.forEach(function(T){P(T.stop)&&T.stop()}),this.children.clear();try{for(var A=R(Object.keys(this.delayedEventsMap)),M=A.next();!M.done;M=A.next()){var b=M.value;this.clock.clearTimeout(this.delayedEventsMap[b])}}catch(T){f={error:T}}finally{try{M&&!M.done&&(u=A.return)&&u.call(A)}finally{if(f)throw f.error}}return this.scheduler.clear(),this.scheduler=new xr({deferEvents:this.options.deferEvents}),this.initialized=!1,this.status=q.Stopped,this._initialState=void 0,it.free(this.sessionId),this},t.prototype.batch=function(e){var r=this;if(!(this.status===q.NotStarted&&this.options.deferEvents)){if(this.status!==q.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}this.scheduler.schedule(function(){var n,i,s=r.state,a=!1,o=[],c=function(d){var l=V(d);r.forward(l),s=Le(r,function(){return r.machine.transition(s,l)}),o.push.apply(o,D([],_(s.actions.map(function(h){return ci(h,s)})),!1)),a=a||!!s.changed};try{for(var f=R(e),u=f.next();!u.done;u=f.next()){var p=u.value;c(p)}}catch(d){n={error:d}}finally{try{u&&!u.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}s.changed=a,s.actions=o,r.update(s,V(e[e.length-1]))})},t.prototype.sender=function(e){return this.send.bind(this,e)},t.prototype.nextState=function(e){var r=this,n=V(e);if(n.name.indexOf(ur)===0&&!this.state.nextEvents.some(function(s){return s.indexOf(ur)===0}))throw n.data.data;var i=Le(this,function(){return r.machine.transition(r.state,n)});return i},t.prototype.forward=function(e){var r,n;try{for(var i=R(this.forwardTo),s=i.next();!s.done;s=i.next()){var a=s.value,o=this.children.get(a);if(!o)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(a,"'."));o.send(e)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.defer=function(e){var r=this;this.delayedEventsMap[e.id]=this.clock.setTimeout(function(){e.to?r.sendTo(e._event,e.to):r.send(e._event)},e.delay)},t.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},t.prototype.exec=function(e,r,n){n===void 0&&(n=this.machine.options.actions);var i=r.context,s=r._event,a=e.exec||Nt(e.type,n),o=P(a)?a:a?a.exec:e.exec;if(o)try{return o(i,s.data,{action:e,state:this.state,_event:s})}catch(N){throw this.parent&&this.parent.send({type:"xstate.error",data:N}),N}switch(e.type){case Ge:var c=e;if(typeof c.delay=="number"){this.defer(c);return}else c.to?this.sendTo(c._event,c.to):this.send(c._event);break;case ar:this.cancel(e.sendId);break;case Tt:{if(this.status!==q.Running)return;var f=e.activity;if(!this.state.activities[f.id||f.type])break;if(f.type===I.Invoke){var u=Sr(f.src),p=this.machine.options.services?this.machine.options.services[u.type]:void 0,d=f.id,l=f.data,h="autoForward"in f?f.autoForward:!!f.forward;if(!p)return;var v=l?Je(l,i,s):void 0;if(typeof p=="string")return;var y=P(p)?p(i,s.data,{data:v,src:u,meta:f.meta}):p;if(!y)return;var w=void 0;le(y)&&(y=v?y.withContext(v):y,w={autoForward:h}),this.spawn(y,d,w)}else this.spawnActivity(f);break}case Rt:{this.stopChild(e.activity.id);break}case or:var g=e.label,S=e.value;g?this.logger(g,S):this.logger(S);break}},t.prototype.removeChild=function(e){var r;this.children.delete(e),this.forwardTo.delete(e),(r=this.state)===null||r===void 0||delete r.children[e]},t.prototype.stopChild=function(e){var r=this.children.get(e);!r||(this.removeChild(e),P(r.stop)&&r.stop())},t.prototype.spawn=function(e,r,n){if(pr(e))return this.spawnPromise(Promise.resolve(e),r);if(P(e))return this.spawnCallback(e,r);if(ni(e))return this.spawnActor(e,r);if(Bn(e))return this.spawnObservable(e,r);if(le(e))return this.spawnMachine(e,m(m({},n),{id:r}));if($n(e))return this.spawnBehavior(e,r);throw new Error('Unable to spawn entity "'.concat(r,'" of type "').concat(typeof e,'".'))},t.prototype.spawnMachine=function(e,r){var n=this;r===void 0&&(r={});var i=new t(e,m(m({},this.options),{parent:this,id:r.id||e.id})),s=m(m({},pi),r);s.sync&&i.onTransition(function(o){n.send(cr,{state:o,id:i.id})});var a=i;return this.children.set(i.id,a),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(o){n.removeChild(i.id),n.send(V(o,{origin:i.id}))}).start(),a},t.prototype.spawnBehavior=function(e,r){var n=vi(e,{id:r,parent:this});return this.children.set(r,n),n},t.prototype.spawnPromise=function(e,r){var n,i=this,s=!1,a;e.then(function(c){s||(a=c,i.removeChild(r),i.send(V(tt(r,c),{origin:r})))},function(c){if(!s){i.removeChild(r);var f=Me(r,c);try{i.send(V(f,{origin:r}))}catch{i.devTools&&i.devTools.send(f,i.state),i.machine.strict&&i.stop()}}});var o=(n={id:r,send:function(){},subscribe:function(c,f,u){var p=Pt(c,f,u),d=!1;return e.then(function(l){d||(p.next(l),!d&&p.complete())},function(l){d||p.error(l)}),{unsubscribe:function(){return d=!0}}},stop:function(){s=!0},toJSON:function(){return{id:r}},getSnapshot:function(){return a}},n[ae]=function(){return this},n);return this.children.set(r,o),o},t.prototype.spawnCallback=function(e,r){var n,i=this,s=!1,a=new Set,o=new Set,c,f=function(d){c=d,o.forEach(function(l){return l(d)}),!s&&i.send(V(d,{origin:r}))},u;try{u=e(f,function(d){a.add(d)})}catch(d){this.send(Me(r,d))}if(pr(u))return this.spawnPromise(u,r);var p=(n={id:r,send:function(d){return a.forEach(function(l){return l(d)})},subscribe:function(d){var l=Pt(d);return o.add(l.next),{unsubscribe:function(){o.delete(l.next)}}},stop:function(){s=!0,P(u)&&u()},toJSON:function(){return{id:r}},getSnapshot:function(){return c}},n[ae]=function(){return this},n);return this.children.set(r,p),p},t.prototype.spawnObservable=function(e,r){var n,i=this,s,a=e.subscribe(function(c){s=c,i.send(V(c,{origin:r}))},function(c){i.removeChild(r),i.send(V(Me(r,c),{origin:r}))},function(){i.removeChild(r),i.send(V(tt(r),{origin:r}))}),o=(n={id:r,send:function(){},subscribe:function(c,f,u){return e.subscribe(c,f,u)},stop:function(){return a.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:r}}},n[ae]=function(){return this},n);return this.children.set(r,o),o},t.prototype.spawnActor=function(e,r){return this.children.set(r,e),e},t.prototype.spawnActivity=function(e){var r=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(!!r){var n=r(this.state.context,e);this.spawnEffect(e.id,n)}},t.prototype.spawnEffect=function(e,r){var n;this.children.set(e,(n={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:r||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},n[ae]=function(){return this},n))},t.prototype.attachDev=function(){var e=Lt();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var r=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(m(m({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},r),{features:m({jump:!1,skip:!1},r?r.features:void 0)}),this.machine),this.devTools.init(this.state)}hi(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[ae]=function(){return this},t.prototype.getSnapshot=function(){return this.status===q.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,r){return setTimeout(e,r)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},t.interpret=_r,t}();function _r(t,e){var r=new mi(t,e);return r}function yi(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function st(t){return m(m({type:Ot},t),{toJSON:function(){t.onDone,t.onError;var e=L(t,["onDone","onError"]);return m(m({},e),{type:Ot,src:yi(t.src)})}})}var Ee="",jt="#",$e="*",ge={},we=function(t){return t[0]===jt},Ei=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},gi=function(t,e,r){var n=r.slice(0,-1).some(function(s){return!("cond"in s)&&!("in"in s)&&(x(s.target)||le(s.target))}),i=e===Ee?"the transient event":"event '".concat(e,"'");De(!n,"One or more transitions for ".concat(i," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},wi=function(){function t(e,r,n,i){var s=this;n===void 0&&(n="context"in e?e.context:void 0);var a;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Ei(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:lr),this.id=this.config.id||D([this.machine.key],_(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(a=this.config.schema)!==null&&a!==void 0?a:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?ke(this.config.states,function(f,u){var p,d=new t(f,{},void 0,{parent:s,key:u});return Object.assign(s.idMap,m((p={},p[d.id]=d,p),d.idMap)),d}):ge;var o=0;function c(f){var u,p;f.order=o++;try{for(var d=R(me(f)),l=d.next();!l.done;l=d.next()){var h=l.value;c(h)}}catch(v){u={error:v}}finally{try{l&&!l.done&&(p=d.return)&&p.call(d)}finally{if(u)throw u.error}}}c(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(f){var u=f.event;return u===Ee}):Ee in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=J(this.config.entry||this.config.onEntry).map(function(f){return Ue(f)}),this.onExit=J(this.config.exit||this.config.onExit).map(function(f){return Ue(f)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=J(this.config.invoke).map(function(f,u){var p,d;if(le(f)){var l=Xe(s.id,u);return s.machine.options.services=m((p={},p[l]=f,p),s.machine.options.services),st({src:l,id:l})}else if(x(f.src)){var l=f.id||Xe(s.id,u);return st(m(m({},f),{id:l,src:f.src}))}else if(le(f.src)||P(f.src)){var l=f.id||Xe(s.id,u);return s.machine.options.services=m((d={},d[l]=f.src,d),s.machine.options.services),st(m(m({id:l},f),{src:l}))}else{var h=f.src;return st(m(m({id:Xe(s.id,u)},f),{src:h}))}}),this.activities=J(this.config.activities).concat(this.invoke).map(function(f){return Ct(f)}),this.transition=this.transition.bind(this),this.tags=J(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||Rr(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,i=n.actions,s=n.activities,a=n.guards,o=n.services,c=n.delays;return new t(this.config,{actions:m(m({},i),e.actions),activities:m(m({},s),e.activities),guards:m(m({},a),e.guards),services:m(m({},o),e.services),delays:m(m({},c),e.delays)},r!=null?r:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return P(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ke(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===Ee,n=this.transitions.filter(function(i){var s=i.eventType===e;return r?s:s||i.eventType===$e});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(s,a){var o=P(s)?"".concat(e.id,":delay[").concat(a,"]"):s,c=Zn(o,e.id);return e.onEntry.push(kt(c,{delay:s})),e.onExit.push(zn(c)),c},i=ve(r)?r.map(function(s,a){var o=n(s.delay,a);return m(m({},s),{event:o})}):C(Object.keys(r).map(function(s,a){var o=r[s],c=x(o)?{target:o}:o,f=isNaN(+s)?s:+s,u=n(f,a);return J(c).map(function(p){return m(m({},p),{event:u,delay:f})})}));return i.map(function(s){var a=s.delay;return m(m({},e.formatTransition(s)),{delay:a})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var i=e instanceof ne?e.value:Ce(e,this.delimiter);if(x(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((r={},r[i]=s,r)):[this,this.states[i]]}var a=Object.keys(i),o=[this];return o.push.apply(o,D([],_(C(a.map(function(c){return n.getStateNode(c).getStateNodes(i[c])}))),!1)),o},t.prototype.handles=function(e){var r=dr(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof ne?e:ne.create(e),n=Array.from(ye([],this.getStateNodes(r.value)));return new ne(m(m({},r),{value:this.resolve(r.value),configuration:n,done:je(n,this),tags:Or(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var i=this.getStateNode(e),s=i.next(r,n);return!s||!s.transitions.length?this.next(r,n):s},t.prototype.transitionCompoundNode=function(e,r,n){var i=Object.keys(e),s=this.getStateNode(i[0]),a=s._transition(e[i[0]],r,n);return!a||!a.transitions.length?this.next(r,n):a},t.prototype.transitionParallelNode=function(e,r,n){var i,s,a={};try{for(var o=R(Object.keys(e)),c=o.next();!c.done;c=o.next()){var f=c.value,u=e[f];if(!!u){var p=this.getStateNode(f),d=p._transition(u,r,n);d&&(a[f]=d)}}}catch(g){i={error:g}}finally{try{c&&!c.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}var l=Object.keys(a).map(function(g){return a[g]}),h=C(l.map(function(g){return g.transitions})),v=l.some(function(g){return g.transitions.length>0});if(!v)return this.next(r,n);var y=C(l.map(function(g){return g.entrySet})),w=C(Object.keys(a).map(function(g){return a[g].configuration}));return{transitions:h,entrySet:y,exitSet:C(l.map(function(g){return g.exitSet})),configuration:w,source:r,actions:C(Object.keys(a).map(function(g){return a[g].actions}))}},t.prototype._transition=function(e,r,n){return x(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,V(r))},t.prototype.next=function(e,r){var n,i,s=this,a=r.name,o=[],c=[],f;try{for(var u=R(this.getCandidates(a)),p=u.next();!p.done;p=u.next()){var d=p.value,l=d.cond,h=d.in,v=e.context,y=h?x(h)&&we(h)?e.matches(Ce(this.getStateNodeById(h).path,this.delimiter)):xt(Ce(h,this.delimiter),Mn(this.path.slice(0,-2))(e.value)):!0,w=!1;try{w=!l||wr(this.machine,l,v,r,e)}catch(A){throw new Error("Unable to evaluate guard '".concat(l.name||l.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,`':
`).concat(A.message))}if(w&&y){d.target!==void 0&&(c=d.target),o.push.apply(o,D([],_(d.actions),!1)),f=d;break}}}catch(A){n={error:A}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(!!f){if(!c.length)return{transitions:[f],entrySet:[],exitSet:[],configuration:e.value?[this]:[],source:e,actions:o};var g=C(c.map(function(A){return s.getRelativeStateNodes(A,e.historyValue)})),S=!!f.internal,N=S?[]:C(g.map(function(A){return s.nodesFromChild(A)}));return{transitions:[f],entrySet:N,exitSet:S?[]:[this],configuration:g,source:e,actions:o}}},t.prototype.nodesFromChild=function(e){if(e.escapes(this))return[];for(var r=[],n=e;n&&n!==this;)r.push(n),n=n.parent;return r.push(this),r},t.prototype.escapes=function(e){if(this===e)return!1;for(var r=this.parent;r;){if(r===e)return!1;r=r.parent}return!0},t.prototype.getActions=function(e,r,n,i){var s,a,o,c,f=ye([],i?this.getStateNodes(i.value):[this]),u=e.configuration.length?ye(f,e.configuration):f;try{for(var p=R(u),d=p.next();!d.done;d=p.next()){var l=d.value;nt(f,l)||e.entrySet.push(l)}}catch(b){s={error:b}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(s)throw s.error}}try{for(var h=R(f),v=h.next();!v.done;v=h.next()){var l=v.value;(!nt(u,l)||nt(e.exitSet,l.parent))&&e.exitSet.push(l)}}catch(b){o={error:b}}finally{try{v&&!v.done&&(c=h.return)&&c.call(h)}finally{if(o)throw o.error}}var y=C(e.entrySet.map(function(b){var T=[];if(b.type!=="final")return T;var O=b.parent;if(!O.parent)return T;T.push(et(b.id,b.doneData),et(O.id,b.doneData?Je(b.doneData,r,n):void 0));var k=O.parent;return k.type==="parallel"&&me(k).every(function(B){return je(e.configuration,B)})&&T.push(et(k.id)),T}));e.exitSet.sort(function(b,T){return T.order-b.order}),e.entrySet.sort(function(b,T){return b.order-T.order});var w=new Set(e.entrySet),g=new Set(e.exitSet),S=_([C(Array.from(w).map(function(b){return D(D([],_(b.activities.map(function(T){return Yn(T)})),!1),_(b.onEntry),!1)})).concat(y.map(Kn)),C(Array.from(g).map(function(b){return D(D([],_(b.onExit),!1),_(b.activities.map(function(T){return Jn(T)})),!1)}))],2),N=S[0],A=S[1],M=Ze(A.concat(e.actions).concat(N),this.machine.options.actions);return M},t.prototype.transition=function(e,r,n){e===void 0&&(e=this.initialState);var i=V(r),s;if(e instanceof ne)s=n===void 0?e:this.resolveState(ne.from(e,n));else{var a=x(e)?this.resolve(ze(this.getResolvedPath(e))):this.resolve(e),o=n!=null?n:this.machine.context;s=this.resolveState(ne.from(a,o))}if(!Ne&&i.name===$e)throw new Error("An event cannot have the wildcard type ('".concat($e,"')"));if(this.strict&&!this.events.includes(i.name)&&!jn(i.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(i.name,"'"));var c=this._transition(s.value,s,i)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:s,actions:[]},f=ye([],this.getStateNodes(s.value)),u=c.configuration.length?ye(f,c.configuration):f;return c.configuration=D([],_(u),!1),this.resolveTransition(c,s,s.context,i)},t.prototype.resolveRaisedTransition=function(e,r,n){var i,s=e.actions;return e=this.transition(e,r),e._event=n,e.event=n.data,(i=e.actions).unshift.apply(i,D([],_(s),!1)),e},t.prototype.resolveTransition=function(e,r,n,i){var s,a,o=this;i===void 0&&(i=Qe);var c=e.configuration,f=!r||e.transitions.length>0,u=f?si(this.machine,c):void 0,p=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,d=this.getActions(e,n,i,r),l=r?m({},r.activities):{};try{for(var h=R(d),v=h.next();!v.done;v=h.next()){var y=v.value;y.type===Tt?l[y.activity.id||y.activity.type]=y:y.type===Rt&&(l[y.activity.id||y.activity.type]=!1)}}catch(Y){s={error:Y}}finally{try{v&&!v.done&&(a=h.return)&&a.call(h)}finally{if(s)throw s.error}}var w=_(Dt(this,r,n,i,d,this.machine.config.preserveActionOrder),2),g=w[0],S=w[1],N=_(mr(g,function(Y){return Y.type===He||Y.type===Ge&&Y.to===Pe.Internal}),2),A=N[0],M=N[1],b=g.filter(function(Y){var Ie;return Y.type===Tt&&((Ie=Y.activity)===null||Ie===void 0?void 0:Ie.type)===Ot}),T=b.reduce(function(Y,Ie){return Y[Ie.activity.id]=ei(Ie.activity,o.machine,S,i),Y},r?m({},r.children):{}),O=f?e.configuration:r?r.configuration:[],k=je(O,this),B=new ne({value:u||r.value,context:S,_event:i,_sessionid:r?r._sessionid:null,historyValue:u?p?Fn(p,u):void 0:r?r.historyValue:void 0,history:!u||e.source?r:void 0,actions:u?M:[],activities:u?l:r?r.activities:{},events:[],configuration:O,transitions:e.transitions,children:T,done:k,tags:Or(O),machine:this}),z=n!==S;B.changed=i.name===cr||z;var ce=B.history;ce&&delete ce.history;var gt=!k&&(this._transient||c.some(function(Y){return Y._transient}));if(!f&&(!gt||i.name===Ee))return B;var Z=B;if(!k)for(gt&&(Z=this.resolveRaisedTransition(Z,{type:In},i));A.length;){var xa=A.shift();Z=this.resolveRaisedTransition(Z,xa._event,i)}var _a=Z.changed||(ce?!!Z.actions.length||z||typeof ce.value!=typeof Z.value||!Ar(Z.value,ce.value):void 0);return Z.changed=_a,Z.history=ce,Z},t.prototype.getStateNode=function(e){if(we(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=we(e)?e.slice(jt.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&we(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=_t(e,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||ge;switch(this.type){case"parallel":return ke(this.initialStateValue,function(s,a){return s?n.getStateNode(a).resolve(e[a]||s):ge});case"compound":if(x(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(r={},r[e]=i.initialStateValue,r):e}return Object.keys(e).length?ke(e,function(s,a){return s?n.getStateNode(a).resolve(s):ge}):this.initialStateValue||{};default:return e||ge}},t.prototype.getResolvedPath=function(e){if(we(e)){var r=this.machine.idMap[e.slice(jt.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return _t(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=hr(this.states,function(n){return n.initialStateValue||ge},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=rt(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,entrySet:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;x(r.target)?e=we(r.target)?ze(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(rt(this))return[this];if(this.type==="compound"&&!this.initial)return Ne||De(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var r=Ye(this.initialStateValue);return C(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=_(e),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var s=this.getStateNode(n);if(s.type==="history")return s.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(!!Object.keys(this.states).length)return{current:e||this.initialStateValue,states:hr(this.states,function(r,n){if(!e)return r.historyValue();var i=x(e)?void 0:e[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?C(Ye(i).map(function(a){return n.getFromRelativePath(a)})):n.initialStateNodes}var s=Ln(n.path,"states")(e).current;return x(s)?[n.getStateNode(s)]:C(Ye(s).map(function(a){return r.history==="deep"?n.getFromRelativePath(a):[n.states[a[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=C(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,i;if(this.__cache.events)return this.__cache.events;var s=this.states,a=new Set(this.ownEvents);if(s)try{for(var o=R(Object.keys(s)),c=o.next();!c.done;c=o.next()){var f=c.value,u=s[f];if(u.states)try{for(var p=(n=void 0,R(u.events)),d=p.next();!d.done;d=p.next()){var l=d.value;a.add("".concat(l))}}catch(h){n={error:h}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}}catch(h){e={error:h}}finally{try{c&&!c.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!x(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var s=i?r.key+n:n;if(r.parent)try{var a=r.parent.getStateNodeByPath(s);return a}catch(o){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(o.message))}else return r.getStateNodeByPath(s)})},t.prototype.formatTransition=function(e){var r=this,n=qn(e.target),i="internal"in e?e.internal:n?n.some(function(c){return x(c)&&c[0]===r.delimiter}):!0,s=this.machine.options.guards,a=this.resolveTarget(n),o=m(m({},e),{actions:Ze(J(e.actions)),cond:gr(e.cond,s),target:a,source:this,internal:i,eventType:e.event,toJSON:function(){return m(m({},o),{target:o.target?o.target.map(function(c){return"#".concat(c.id)}):void 0,source:"#".concat(r.id)})}});return o},t.prototype.formatTransitions=function(){var e,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,a=$e,o=s[a],c=o===void 0?[]:o,f=L(s,[typeof a=="symbol"?a:a+""]);i=C(Object.keys(f).map(function(g){!Ne&&g===Ee&&De(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var S=pe(g,f[g]);return Ne||gi(n,g,S),S}).concat(pe($e,c)))}var u=this.config.always?pe("",this.config.always):[],p=this.config.onDone?pe(String(et(this.id)),this.config.onDone):[];Ne||De(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var d=C(this.invoke.map(function(g){var S=[];return g.onDone&&S.push.apply(S,D([],_(pe(String(tt(g.id)),g.onDone)),!1)),g.onError&&S.push.apply(S,D([],_(pe(String(Me(g.id)),g.onError)),!1)),S})),l=this.after,h=C(D(D(D(D([],_(p),!1),_(d),!1),_(i),!1),_(u),!1).map(function(g){return J(g).map(function(S){return n.formatTransition(S)})}));try{for(var v=R(l),y=v.next();!y.done;y=v.next()){var w=y.value;h.push(w)}}catch(g){e={error:g}}finally{try{y&&!y.done&&(r=v.return)&&r.call(v)}finally{if(e)throw e.error}}return h},t}();function Se(t,e){return new wi(t,e)}var U=Qn,K=kt;function Si(t){return new TextEncoder().encode(t)}function fe(t){const e=new Uint8Array(t);let r="";for(const i of e)r+=String.fromCharCode(i);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function $t(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4,n=e.padEnd(e.length+r,"="),i=atob(n),s=new ArrayBuffer(i.length),a=new Uint8Array(s);for(let o=0;o<i.length;o++)a[o]=i.charCodeAt(o);return s}function Ir(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function Pr(t){const{id:e}=t;return ee(G({},t),{id:$t(e),transports:t.transports})}function Nr(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}class $ extends Error{constructor(e,r="WebAuthnError"){super(e),this.name=r}}function Ti({error:t,options:e}){var r,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new $("Registration ceremony was sent an abort signal","AbortError")}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new $("Discoverable credentials were required but no available authenticator supported it","ConstraintError");if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new $("User verification was required but no available authenticator supported it","ConstraintError")}else{if(t.name==="InvalidStateError")return new $("The authenticator was previously registered","InvalidStateError");if(t.name==="NotAllowedError")return new $("User clicked cancel, or the registration ceremony timed out","NotAllowedError");if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new $('No entry in pubKeyCredParams was of type "public-key"',"NotSupportedError"):new $("No available authenticator supported any of the specified pubKeyCredParams algorithms","NotSupportedError");if(t.name==="SecurityError"){const s=window.location.hostname;if(Nr(s)){if(i.rp.id!==s)return new $(`The RP ID "${i.rp.id}" is invalid for this domain`,"SecurityError")}else return new $(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new $("User ID was not between 1 and 64 characters","TypeError")}else if(t.name==="UnknownError")return new $("The authenticator was unable to process the specified options, or could not create a new credential","UnknownError")}return t}class Ri{createNewAbortSignal(){return this.controller&&this.controller.abort(),this.controller=new AbortController,this.controller.signal}reset(){this.controller=void 0}}const at=new Ri;async function Cr(t){if(!Ir())throw new Error("WebAuthn is not supported in this browser");const r={publicKey:ee(G({},t),{challenge:$t(t.challenge),user:ee(G({},t.user),{id:Si(t.user.id)}),excludeCredentials:t.excludeCredentials.map(Pr)})};r.signal=at.createNewAbortSignal();let n;try{n=await navigator.credentials.create(r)}catch(f){throw Ti({error:f,options:r})}finally{at.reset()}if(!n)throw new Error("Registration was not completed");const{id:i,rawId:s,response:a,type:o}=n,c={id:i,rawId:fe(s),response:{attestationObject:fe(a.attestationObject),clientDataJSON:fe(a.clientDataJSON)},type:o,clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:n.authenticatorAttachment};return typeof a.getTransports=="function"&&(c.transports=a.getTransports()),c}function bi(t){return new TextDecoder("utf-8").decode(t)}async function Oi(){if(navigator.credentials.conditionalMediationSupported)return!0;const t=window.PublicKeyCredential;return t.isConditionalMediationAvailable!==void 0&&t.isConditionalMediationAvailable()}function Ai({error:t,options:e}){var r;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new $("Authentication ceremony was sent an abort signal","AbortError")}else{if(t.name==="NotAllowedError")return!((r=n.allowCredentials)===null||r===void 0)&&r.length?new $("No available authenticator recognized any of the allowed credentials","NotAllowedError"):new $("User clicked cancel, or the authentication ceremony timed out","NotAllowedError");if(t.name==="SecurityError"){const i=window.location.hostname;if(Nr(i)){if(n.rpId!==i)return new $(`The RP ID "${n.rpId}" is invalid for this domain`,"SecurityError")}else return new $(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="UnknownError")return new $("The authenticator was unable to process the specified options, or could not create a new assertion signature","UnknownError")}return t}async function xi(t,e=!1){var r,n;if(!Ir())throw new Error("WebAuthn is not supported in this browser");let i;((r=t.allowCredentials)===null||r===void 0?void 0:r.length)!==0&&(i=(n=t.allowCredentials)===null||n===void 0?void 0:n.map(Pr));const s=ee(G({},t),{challenge:$t(t.challenge),allowCredentials:i}),a={};if(e){if(!await Oi())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');a.mediation="conditional",s.allowCredentials=[]}a.publicKey=s,a.signal=at.createNewAbortSignal();let o;try{o=await navigator.credentials.get(a)}catch(l){throw Ai({error:l,options:a})}finally{at.reset()}if(!o)throw new Error("Authentication was not completed");const{id:c,rawId:f,response:u,type:p}=o;let d;return u.userHandle&&(d=bi(u.userHandle)),{id:c,rawId:fe(f),response:{authenticatorData:fe(u.authenticatorData),clientDataJSON:fe(u.clientDataJSON),signature:fe(u.signature),userHandle:d},type:p,clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:o.authenticatorAttachment}}const Fe="nhostRefreshToken",Be="nhostRefreshTokenExpiresAt",kr=3,Dr=300,Ur=5,_i=30,Mr=0,Lr=1,X=10,Te=20;class Ve extends Error{constructor(e){super(e.message),Error.captureStackTrace(this,this.constructor),e instanceof Error?(this.name=e.name,this.error={error:e.name,status:Lr,message:e.message}):(this.name=e.error,this.error=e)}}const ie={status:X,error:"invalid-email",message:"Email is incorrectly formatted"},jr={status:X,error:"invalid-mfa-type",message:"MFA type is invalid"},$r={status:X,error:"invalid-mfa-code",message:"MFA code is invalid"},ot={status:X,error:"invalid-password",message:"Password is incorrectly formatted"},Ft={status:X,error:"invalid-phone-number",message:"Phone number is incorrectly formatted"},Fr={status:X,error:"invalid-mfa-ticket",message:"MFA ticket is invalid"},Br={status:X,error:"no-mfa-ticket",message:"No MFA ticket has been provided"},Ii={status:X,error:"no-refresh-token",message:"No refresh token has been provided"},Pi={status:Te,error:"refresher-already-running",message:"The token refresher is already running. You must wait until is has finished before submitting a new token."},te={status:Te,error:"already-signed-in",message:"User is already signed in"},Vr={status:Te,error:"unauthenticated-user",message:"User is not authenticated"},Ni={status:Te,error:"user-not-anonymous",message:"User is not anonymous"},Ci={status:Te,error:"unverified-user",message:"Email needs verification"},ki={status:X,error:"invalid-refresh-token",message:"Invalid or expired refresh token"};var Bt={exports:{}},qr=function(e,r){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return e.apply(r,i)}},Di=qr,Vt=Object.prototype.toString,qt=function(t){return function(e){var r=Vt.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function de(t){return t=t.toLowerCase(),function(r){return qt(r)===t}}function Kt(t){return Array.isArray(t)}function ut(t){return typeof t=="undefined"}function Ui(t){return t!==null&&!ut(t)&&t.constructor!==null&&!ut(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var Kr=de("ArrayBuffer");function Mi(t){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Kr(t.buffer),e}function Li(t){return typeof t=="string"}function ji(t){return typeof t=="number"}function Hr(t){return t!==null&&typeof t=="object"}function ct(t){if(qt(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var $i=de("Date"),Fi=de("File"),Bi=de("Blob"),Vi=de("FileList");function Ht(t){return Vt.call(t)==="[object Function]"}function qi(t){return Hr(t)&&Ht(t.pipe)}function Ki(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||Vt.call(t)===e||Ht(t.toString)&&t.toString()===e)}var Hi=de("URLSearchParams");function Gi(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Wi(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function Gt(t,e){if(!(t===null||typeof t=="undefined"))if(typeof t!="object"&&(t=[t]),Kt(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function Wt(){var t={};function e(i,s){ct(t[s])&&ct(i)?t[s]=Wt(t[s],i):ct(i)?t[s]=Wt({},i):Kt(i)?t[s]=i.slice():t[s]=i}for(var r=0,n=arguments.length;r<n;r++)Gt(arguments[r],e);return t}function zi(t,e,r){return Gt(e,function(i,s){r&&typeof i=="function"?t[s]=Di(i,r):t[s]=i}),t}function Yi(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function Ji(t,e,r,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,r&&Object.assign(t.prototype,r)}function Xi(t,e,r){var n,i,s,a={};e=e||{};do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)s=n[i],a[s]||(e[s]=t[s],a[s]=!0);t=Object.getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e}function Qi(t,e,r){t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;var n=t.indexOf(e,r);return n!==-1&&n===r}function Zi(t){if(!t)return null;var e=t.length;if(ut(e))return null;for(var r=new Array(e);e-- >0;)r[e]=t[e];return r}var es=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array!="undefined"&&Object.getPrototypeOf(Uint8Array)),F={isArray:Kt,isArrayBuffer:Kr,isBuffer:Ui,isFormData:Ki,isArrayBufferView:Mi,isString:Li,isNumber:ji,isObject:Hr,isPlainObject:ct,isUndefined:ut,isDate:$i,isFile:Fi,isBlob:Bi,isFunction:Ht,isStream:qi,isURLSearchParams:Hi,isStandardBrowserEnv:Wi,forEach:Gt,merge:Wt,extend:zi,trim:Gi,stripBOM:Yi,inherits:Ji,toFlatObject:Xi,kindOf:qt,kindOfTest:de,endsWith:Qi,toArray:Zi,isTypedArray:es,isFileList:Vi},Re=F;function Gr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Wr=function(e,r,n){if(!r)return e;var i;if(n)i=n(r);else if(Re.isURLSearchParams(r))i=r.toString();else{var s=[];Re.forEach(r,function(c,f){c===null||typeof c=="undefined"||(Re.isArray(c)?f=f+"[]":c=[c],Re.forEach(c,function(p){Re.isDate(p)?p=p.toISOString():Re.isObject(p)&&(p=JSON.stringify(p)),s.push(Gr(f)+"="+Gr(p))}))}),i=s.join("&")}if(i){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},ts=F;function lt(){this.handlers=[]}lt.prototype.use=function(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1},lt.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},lt.prototype.forEach=function(e){ts.forEach(this.handlers,function(n){n!==null&&e(n)})};var rs=lt,ns=F,is=function(e,r){ns.forEach(e,function(i,s){s!==r&&s.toUpperCase()===r.toUpperCase()&&(e[r]=i,delete e[s])})},zr=F;function be(t,e,r,n,i){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}zr.inherits(be,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Yr=be.prototype,Jr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){Jr[t]={value:t}}),Object.defineProperties(be,Jr),Object.defineProperty(Yr,"isAxiosError",{value:!0}),be.from=function(t,e,r,n,i,s){var a=Object.create(Yr);return zr.toFlatObject(t,a,function(c){return c!==Error.prototype}),be.call(a,t.message,e,r,n,i),a.name=t.name,s&&Object.assign(a,s),a};var Oe=be,Xr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q=F;function ss(t,e){e=e||new FormData;var r=[];function n(s){return s===null?"":Q.isDate(s)?s.toISOString():Q.isArrayBuffer(s)||Q.isTypedArray(s)?typeof Blob=="function"?new Blob([s]):Buffer.from(s):s}function i(s,a){if(Q.isPlainObject(s)||Q.isArray(s)){if(r.indexOf(s)!==-1)throw Error("Circular reference detected in "+a);r.push(s),Q.forEach(s,function(c,f){if(!Q.isUndefined(c)){var u=a?a+"."+f:f,p;if(c&&!a&&typeof c=="object"){if(Q.endsWith(f,"{}"))c=JSON.stringify(c);else if(Q.endsWith(f,"[]")&&(p=Q.toArray(c))){p.forEach(function(d){!Q.isUndefined(d)&&e.append(u,n(d))});return}}i(c,u)}}),r.pop()}else e.append(a,n(s))}return i(t),e}var Qr=ss,zt=Oe,as=function(e,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):r(new zt("Request failed with status code "+n.status,[zt.ERR_BAD_REQUEST,zt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))},ft=F,os=ft.isStandardBrowserEnv()?function(){return{write:function(r,n,i,s,a,o){var c=[];c.push(r+"="+encodeURIComponent(n)),ft.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),ft.isString(s)&&c.push("path="+s),ft.isString(a)&&c.push("domain="+a),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),us=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},cs=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e},ls=us,fs=cs,Zr=function(e,r){return e&&!ls(r)?fs(e,r):r},Yt=F,ds=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],hs=function(e){var r={},n,i,s;return e&&Yt.forEach(e.split(`
`),function(o){if(s=o.indexOf(":"),n=Yt.trim(o.substr(0,s)).toLowerCase(),i=Yt.trim(o.substr(s+1)),n){if(r[n]&&ds.indexOf(n)>=0)return;n==="set-cookie"?r[n]=(r[n]?r[n]:[]).concat([i]):r[n]=r[n]?r[n]+", "+i:i}}),r},en=F,vs=en.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(s){var a=s;return e&&(r.setAttribute("href",a),a=r.href),r.setAttribute("href",a),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(a){var o=en.isString(a)?i(a):a;return o.protocol===n.protocol&&o.host===n.host}}():function(){return function(){return!0}}(),Jt=Oe,ps=F;function tn(t){Jt.call(this,t==null?"canceled":t,Jt.ERR_CANCELED),this.name="CanceledError"}ps.inherits(tn,Jt,{__CANCEL__:!0});var dt=tn,ms=function(e){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""},qe=F,ys=as,Es=os,gs=Wr,ws=Zr,Ss=hs,Ts=vs,Rs=Xr,se=Oe,bs=dt,Os=ms,rn=function(e){return new Promise(function(n,i){var s=e.data,a=e.headers,o=e.responseType,c;function f(){e.cancelToken&&e.cancelToken.unsubscribe(c),e.signal&&e.signal.removeEventListener("abort",c)}qe.isFormData(s)&&qe.isStandardBrowserEnv()&&delete a["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(p+":"+d)}var l=ws(e.baseURL,e.url);u.open(e.method.toUpperCase(),gs(l,e.params,e.paramsSerializer),!0),u.timeout=e.timeout;function h(){if(!!u){var w="getAllResponseHeaders"in u?Ss(u.getAllResponseHeaders()):null,g=!o||o==="text"||o==="json"?u.responseText:u.response,S={data:g,status:u.status,statusText:u.statusText,headers:w,config:e,request:u};ys(function(A){n(A),f()},function(A){i(A),f()},S),u=null}}if("onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(h)},u.onabort=function(){!u||(i(new se("Request aborted",se.ECONNABORTED,e,u)),u=null)},u.onerror=function(){i(new se("Network Error",se.ERR_NETWORK,e,u,u)),u=null},u.ontimeout=function(){var g=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",S=e.transitional||Rs;e.timeoutErrorMessage&&(g=e.timeoutErrorMessage),i(new se(g,S.clarifyTimeoutError?se.ETIMEDOUT:se.ECONNABORTED,e,u)),u=null},qe.isStandardBrowserEnv()){var v=(e.withCredentials||Ts(l))&&e.xsrfCookieName?Es.read(e.xsrfCookieName):void 0;v&&(a[e.xsrfHeaderName]=v)}"setRequestHeader"in u&&qe.forEach(a,function(g,S){typeof s=="undefined"&&S.toLowerCase()==="content-type"?delete a[S]:u.setRequestHeader(S,g)}),qe.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),o&&o!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(c=function(w){!u||(i(!w||w&&w.type?new bs:w),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(c),e.signal&&(e.signal.aborted?c():e.signal.addEventListener("abort",c))),s||(s=null);var y=Os(l);if(y&&["http","https","file"].indexOf(y)===-1){i(new se("Unsupported protocol "+y+":",se.ERR_BAD_REQUEST,e));return}u.send(s)})},As=null,j=F,nn=is,sn=Oe,xs=Xr,_s=Qr,Is={"Content-Type":"application/x-www-form-urlencoded"};function an(t,e){!j.isUndefined(t)&&j.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function Ps(){var t;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(t=rn),t}function Ns(t,e,r){if(j.isString(t))try{return(e||JSON.parse)(t),j.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var ht={transitional:xs,adapter:Ps(),transformRequest:[function(e,r){if(nn(r,"Accept"),nn(r,"Content-Type"),j.isFormData(e)||j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return an(r,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n=j.isObject(e),i=r&&r["Content-Type"],s;if((s=j.isFileList(e))||n&&i==="multipart/form-data"){var a=this.env&&this.env.FormData;return _s(s?{"files[]":e}:e,a&&new a)}else if(n||i==="application/json")return an(r,"application/json"),Ns(e);return e}],transformResponse:[function(e){var r=this.transitional||ht.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&j.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?sn.from(a,sn.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:As},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};j.forEach(["delete","get","head"],function(e){ht.headers[e]={}}),j.forEach(["post","put","patch"],function(e){ht.headers[e]=j.merge(Is)});var Xt=ht,Cs=F,ks=Xt,Ds=function(e,r,n){var i=this||ks;return Cs.forEach(n,function(a){e=a.call(i,e,r)}),e},on=function(e){return!!(e&&e.__CANCEL__)},un=F,Qt=Ds,Us=on,Ms=Xt,Ls=dt;function Zt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ls}var js=function(e){Zt(e),e.headers=e.headers||{},e.data=Qt.call(e,e.data,e.headers,e.transformRequest),e.headers=un.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),un.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var r=e.adapter||Ms.adapter;return r(e).then(function(i){return Zt(e),i.data=Qt.call(e,i.data,i.headers,e.transformResponse),i},function(i){return Us(i)||(Zt(e),i&&i.response&&(i.response.data=Qt.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},W=F,cn=function(e,r){r=r||{};var n={};function i(u,p){return W.isPlainObject(u)&&W.isPlainObject(p)?W.merge(u,p):W.isPlainObject(p)?W.merge({},p):W.isArray(p)?p.slice():p}function s(u){if(W.isUndefined(r[u])){if(!W.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],r[u])}function a(u){if(!W.isUndefined(r[u]))return i(void 0,r[u])}function o(u){if(W.isUndefined(r[u])){if(!W.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,r[u])}function c(u){if(u in r)return i(e[u],r[u]);if(u in e)return i(void 0,e[u])}var f={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c};return W.forEach(Object.keys(e).concat(Object.keys(r)),function(p){var d=f[p]||s,l=d(p);W.isUndefined(l)&&d!==c||(n[p]=l)}),n},ln={version:"0.27.2"},$s=ln.version,oe=Oe,er={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){er[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var fn={};er.transitional=function(e,r,n){function i(s,a){return"[Axios v"+$s+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return function(s,a,o){if(e===!1)throw new oe(i(a," has been removed"+(r?" in "+r:"")),oe.ERR_DEPRECATED);return r&&!fn[a]&&(fn[a]=!0,console.warn(i(a," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(s,a,o):!0}};function Fs(t,e,r){if(typeof t!="object")throw new oe("options must be an object",oe.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),i=n.length;i-- >0;){var s=n[i],a=e[s];if(a){var o=t[s],c=o===void 0||a(o,s,t);if(c!==!0)throw new oe("option "+s+" must be "+c,oe.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new oe("Unknown option "+s,oe.ERR_BAD_OPTION)}}var Bs={assertOptions:Fs,validators:er},dn=F,Vs=Wr,hn=rs,vn=js,vt=cn,qs=Zr,pn=Bs,Ae=pn.validators;function xe(t){this.defaults=t,this.interceptors={request:new hn,response:new hn}}xe.prototype.request=function(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=vt(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&pn.assertOptions(n,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(l){typeof l.runWhen=="function"&&l.runWhen(r)===!1||(s=s&&l.synchronous,i.unshift(l.fulfilled,l.rejected))});var a=[];this.interceptors.response.forEach(function(l){a.push(l.fulfilled,l.rejected)});var o;if(!s){var c=[vn,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(a),o=Promise.resolve(r);c.length;)o=o.then(c.shift(),c.shift());return o}for(var f=r;i.length;){var u=i.shift(),p=i.shift();try{f=u(f)}catch(d){p(d);break}}try{o=vn(f)}catch(d){return Promise.reject(d)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},xe.prototype.getUri=function(e){e=vt(this.defaults,e);var r=qs(e.baseURL,e.url);return Vs(r,e.params,e.paramsSerializer)},dn.forEach(["delete","get","head","options"],function(e){xe.prototype[e]=function(r,n){return this.request(vt(n||{},{method:e,url:r,data:(n||{}).data}))}}),dn.forEach(["post","put","patch"],function(e){function r(n){return function(s,a,o){return this.request(vt(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}xe.prototype[e]=r(),xe.prototype[e+"Form"]=r(!0)});var Ks=xe,Hs=dt;function _e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(i){e=i});var r=this;this.promise.then(function(n){if(!!r._listeners){var i,s=r._listeners.length;for(i=0;i<s;i++)r._listeners[i](n);r._listeners=null}}),this.promise.then=function(n){var i,s=new Promise(function(a){r.subscribe(a),i=a}).then(n);return s.cancel=function(){r.unsubscribe(i)},s},t(function(i){r.reason||(r.reason=new Hs(i),e(r.reason))})}_e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},_e.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]},_e.prototype.unsubscribe=function(e){if(!!this._listeners){var r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}},_e.source=function(){var e,r=new _e(function(i){e=i});return{token:r,cancel:e}};var Gs=_e,Ws=function(e){return function(n){return e.apply(null,n)}},zs=F,Ys=function(e){return zs.isObject(e)&&e.isAxiosError===!0},mn=F,Js=qr,pt=Ks,Xs=cn,Qs=Xt;function yn(t){var e=new pt(t),r=Js(pt.prototype.request,e);return mn.extend(r,pt.prototype,e),mn.extend(r,e),r.create=function(i){return yn(Xs(t,i))},r}var H=yn(Qs);H.Axios=pt,H.CanceledError=dt,H.CancelToken=Gs,H.isCancel=on,H.VERSION=ln.version,H.toFormData=Qr,H.AxiosError=Oe,H.Cancel=H.CanceledError,H.all=function(e){return Promise.all(e)},H.spread=Ws,H.isAxiosError=Ys,Bt.exports=H,Bt.exports.default=H;var Zs=Bt.exports;const he=t=>{const e=Zs.create({baseURL:t});return e.interceptors.response.use(r=>r,r=>{var n,i,s,a,o,c,f,u,p,d;return Promise.reject({error:{message:(o=(a=(s=(i=(n=r.response)==null?void 0:n.data)==null?void 0:i.message)!=null?s:r.message)!=null?a:r.request.responseText)!=null?o:JSON.stringify(r),status:(p=(u=(c=r.response)==null?void 0:c.status)!=null?u:(f=r.response)==null?void 0:f.data.statusCode)!=null?p:Mr,error:((d=r.response)==null?void 0:d.data.error)||r.request.statusText||"network"}})}),e};/*! js-cookie v3.0.1 | MIT */function mt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}var ea={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function tr(t,e){function r(i,s,a){if(typeof document!="undefined"){a=mt({},e,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var c in a)!a[c]||(o+="; "+c,a[c]!==!0&&(o+="="+a[c].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+o}}function n(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],a={},o=0;o<s.length;o++){var c=s[o].split("="),f=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(a[u]=t.read(f,u),i===u)break}catch{}}return i?a[i]:a}}return Object.create({set:r,get:n,remove:function(i,s){r(i,"",mt({},s,{expires:-1}))},withAttributes:function(i){return tr(this.converter,mt({},this.attributes,i))},withConverter:function(i){return tr(mt({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var rr=tr(ea,{path:"/"});const yt=typeof window!="undefined",Et=new Map,ta=t=>{var e;return yt&&typeof localStorage!="undefined"?localStorage.getItem(t):(e=Et.get(t))!=null?e:null},ra=(t,e)=>{yt&&typeof localStorage!="undefined"?e?localStorage.setItem(t,e):localStorage.removeItem(t):e?Et.set(t,e):Et.has(t)&&Et.delete(t)},En=(t,e)=>{if(t==="localStorage"||t==="web")return ta;if(t==="cookie")return r=>{var n;return yt&&(n=rr.get(r))!=null?n:null};if(!e)throw Error(`clientStorageType is set to '${t}' but no clientStorage has been given`);if(t==="react-native")return r=>{var n;return(n=e.getItem)==null?void 0:n.call(e,r)};if(t==="capacitor")return r=>{var n;return(n=e.get)==null?void 0:n.call(e,{key:r})};if(t==="expo-secure-storage")return r=>{var n;return(n=e.getItemAsync)==null?void 0:n.call(e,r)};if(t==="custom"){if(e.getItem&&e.removeItem)return e.getItem;if(e.getItemAsync)return e.getItemAsync;throw Error(`clientStorageType is set to 'custom' but clientStorage is missing either "getItem" and "removeItem" properties or "getItemAsync" property`)}throw Error(`Unknown storage type: ${t}`)},gn=(t,e)=>{if(t==="localStorage"||t==="web")return ra;if(t==="cookie")return(r,n)=>{yt&&(n?rr.set(r,n,{expires:30}):rr.remove(r))};if(!e)throw Error(`clientStorageType is set to '${t}' but no clienStorage has been given`);if(t==="react-native")return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(t==="capacitor")return(r,n)=>{var i,s;return n?(i=e.set)==null?void 0:i.call(e,{key:r,value:n}):(s=e.remove)==null?void 0:s.call(e,{key:r})};if(t==="expo-secure-storage")return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.deleteItemAsync)==null?void 0:s.call(e,r)};if(t==="custom"){if(!e.removeItem)throw Error("clientStorageType is set to 'custom' but clientStorage is missing a removeItem property");if(e.setItem)return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(e.setItemAsync)return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};throw Error("clientStorageType is set to 'custom' but clientStorage is missing setItem or setItemAsync property")}throw Error(`Unknown storage type: ${t}`)},wn=(t,e)=>{const r=e&&Object.entries(e).map(([n,i])=>{const s=Array.isArray(i)?i.join(","):typeof i=="object"?JSON.stringify(i):i;return`${n}=${encodeURIComponent(s)}`}).join("&");return r?`${t}?${r}`:t},re=(t,e)=>{if(!(e!=null&&e.redirectTo))return e;const u=e,{redirectTo:r}=u,n=St(u,["redirectTo"]);if(!t)return r.startsWith("/")?n:e;const i=new URL(t),s=Object.fromEntries(new URLSearchParams(i.search)),a=new URL(r.startsWith("/")?i.origin+r:r),o=new URLSearchParams(a.search);let c=Object.fromEntries(o);r.startsWith("/")&&(c=G(G({},s),c));let f=i.pathname;return a.pathname.length>1&&(f+=a.pathname.slice(1)),ee(G({},n),{redirectTo:wn(a.origin+f,c)})};function Ke(t,e){var i;if(!e){if(typeof window=="undefined")return;e=((i=window.location)==null?void 0:i.href)||""}t=t.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)"),n=r.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function nr(t){var r;if(typeof window=="undefined")return;const e=window==null?void 0:window.location;if(!!e&&e){const n=new URLSearchParams(e.search),i=new URLSearchParams((r=e.hash)==null?void 0:r.slice(1));n.delete(t),i.delete(t);let s=window.location.pathname;Array.from(n).length&&(s+=`?${n.toString()}`),Array.from(i).length&&(s+=`#${i.toString()}`),window.history.pushState({},"",s)}}const ue=t=>!!t&&typeof t=="string"&&!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),ir=t=>!!t&&typeof t=="string"&&t.length>=kr,Sn=t=>!!t&&typeof t=="string",na=t=>t&&typeof t=="string"&&t.match(/^mfaTotp:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i),sr={user:null,mfa:null,accessToken:{value:null,expiresAt:null},refreshTimer:{startedAt:null,attempts:0,lastAttempt:null},refreshToken:{value:null},errors:{}},ia=({backendUrl:t,clientUrl:e,interpreter:r})=>{const n=he(t);return Se({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"changeEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:U({error:i=>ie}),saveRequestError:U({error:(i,{data:{error:s}})=>s}),reportError:K(i=>({type:"ERROR",error:i.error})),reportSuccess:K("SUCCESS")},guards:{invalidEmail:(i,{email:s})=>!ue(s)},services:{requestChange:async(i,{email:s,options:a})=>(await n.post("/user/email/change",{newEmail:s,options:re(e,a)},{headers:{authorization:`Bearer ${r==null?void 0:r.state.context.accessToken.value}`}})).data}})},sa=({backendUrl:t,interpreter:e})=>{const r=he(t);return Se({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidPassword",actions:"saveInvalidPasswordError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidPasswordError:U({error:n=>ot}),saveRequestError:U({error:(n,{data:{error:i}})=>i}),reportError:K(n=>({type:"ERROR",error:n.error})),reportSuccess:K("SUCCESS")},guards:{invalidPassword:(n,{password:i})=>!ir(i)},services:{requestChange:(n,{password:i,ticket:s})=>r.post("/user/password",{newPassword:i,ticket:s},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}})}})},aa=({backendUrl:t,interpreter:e})=>{const r=he(t);return Se({schema:{context:{},events:{}},tsTypes:{},preserveActionOrder:!0,id:"enableMfa",initial:"idle",context:{error:null,imageUrl:null,secret:null},states:{idle:{initial:"initial",on:{GENERATE:"generating"},states:{initial:{},error:{}}},generating:{invoke:{src:"generate",id:"generate",onDone:{target:"generated",actions:["reportGeneratedSuccess","saveGeneration"]},onError:{actions:["saveError","reportGeneratedError"],target:"idle.error"}}},generated:{initial:"idle",states:{idle:{initial:"idle",on:{ACTIVATE:[{cond:"invalidMfaType",actions:"saveInvalidMfaTypeError",target:".error"},{cond:"invalidMfaCode",actions:"saveInvalidMfaCodeError",target:".error"},{target:"activating"}]},states:{idle:{},error:{}}},activating:{invoke:{src:"activate",id:"activate",onDone:{target:"activated",actions:"reportSuccess"},onError:{actions:["saveError","reportError"],target:"idle.error"}}},activated:{type:"final"}}}}},{actions:{saveInvalidMfaTypeError:U({error:n=>jr}),saveInvalidMfaCodeError:U({error:n=>$r}),saveError:U({error:(n,{data:{error:i}})=>i}),saveGeneration:U({imageUrl:(n,{data:{imageUrl:i}})=>i,secret:(n,{data:{totpSecret:i}})=>i}),reportError:K(n=>({type:"ERROR",error:n.error})),reportSuccess:K("SUCCESS"),reportGeneratedSuccess:K("GENERATED"),reportGeneratedError:K(n=>({type:"GENERATED_ERROR",error:n.error}))},guards:{invalidMfaCode:(n,{code:i})=>!i,invalidMfaType:(n,{activeMfaType:i})=>!i||i!=="totp"},services:{generate:async n=>{const{data:i}=await r.get("/mfa/totp/generate",{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});return i},activate:(n,{code:i,activeMfaType:s})=>r.post("/user/mfa",{code:i,activeMfaType:s},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}})}})},oa=({backendUrl:t,clientUrl:e})=>{const r=he(t);return Se({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:U({error:n=>ie}),saveRequestError:U({error:(n,{data:{error:i}})=>i}),reportError:K(n=>({type:"ERROR",error:n.error})),reportSuccess:K("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!ue(i)},services:{requestChange:(n,{email:i,options:s})=>r.post("/user/password/reset",{email:i,options:re(e,s)})}})},ua=({backendUrl:t,clientUrl:e})=>{const r=he(t);return Se({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"sendVerificationEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"request",id:"request",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:U({error:n=>ie}),saveRequestError:U({error:(n,{data:{error:i}})=>i}),reportError:K(n=>({type:"ERROR",error:n.error})),reportSuccess:K("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!ue(i)},services:{request:async(n,{email:i,options:s})=>(await r.post("/user/email/send-verification-email",{email:i,options:re(e,s)})).data}})},Tn=({backendUrl:t,clientUrl:e,clientStorageGetter:r,clientStorageSetter:n,clientStorageType:i="web",clientStorage:s,refreshIntervalTime:a,autoRefreshToken:o=!0,autoSignIn:c=!0})=>{const f=r||En(i,s),u=n||gn(i,s),p=he(t),d=async(l,h,v)=>(await p.post(l,h,v)).data;return Se({schema:{context:{},events:{},services:{}},tsTypes:{},context:sr,preserveActionOrder:!0,id:"nhost",type:"parallel",states:{authentication:{initial:"starting",on:{SESSION_UPDATE:[{cond:"hasSession",actions:["saveSession","resetTimer","reportTokenChanged"],target:".signedIn"}]},states:{starting:{entry:"resetErrors",tags:["loading"],always:{cond:"isSignedIn",target:"signedIn"},invoke:{id:"importRefreshToken",src:"importRefreshToken",onDone:{actions:["saveSession","reportTokenChanged"],target:"signedIn"},onError:{actions:["saveAuthenticationError"],target:"signedOut"}}},signedOut:{initial:"noErrors",entry:"reportSignedOut",states:{noErrors:{},success:{},needsSmsOtp:{},needsMfa:{},failed:{},signingOut:{entry:["clearContextExceptRefreshToken"],exit:["destroyRefreshToken","reportTokenChanged"],invoke:{src:"signout",id:"signingOut",onDone:{target:"success"},onError:{target:"failed",actions:["saveAuthenticationError"]}}}},on:{SIGNIN_PASSWORD:"authenticating.password",SIGNIN_ANONYMOUS:"authenticating.anonymous",SIGNIN_SECURITY_KEY_EMAIL:"authenticating.securityKeyEmail",SIGNIN_MFA_TOTP:"authenticating.mfa.totp"}},authenticating:{entry:"resetErrors",states:{password:{invoke:{src:"signInPassword",id:"authenticateUserWithPassword",onDone:[{cond:"hasMfaTicket",actions:["saveMfaTicket"],target:"#nhost.authentication.signedOut.needsMfa"},{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"}],onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}},anonymous:{invoke:{src:"signInAnonymous",id:"authenticateAnonymously",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},mfa:{states:{totp:{invoke:{src:"signInMfaTotp",id:"signInMfaTotp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:["saveAuthenticationError"],target:"#nhost.authentication.signedOut.failed"}}}}},securityKeyEmail:{invoke:{src:"signInSecurityKeyEmail",id:"authenticateUserWithSecurityKey",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}}}},signedIn:{type:"parallel",entry:["reportSignedIn","cleanUrl","broadcastToken","resetErrors"],on:{SIGNOUT:"signedOut.signingOut"},states:{refreshTimer:{id:"timer",initial:"idle",states:{disabled:{type:"final"},stopped:{always:{cond:"noToken",target:"idle"}},idle:{always:[{cond:"isAutoRefreshDisabled",target:"disabled"},{cond:"hasRefreshToken",target:"running"}]},running:{initial:"pending",entry:"resetTimer",states:{pending:{after:{"1000":{internal:!1,target:"pending"}},always:{cond:"refreshTimerShouldRefresh",target:"refreshing"}},refreshing:{invoke:{src:"refreshToken",id:"refreshToken",onDone:{actions:["saveSession","resetTimer","reportTokenChanged"],target:"pending"},onError:[{actions:"saveRefreshAttempt",target:"pending"}]}}}}}}}}}},token:{initial:"idle",states:{idle:{on:{TRY_TOKEN:"running"},initial:"noErrors",states:{noErrors:{},error:{}}},running:{invoke:{src:"refreshToken",id:"authenticateWithToken",onDone:{actions:["saveSession","reportTokenChanged"],target:["#nhost.authentication.signedIn","idle.noErrors"]},onError:[{cond:"isSignedIn",target:"idle.error"},{actions:"saveAuthenticationError",target:["#nhost.authentication.signedOut.failed","idle.error"]}]}}}},registration:{initial:"incomplete",on:{SIGNED_IN:[{cond:"isAnonymous",target:".incomplete"},".complete"]},states:{incomplete:{on:{SIGNUP_EMAIL_PASSWORD:"emailPassword",SIGNUP_SECURITY_KEY:"securityKey",PASSWORDLESS_EMAIL:"passwordlessEmail",PASSWORDLESS_SMS:"passwordlessSms",PASSWORDLESS_SMS_OTP:"passwordlessSmsOtp"},initial:"noErrors",states:{noErrors:{},needsEmailVerification:{},needsOtp:{},failed:{}}},emailPassword:{entry:["resetErrors"],invoke:{src:"signUpEmailPassword",id:"signUpEmailPassword",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},securityKey:{entry:["resetErrors"],invoke:{src:"signUpSecurityKey",id:"signUpSecurityKey",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},passwordlessEmail:{entry:["resetErrors"],invoke:{src:"passwordlessEmail",id:"passwordlessEmail",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSms:{entry:["resetErrors"],invoke:{src:"passwordlessSms",id:"passwordlessSms",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsOtp"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSmsOtp:{entry:["resetErrors"],invoke:{src:"passwordlessSmsOtp",id:"passwordlessSmsOtp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},complete:{on:{SIGNED_OUT:"incomplete"}}}}}},{actions:{reportSignedIn:K("SIGNED_IN"),reportSignedOut:K("SIGNED_OUT"),reportTokenChanged:K("TOKEN_CHANGED"),clearContext:U(()=>(u(Be,null),u(Fe,null),G({},sr))),clearContextExceptRefreshToken:U(({refreshToken:{value:l}})=>(u(Be,null),ee(G({},sr),{refreshToken:{value:l}}))),saveSession:U({user:(l,{data:h})=>{var v;return((v=h==null?void 0:h.session)==null?void 0:v.user)||null},accessToken:(l,{data:h})=>{if(h.session){const{accessTokenExpiresIn:v,accessToken:y}=h.session,w=new Date(Date.now()+v*1e3);return u(Be,w.toISOString()),{value:y,expiresAt:w}}return u(Be,null),{value:null,expiresAt:null}},refreshToken:(l,{data:h})=>{var y;const v=((y=h.session)==null?void 0:y.refreshToken)||null;return v&&u(Fe,v),{value:v}}}),saveMfaTicket:U({mfa:(l,h)=>{var v;return(v=h.data)==null?void 0:v.mfa}}),resetTimer:U({refreshTimer:l=>({startedAt:new Date,attempts:0,lastAttempt:null})}),saveRefreshAttempt:U({refreshTimer:(l,h)=>({startedAt:l.refreshTimer.startedAt,attempts:l.refreshTimer.attempts+1,lastAttempt:new Date})}),saveAuthenticationError:U({errors:({errors:l},{data:{error:h}})=>ee(G({},l),{authentication:h})}),resetErrors:U({errors:l=>({})}),saveRegistrationError:U({errors:({errors:l},{data:{error:h}})=>ee(G({},l),{registration:h})}),destroyRefreshToken:U({refreshToken:l=>(u(Fe,null),{value:null})}),cleanUrl:()=>{c&&Ke("refreshToken")&&(nr("refreshToken"),nr("type"))},broadcastToken:l=>{if(c)try{new BroadcastChannel("nhost").postMessage(l.refreshToken.value)}catch{}}},guards:{isAnonymous:(l,h)=>{var v;return!!((v=l.user)!=null&&v.isAnonymous)},isSignedIn:l=>!!l.user&&!!l.refreshToken.value&&!!l.accessToken.value,noToken:l=>!l.refreshToken.value,hasRefreshToken:l=>!!l.refreshToken.value,isAutoRefreshDisabled:()=>!o,refreshTimerShouldRefresh:l=>{const{expiresAt:h}=l.accessToken;return h?l.refreshTimer.lastAttempt?Date.now()-l.refreshTimer.lastAttempt.getTime()>Ur*1e3:a&&Date.now()-l.refreshTimer.startedAt.getTime()>a*1e3?!0:h.getTime()-Date.now()-1e3*Dr<=0:!1},unverified:(l,{data:{error:h}})=>h.status===401&&(h.message==="Email is not verified"||h.error==="unverified-user"),hasSession:(l,h)=>{var v;return!!((v=h.data)!=null&&v.session)},hasMfaTicket:(l,h)=>{var v;return!!((v=h.data)!=null&&v.mfa)}},services:{signInPassword:(l,{email:h,password:v})=>ue(h)?ir(v)?d("/signin/email-password",{email:h,password:v}):Promise.reject({error:ot}):Promise.reject({error:ie}),passwordlessSms:(l,{phoneNumber:h,options:v})=>{var y;return Sn(h)?(y=l.user)!=null&&y.isAnonymous?(console.warn("Deanonymisation from a phone number is not yet implemented in hasura-auth"),d("/user/deanonymize",{signInMethod:"passwordless",connection:"sms",phoneNumber:h,options:re(e,v)},{headers:{authorization:`Bearer ${l.accessToken.value}`}})):d("/signin/passwordless/sms",{phoneNumber:h,options:re(e,v)}):Promise.reject({error:Ft})},passwordlessSmsOtp:(l,{phoneNumber:h,otp:v})=>Sn(h)?d("/signin/passwordless/sms/otp",{phoneNumber:h,otp:v}):Promise.reject({error:Ft}),passwordlessEmail:(l,{email:h,options:v})=>{var y;return ue(h)?(y=l.user)!=null&&y.isAnonymous?d("/user/deanonymize",{signInMethod:"passwordless",connection:"email",email:h,options:re(e,v)},{headers:{authorization:`Bearer ${l.accessToken.value}`}}):d("/signin/passwordless/email",{email:h,options:re(e,v)}):Promise.reject({error:ie})},signInAnonymous:l=>d("/signin/anonymous"),signInMfaTotp:(l,h)=>{var y;const v=h.ticket||((y=l.mfa)==null?void 0:y.ticket);return v?na(v)?d("/signin/mfa/totp",{ticket:v,otp:h.otp}):Promise.reject({error:Fr}):Promise.reject({error:Br})},signInSecurityKeyEmail:async(l,{email:h})=>{if(!ue(h))throw new Ve(ie);const v=await d("/signin/webauthn",{email:h});let y;try{y=await xi(v)}catch(w){throw new Ve(w)}return d("/signin/webauthn/verify",{email:h,credential:y})},refreshToken:async(l,h)=>{const v=h.type==="TRY_TOKEN"?h.token:l.refreshToken.value;return{session:await d("/token",{refreshToken:v}),error:null}},signout:(l,h)=>d("/signout",{refreshToken:l.refreshToken.value,all:!!h.all}),signUpEmailPassword:async(l,{email:h,password:v,options:y})=>{var w;return ue(h)?ir(v)?(w=l.user)!=null&&w.isAnonymous?d("/user/deanonymize",{signInMethod:"email-password",email:h,password:v,options:re(e,y)},{headers:{authorization:`Bearer ${l.accessToken.value}`}}):d("/signup/email-password",{email:h,password:v,options:re(e,y)}):Promise.reject({error:ot}):Promise.reject({error:ie})},signUpSecurityKey:async(l,{email:h,options:v})=>{if(!ue(h))return Promise.reject({error:ie});const y=v==null?void 0:v.nickname;y&&delete v.nickname;const w=await d("/signup/webauthn",{email:h,options:v});let g;try{g=await Cr(w)}catch(S){throw new Ve(S)}return d("/signup/webauthn/verify",{credential:g,options:{redirectTo:v==null?void 0:v.redirectTo,nickname:y}})},importRefreshToken:async()=>{let l=null;if(c){const v=Ke("refreshToken")||null;if(v)try{return{session:await d("/token",{refreshToken:v}),error:null}}catch(y){l=y.error}else{const y=Ke("error");if(y)return Promise.reject({session:null,error:{status:X,error:y,message:Ke("errorDescription")||y}})}}const h=await f(Fe);if(h)try{return{session:await d("/token",{refreshToken:h}),error:null}}catch(v){l=v.error}return Promise.reject({error:l})}}})};class Rn{constructor(f){var u=f,{clientStorageType:e="web",autoSignIn:r=!0,autoRefreshToken:n=!0,start:i=!0,backendUrl:s,clientUrl:a,devTools:o}=u,c=St(u,["clientStorageType","autoSignIn","autoRefreshToken","start","backendUrl","clientUrl","devTools"]);if(this._subscriptions=new Set,this.backendUrl=s,this.clientUrl=a,this.machine=Tn(ee(G({},c),{backendUrl:s,clientUrl:a,clientStorageType:e,autoSignIn:r,autoRefreshToken:n})),i&&(this.interpreter=_r(this.machine,{devTools:o}),this.interpreter.start()),typeof window!="undefined"&&r)try{this._channel=new BroadcastChannel("nhost"),this._channel.addEventListener("message",p=>{var l;const d=(l=this.interpreter)==null?void 0:l.state.context.refreshToken.value;this.interpreter&&p.data!==d&&this.interpreter.send("TRY_TOKEN",{token:p.data})})}catch{}}get interpreter(){return this._interpreter}set interpreter(e){this._interpreter=e,e&&this._subscriptions.forEach(r=>r(this))}onStart(e){this.interpreter?e(this):this._subscriptions.add(e)}}const bn=typeof window!="undefined";class On extends Rn{constructor(r){var e=St(r,[]);super(ee(G({},e),{autoSignIn:bn&&e.autoSignIn,autoRefreshToken:bn&&e.autoRefreshToken,clientStorageType:"cookie"}))}}const ca=On,la=async({backendUrl:t,interpreter:e},r)=>{const n=he(t);try{const{data:i}=await n.post("/user/webauthn/add",{},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});let s;try{s=await Cr(i)}catch(o){throw new Ve(o)}const{data:a}=await n.post("/user/webauthn/verify",{credential:s,nickname:r},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});return{key:a,isError:!1,error:null,isSuccess:!0}}catch(i){const{error:s}=i;return{isError:!0,error:s,isSuccess:!1}}},fa=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,needsEmailVerification:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,needsEmailVerification:!0})})}),da=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{password:e,ticket:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSuccess:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSuccess:!0})})}),ha=t=>new Promise(e=>{t.send("GENERATE"),t.onTransition(r=>{r.matches("generated")?e({error:null,isError:!1,isGenerated:!0,qrCodeDataUrl:r.context.imageUrl||""}):r.matches({idle:"error"})&&e({error:r.context.error||null,isError:!0,isGenerated:!1,qrCodeDataUrl:""})})}),va=(t,e)=>new Promise(r=>{t.send("ACTIVATE",{activeMfaType:"totp",code:e}),t.onTransition(n=>{n.matches({generated:"activated"})?r({error:null,isActivated:!0,isError:!1}):n.matches({generated:{idle:"error"}})&&r({error:n.context.error,isActivated:!1,isError:!0})})}),pa=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),ma=(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),ya=t=>new Promise(e=>{const{changed:r}=t.send("SIGNIN_ANONYMOUS");r||e({isSuccess:!1,isError:!0,error:te,user:null,accessToken:null}),t.onTransition(n=>{n.matches({authentication:"signedIn"})&&e({isSuccess:!0,isError:!1,error:null,user:n.context.user,accessToken:n.context.accessToken.value}),n.matches({authentication:{signedOut:"failed"}})&&e({isSuccess:!1,isError:!0,error:n.context.errors.authentication||null,user:null,accessToken:null})})}),Ea=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_PASSWORD",{email:e,password:r});if(!i)return n({accessToken:s.accessToken.value,error:te,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:s.user});t.onTransition(a=>{a.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,needsMfaOtp:!1,mfa:null,user:null}):a.matches({authentication:{signedOut:"needsMfa"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!0,mfa:a.context.mfa,user:null}):a.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:a.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:null}):a.matches({authentication:"signedIn"})&&n({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:a.context.user})})}),ga=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_EMAIL",{email:e,options:r});if(!i)return n({error:te,isError:!0,isSuccess:!1});t.onTransition(s=>{s.matches("registration.incomplete.failed")?n({error:s.context.errors.registration||null,isError:!0,isSuccess:!1}):s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})&&n({error:null,isError:!1,isSuccess:!0})})}),wa=(t,e)=>new Promise(r=>{const{changed:n,context:i}=t.send({type:"SIGNIN_SECURITY_KEY_EMAIL",email:e});if(!n)return r({accessToken:i.accessToken.value,error:te,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:i.user});t.onTransition(s=>{s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?r({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):s.matches({authentication:{signedOut:"failed"}})?r({accessToken:null,error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):s.matches({authentication:"signedIn"})&&r({accessToken:s.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:s.context.user})})}),Sa=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_MFA_TOTP",{otp:e,ticket:r});if(!i)return n({accessToken:s.accessToken.value,error:te,isError:!0,isSuccess:!1,user:s.user});t.onTransition(a=>{a.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:a.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null}):a.matches({authentication:"signedIn"})&&n({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,user:a.context.user})})}),Ta=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_SMS",{phoneNumber:e,options:r});if(!i)return n({error:te,isError:!0,isSuccess:!1,needsOtp:!1});t.onTransition(s=>{s.matches("registration.incomplete.needsOtp")?n({error:null,isError:!1,isSuccess:!1,needsOtp:!0}):s.matches("registration.incomplete.failed")&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsOtp:!1})})}),Ra=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send({type:"PASSWORDLESS_SMS_OTP",phoneNumber:e,otp:r});if(!i)return n({error:te,isError:!0,isSuccess:!1,user:null,accessToken:null});t.onTransition(s=>{s.matches({authentication:"signedIn"})?n({error:null,isError:!1,isSuccess:!0,user:s.context.user,accessToken:s.context.accessToken.value}):s.matches({registration:{incomplete:"failed"}})&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null,accessToken:null})})}),ba=async(t,e)=>new Promise(r=>{const{event:n}=t.send("SIGNOUT",{all:e});if(n.type!=="SIGNED_OUT")return r({isSuccess:!1,isError:!0,error:Vr});t.onTransition(i=>{i.matches({authentication:{signedOut:"success"}})?r({isSuccess:!0,isError:!1,error:null}):i.matches("authentication.signedOut.failed")&&r({isSuccess:!1,isError:!0,error:i.context.errors.signout||null})})}),Oa=(t,e,r,n)=>new Promise(i=>{const{changed:s,context:a}=t.send("SIGNUP_EMAIL_PASSWORD",{email:e,password:r,options:n});if(!s)return i({error:te,accessToken:a.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:a.user});t.onTransition(o=>{o.matches("registration.incomplete.failed")?i({accessToken:null,error:o.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?i({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):o.matches({authentication:"signedIn",registration:"complete"})&&i({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:o.context.user})})}),Aa=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNUP_SECURITY_KEY",{email:e,options:r});if(!i)return n({error:te,accessToken:s.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:s.user});t.onTransition(a=>{a.matches("registration.incomplete.failed")?n({accessToken:null,error:a.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):a.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):a.matches({authentication:"signedIn",registration:"complete"})&&n({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:a.context.user})})});E.AuthClient=Rn,E.AuthClientSSR=ca,E.AuthCookieClient=On,E.CodifiedError=Ve,E.EMAIL_NEEDS_VERIFICATION=Ci,E.INVALID_EMAIL_ERROR=ie,E.INVALID_MFA_CODE_ERROR=$r,E.INVALID_MFA_TICKET_ERROR=Fr,E.INVALID_MFA_TYPE_ERROR=jr,E.INVALID_PASSWORD_ERROR=ot,E.INVALID_PHONE_NUMBER_ERROR=Ft,E.INVALID_REFRESH_TOKEN=ki,E.MIN_PASSWORD_LENGTH=kr,E.NETWORK_ERROR_CODE=Mr,E.NHOST_JWT_EXPIRES_AT_KEY=Be,E.NHOST_REFRESH_TOKEN_KEY=Fe,E.NO_MFA_TICKET_ERROR=Br,E.NO_REFRESH_TOKEN=Ii,E.OTHER_ERROR_CODE=Lr,E.REFRESH_TOKEN_RETRY_INTERVAL=Ur,E.REFRESH_TOKEN_RETRY_MAX_ATTEMPTS=_i,E.STATE_ERROR_CODE=Te,E.TOKEN_REFRESHER_RUNNING_ERROR=Pi,E.TOKEN_REFRESH_MARGIN=Dr,E.USER_ALREADY_SIGNED_IN=te,E.USER_NOT_ANONYMOUS=Ni,E.USER_UNAUTHENTICATED=Vr,E.VALIDATION_ERROR_CODE=X,E.activateMfaPromise=va,E.addSecurityKeyPromise=la,E.changeEmailPromise=fa,E.changePasswordPromise=da,E.createAuthMachine=Tn,E.createChangeEmailMachine=ia,E.createChangePasswordMachine=sa,E.createEnableMfaMachine=aa,E.createResetPasswordMachine=oa,E.createSendVerificationEmailMachine=ua,E.encodeQueryParameters=wn,E.generateQrCodePromise=ha,E.getParameterByName=Ke,E.localStorageGetter=En,E.localStorageSetter=gn,E.removeParameterFromWindow=nr,E.resetPasswordPromise=pa,E.rewriteRedirectTo=re,E.sendVerificationEmailPromise=ma,E.signInAnonymousPromise=ya,E.signInEmailPasswordPromise=Ea,E.signInEmailPasswordlessPromise=ga,E.signInEmailSecurityKeyPromise=wa,E.signInMfaTotpPromise=Sa,E.signInSmsPasswordlessOtpPromise=Ra,E.signInSmsPasswordlessPromise=Ta,E.signOutPromise=ba,E.signUpEmailPasswordPromise=Oa,E.signUpEmailSecurityKeyPromise=Aa,Object.defineProperties(E,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=core.umd.js.map
