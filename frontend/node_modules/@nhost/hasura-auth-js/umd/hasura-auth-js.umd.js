(function(F,D){typeof exports=="object"&&typeof module!="undefined"?D(exports):typeof define=="function"&&define.amd?define(["exports"],D):(F=typeof globalThis!="undefined"?globalThis:F||self,D(F["@nhost/hasura-auth-js"]={}))})(this,function(F){"use strict";var jo=Object.defineProperty,Lo=Object.defineProperties;var $o=Object.getOwnPropertyDescriptors;var Tn=Object.getOwnPropertySymbols;var Mo=Object.prototype.hasOwnProperty,Bo=Object.prototype.propertyIsEnumerable;var xn=(F,D,H)=>D in F?jo(F,D,{enumerable:!0,configurable:!0,writable:!0,value:H}):F[D]=H,ke=(F,D)=>{for(var H in D||(D={}))Mo.call(D,H)&&xn(F,H,D[H]);if(Tn)for(var H of Tn(D))Bo.call(D,H)&&xn(F,H,D[H]);return F},Ne=(F,D)=>Lo(F,$o(D));function D(t){this.message=t}D.prototype=new Error,D.prototype.name="InvalidCharacterError";var H=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new D("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,i=0,s=0,o="";n=e.charAt(s++);~n&&(r=i%4?64*r+n:n,i++%4)?o+=String.fromCharCode(255&r>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function On(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(r){return decodeURIComponent(H(r).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch{return H(e)}}function He(t){this.message=t}function Rn(t,e){if(typeof t!="string")throw new He("Invalid token specified");var r=(e=e||{}).header===!0?0:1;try{return JSON.parse(On(t.split(".")[r]))}catch(n){throw new He("Invalid token specified: "+n.message)}}He.prototype=new Error,He.prototype.name="InvalidTokenError";/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var m=function(){return m=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},m.apply(this,arguments)};function At(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function x(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function C(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var _;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(_||(_={}));var Ce;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(Ce||(Ce={}));var _t=_.Start,It=_.Stop,We=_.Raise,ze=_.Send,fr=_.Cancel,An=_.NullEvent,Pt=_.Assign;_.After,_.DoneState;var dr=_.Log,_n=_.Init,kt=_.Invoke;_.ErrorExecution;var hr=_.ErrorPlatform,In=_.ErrorCustom,vr=_.Update,Pn=_.Choose,kn=_.Pure,pr=".",yr={},Nt="xstate.guard",Nn="",De=!0,Ge;function Ct(t,e,r){r===void 0&&(r=pr);var n=Ue(t,r),i=Ue(e,r);return R(i)?R(n)?i===n:!1:R(n)?n in i:Object.keys(n).every(function(s){return s in i?Ct(n[s],i[s]):!1})}function mr(t){try{return R(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Dt(t,e){try{return pe(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function Cn(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function Ue(t,e){if(Cn(t))return t.value;if(pe(t))return Je(t);if(typeof t!="string")return t;var r=Dt(t,e);return Je(r)}function Je(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function je(t,e){for(var r={},n=Object.keys(t),i=0;i<n.length;i++){var s=n[i];r[s]=e(t[s],s,t,i)}return r}function gr(t,e,r){var n,i,s={};try{for(var o=x(Object.keys(t)),a=o.next();!a.done;a=o.next()){var c=a.value,f=t[c];!r(f)||(s[c]=e(f,c,t))}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}var Dn=function(t){return function(e){var r,n,i=e;try{for(var s=x(t),o=s.next();!o.done;o=s.next()){var a=o.value;i=i[a]}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}};function Un(t,e){return function(r){var n,i,s=r;try{for(var o=x(t),a=o.next();!a.done;a=o.next()){var c=a.value;s=s[e][c]}}catch(f){n={error:f}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}}function Ye(t){if(!t)return[[]];if(R(t))return[[t]];var e=k(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:Ye(t[r]).map(function(i){return[r].concat(i)})}));return e}function k(t){var e;return(e=[]).concat.apply(e,C([],A(t),!1))}function Er(t){return pe(t)?t:[t]}function Y(t){return t===void 0?[]:Er(t)}function Xe(t,e,r){var n,i;if(I(t))return t(e,r.data);var s={};try{for(var o=x(Object.keys(t)),a=o.next();!a.done;a=o.next()){var c=a.value,f=t[c];I(f)?s[c]=f(e,r.data):s[c]=f}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}function jn(t){return/^(done|error)\./.test(t)}function wr(t){return!!(t instanceof Promise||t!==null&&(I(t)||typeof t=="object")&&I(t.then))}function Ln(t){return t!==null&&typeof t=="object"&&"transition"in t&&typeof t.transition=="function"}function Sr(t,e){var r,n,i=A([[],[]],2),s=i[0],o=i[1];try{for(var a=x(t),c=a.next();!c.done;c=a.next()){var f=c.value;e(f)?s.push(f):o.push(f)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return[s,o]}function br(t,e){return je(t.states,function(r,n){if(!!r){var i=(R(e)?void 0:e[n])||(r?r.current:void 0);if(!!i)return{current:i,states:br(r,i)}}})}function $n(t,e){return{current:e,states:br(t,e)}}function Tr(t,e,r,n){var i=t&&r.reduce(function(s,o){var a,c,f=o.assignment,u={state:n,action:o,_event:e},v={};if(I(f))v=f(s,e.data,u);else try{for(var d=x(Object.keys(f)),l=d.next();!l.done;l=d.next()){var h=l.value,p=f[h];v[h]=I(p)?p(s,e.data,u):p}}catch(y){a={error:y}}finally{try{l&&!l.done&&(c=d.return)&&c.call(d)}finally{if(a)throw a.error}}return Object.assign({},s,v)},t);return i}var Le=function(){};function pe(t){return Array.isArray(t)}function I(t){return typeof t=="function"}function R(t){return typeof t=="string"}function xr(t,e){if(!!t)return R(t)?{type:Nt,name:t,predicate:e?e[t]:void 0}:I(t)?{type:Nt,name:t.name,predicate:t}:t}function Mn(t){try{return"subscribe"in t&&I(t.subscribe)}catch{return!1}}var se=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Ge={},Ge[se]=function(){return this},Ge[Symbol.observable]=function(){return this};function fe(t){return!!t&&"__xstatenode"in t}function Bn(t){return!!t&&typeof t.send=="function"}function Ut(t,e){return R(t)||typeof t=="number"?m({type:t},e):t}function q(t,e){if(!R(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=Ut(t);return m({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function ye(t,e){var r=Er(e).map(function(n){return typeof n=="undefined"||typeof n=="string"||fe(n)?{target:n,event:t}:m(m({},n),{event:t})});return r}function Fn(t){if(!(t===void 0||t===Nn))return Y(t)}function Or(t,e,r,n,i){var s=t.options.guards,o={state:i,cond:e,_event:n};if(e.type===Nt)return((s==null?void 0:s[e.name])||e.predicate)(r,n.data,o);var a=s==null?void 0:s[e.type];if(!a)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return a(r,n.data,o)}function Rr(t){return typeof t=="string"?{type:t}:t}function jt(t,e,r){if(typeof t=="object")return t;var n=function(){};return{next:t,error:e||n,complete:r||n}}function Qe(t,e){return"".concat(t,":invocation[").concat(e,"]")}var Ze=q({type:_n});function Lt(t,e){return e&&e[t]||void 0}function $e(t,e){var r;if(R(t)||typeof t=="number"){var n=Lt(t,e);I(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(I(t))r={type:t.name||t.toString(),exec:t};else{var n=Lt(t.type,e);if(I(n))r=m(m({},t),{exec:n});else if(n){var i=n.type||t.type;r=m(m(m({},n),t),{type:i})}else r=t}return r}var et=function(t,e){if(!t)return[];var r=pe(t)?t:[t];return r.map(function(n){return $e(n,e)})};function $t(t){var e=$e(t);return m(m({id:R(t)?t:e.id},e),{type:e.type})}function qn(t){return R(t)?{type:We,event:t}:Mt(t,{to:Ce.Internal})}function Vn(t){return{type:We,_event:q(t.event)}}function Mt(t,e){return{to:e?e.to:void 0,type:ze,event:I(t)?t:Ut(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:I(t)?t.name:mr(t)}}function Kn(t,e,r,n){var i={_event:r},s=q(I(t.event)?t.event(e,r.data,i):t.event),o;if(R(t.delay)){var a=n&&n[t.delay];o=I(a)?a(e,r.data,i):a}else o=I(t.delay)?t.delay(e,r.data,i):t.delay;var c=I(t.to)?t.to(e,r.data,i):t.to;return m(m({},t),{to:c,_event:s,event:s.data,delay:o})}var Hn=function(t,e,r){return m(m({},t),{value:R(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},Wn=function(t){return{type:fr,sendId:t}};function zn(t){var e=$t(t);return{type:_.Start,activity:e,exec:void 0}}function Gn(t){var e=I(t)?t:$t(t);return{type:_.Stop,activity:e,exec:void 0}}function Jn(t,e,r){var n=I(t.activity)?t.activity(e,r.data):t.activity,i=typeof n=="string"?{id:n}:n,s={type:_.Stop,activity:i};return s}var Yn=function(t){return{type:Pt,assignment:t}};function Xn(t,e){var r=e?"#".concat(e):"";return"".concat(_.After,"(").concat(t,")").concat(r)}function tt(t,e){var r="".concat(_.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function rt(t,e){var r="".concat(_.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Me(t,e){var r="".concat(_.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Bt(t,e,r,n,i,s){s===void 0&&(s=!1);var o=A(s?[[],i]:Sr(i,function(d){return d.type===Pt}),2),a=o[0],c=o[1],f=a.length?Tr(r,n,a,e):r,u=s?[r]:void 0,v=k(c.map(function(d){var l;switch(d.type){case We:return Vn(d);case ze:var h=Kn(d,f,n,t.options.delays);return h;case dr:return Hn(d,f,n);case Pn:{var p=d,y=(l=p.conds.find(function(N){var B=xr(N.cond,t.options.guards);return!B||Or(t,B,f,n,e)}))===null||l===void 0?void 0:l.actions;if(!y)return[];var E=A(Bt(t,e,f,n,et(Y(y),t.options.actions),s),2),g=E[0],w=E[1];return f=w,u==null||u.push(f),g}case kn:{var y=d.get(f,n.data);if(!y)return[];var P=A(Bt(t,e,f,n,et(Y(y),t.options.actions),s),2),O=P[0],U=P[1];return f=U,u==null||u.push(f),O}case It:return Jn(d,f,n);case Pt:{f=Tr(f,n,[d],e),u==null||u.push(f);break}default:var b=$e(d,t.options.actions),S=b.exec;if(S&&u){var T=u.length-1;b=m(m({},b),{exec:function(N){for(var B=[],z=1;z<arguments.length;z++)B[z-1]=arguments[z];S.apply(void 0,C([u[T]],A(B),!1))}})}return b}}).filter(function(d){return!!d}));return[v,f]}var Be=function(t,e){var r=e(t);return r};function Ar(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[se]=function(){return this},e}function Qn(t,e,r,n){var i,s=Rr(t.src),o=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[s.type],a=t.data?Xe(t.data,r,n):void 0,c=o?Zn(o,t.id,a):Ar(t.id);return c.meta=t,c}function Zn(t,e,r){var n=Ar(e);if(n.deferred=!0,fe(t)){var i=n.state=Be(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return i}}return n}function ei(t){try{return typeof t.send=="function"}catch{return!1}}function ti(t){return ei(t)&&"id"in t}function ri(t){var e;return m((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[se]=function(){return this},e),t)}var nt=function(t){return t.type==="atomic"||t.type==="final"};function me(t){return Object.keys(t.states).map(function(e){return t.states[e]}).filter(function(e){return e.type!=="history"})}function _r(t){var e=[t];return nt(t)?e:e.concat(k(me(t).map(_r)))}function ge(t,e){var r,n,i,s,o,a,c,f,u=new Set(t),v=Ft(u),d=new Set(e);try{for(var l=x(d),h=l.next();!h.done;h=l.next())for(var p=h.value,y=p.parent;y&&!d.has(y);)d.add(y),y=y.parent}catch(T){r={error:T}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var E=Ft(d);try{for(var g=x(d),w=g.next();!w.done;w=g.next()){var p=w.value;if(p.type==="compound"&&(!E.get(p)||!E.get(p).length))v.get(p)?v.get(p).forEach(function(N){return d.add(N)}):p.initialStateNodes.forEach(function(N){return d.add(N)});else if(p.type==="parallel")try{for(var P=(o=void 0,x(me(p))),O=P.next();!O.done;O=P.next()){var U=O.value;d.has(U)||(d.add(U),v.get(U)?v.get(U).forEach(function(N){return d.add(N)}):U.initialStateNodes.forEach(function(N){return d.add(N)}))}}catch(N){o={error:N}}finally{try{O&&!O.done&&(a=P.return)&&a.call(P)}finally{if(o)throw o.error}}}}catch(T){i={error:T}}finally{try{w&&!w.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}try{for(var b=x(d),S=b.next();!S.done;S=b.next())for(var p=S.value,y=p.parent;y&&!d.has(y);)d.add(y),y=y.parent}catch(T){c={error:T}}finally{try{S&&!S.done&&(f=b.return)&&f.call(b)}finally{if(c)throw c.error}}return d}function Ir(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(nt(n))return n.key}else return{}}var i={};return r.forEach(function(s){i[s.key]=Ir(s,e)}),i}function Ft(t){var e,r,n=new Map;try{for(var i=x(t),s=i.next();!s.done;s=i.next()){var o=s.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(a){e={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}function ni(t,e){var r=ge([t],e);return Ir(t,Ft(r))}function it(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function ii(t){return C([],A(new Set(k(C([],A(t.map(function(e){return e.ownEvents})),!1)))),!1)}function Fe(t,e){return e.type==="compound"?me(e).some(function(r){return r.type==="final"&&it(t,r)}):e.type==="parallel"?me(e).every(function(r){return Fe(t,r)}):!1}function si(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function Pr(t){return new Set(k(t.map(function(e){return e.tags})))}function kr(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(R(t)||R(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(i){return kr(t[i],e[i])})}function oi(t){return typeof t!="object"||t===null?!1:"value"in t&&"_event"in t}function ai(t,e){var r=t.exec,n=m(m({},t),{exec:r!==void 0?function(){return r(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0});return n}var te=function(){function t(e){var r=this,n;this.actions=[],this.activities=yr,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||yr,this.meta=si(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return ii(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=Ze;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=Ze;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),R(e))return[e];var i=Object.keys(e);return i.concat.apply(i,C([],A(i.map(function(s){return n.toStrings(e[s],r).map(function(o){return s+r+o})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=At(e,["configuration","transitions","tags","machine"]);return m(m({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return Ct(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;Le(!!this.machine);var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),ui={deferEvents:!1},Nr=function(){function t(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=m(m({},ui),e)}return t.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},t.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},t.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(r){throw this.clear(),r}finally{this.processingEvent=!1}},t}(),qt=new Map,ci=0,st={bookId:function(){return"x:".concat(ci++)},register:function(t,e){return qt.set(t,e),t},get:function(t){return qt.get(t)},free:function(t){qt.delete(t)}};function Vt(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function li(){var t=Vt();if(t&&"__xstate__"in t)return t.__xstate__}function fi(t){if(!!Vt()){var e=li();e&&e.register(t)}}function di(t,e){e===void 0&&(e={});var r=t.initialState,n=new Set,i=[],s=!1,o=function(){if(!s){for(s=!0;i.length>0;){var f=i.shift();r=t.transition(r,f,c),n.forEach(function(u){return u.next(r)})}s=!1}},a=ri({id:e.id,send:function(f){i.push(f),o()},getSnapshot:function(){return r},subscribe:function(f,u,v){var d=jt(f,u,v);return n.add(d),d.next(r),{unsubscribe:function(){n.delete(d)}}}}),c={parent:e.parent,self:a,id:e.id||"anonymous",observers:n};return r=t.start?t.start(c):r,a}var hi={sync:!1,autoForward:!1},V;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(V||(V={}));var vi=function(){function t(e,r){var n=this;r===void 0&&(r=t.defaultOptions),this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=V.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(u,v){if(pe(u))return n.batch(u),n.state;var d=q(Ut(u,v));if(n.status===V.Stopped)return n.state;if(n.status!==V.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(d.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(d.data)));return n.scheduler.schedule(function(){n.forward(d);var l=n.nextState(d);n.update(l,d)}),n._state},this.sendTo=function(u,v){var d=n.parent&&(v===Ce.Parent||n.parent.id===v),l=d?n.parent:R(v)?n.children.get(v)||st.get(v):Bn(v)?v:void 0;if(!l){if(!d)throw new Error("Unable to send event to child '".concat(v,"' from service '").concat(n.id,"'."));return}"machine"in l?l.send(m(m({},u),{name:u.name===In?"".concat(Me(n.id)):u.name,origin:n.sessionId})):l.send(u.data)};var i=m(m({},t.defaultOptions),r),s=i.clock,o=i.logger,a=i.parent,c=i.id,f=c!==void 0?c:e.id;this.id=f,this.logger=o,this.clock=s,this.parent=a,this.options=i,this.scheduler=new Nr({deferEvents:this.options.deferEvents}),this.sessionId=st.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:Be(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(e,r){var n,i;try{for(var s=x(e.actions),o=s.next();!o.done;o=s.next()){var a=o.value;this.exec(a,e,r)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.update=function(e,r){var n,i,s,o,a,c,f,u,v=this;if(e._sessionid=this.sessionId,this._state=e,this.options.execute&&this.execute(this.state),this.children.forEach(function(T){v.state.children[T.id]=T}),this.devTools&&this.devTools.send(r.data,e),e.event)try{for(var d=x(this.eventListeners),l=d.next();!l.done;l=d.next()){var h=l.value;h(e.event)}}catch(T){n={error:T}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}try{for(var p=x(this.listeners),y=p.next();!y.done;y=p.next()){var h=y.value;h(e,e.event)}}catch(T){s={error:T}}finally{try{y&&!y.done&&(o=p.return)&&o.call(p)}finally{if(s)throw s.error}}try{for(var E=x(this.contextListeners),g=E.next();!g.done;g=E.next()){var w=g.value;w(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(T){a={error:T}}finally{try{g&&!g.done&&(c=E.return)&&c.call(E)}finally{if(a)throw a.error}}var P=Fe(e.configuration||[],this.machine);if(this.state.configuration&&P){var O=e.configuration.find(function(T){return T.type==="final"&&T.parent===v.machine}),U=O&&O.doneData?Xe(O.doneData,e.context,r):void 0;try{for(var b=x(this.doneListeners),S=b.next();!S.done;S=b.next()){var h=S.value;h(rt(this.id,U))}}catch(T){f={error:T}}finally{try{S&&!S.done&&(u=b.return)&&u.call(b)}finally{if(f)throw f.error}}this.stop()}},t.prototype.onTransition=function(e){return this.listeners.add(e),this.status===V.Running&&e(this.state,this.state.event),this},t.prototype.subscribe=function(e,r,n){var i=this;if(!e)return{unsubscribe:function(){}};var s,o=n;return typeof e=="function"?s=e:(s=e.next.bind(e),o=e.complete.bind(e)),this.listeners.add(s),this.status!==V.NotStarted&&s(this.state),o&&(this.status===V.Stopped?o():this.onDone(o)),{unsubscribe:function(){s&&i.listeners.delete(s),o&&i.doneListeners.delete(o)}}},t.prototype.onEvent=function(e){return this.eventListeners.add(e),this},t.prototype.onSend=function(e){return this.sendListeners.add(e),this},t.prototype.onChange=function(e){return this.contextListeners.add(e),this},t.prototype.onStop=function(e){return this.stopListeners.add(e),this},t.prototype.onDone=function(e){return this.doneListeners.add(e),this},t.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},t.prototype.start=function(e){var r=this;if(this.status===V.Running)return this;this.machine._init(),st.register(this.sessionId,this),this.initialized=!0,this.status=V.Running;var n=e===void 0?this.initialState:Be(this,function(){return oi(e)?r.machine.resolveState(e):r.machine.resolveState(te.from(e,r.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){r.update(n,Ze)}),this},t.prototype.stop=function(){var e,r,n,i,s,o,a,c,f,u,v=this;try{for(var d=x(this.listeners),l=d.next();!l.done;l=d.next()){var h=l.value;this.listeners.delete(h)}}catch(S){e={error:S}}finally{try{l&&!l.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}try{for(var p=x(this.stopListeners),y=p.next();!y.done;y=p.next()){var h=y.value;h(),this.stopListeners.delete(h)}}catch(S){n={error:S}}finally{try{y&&!y.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}try{for(var E=x(this.contextListeners),g=E.next();!g.done;g=E.next()){var h=g.value;this.contextListeners.delete(h)}}catch(S){s={error:S}}finally{try{g&&!g.done&&(o=E.return)&&o.call(E)}finally{if(s)throw s.error}}try{for(var w=x(this.doneListeners),P=w.next();!P.done;P=w.next()){var h=P.value;this.doneListeners.delete(h)}}catch(S){a={error:S}}finally{try{P&&!P.done&&(c=w.return)&&c.call(w)}finally{if(a)throw a.error}}if(!this.initialized)return this;C([],A(this.state.configuration),!1).sort(function(S,T){return T.order-S.order}).forEach(function(S){var T,N;try{for(var B=x(S.definition.exit),z=B.next();!z.done;z=B.next()){var le=z.value;v.exec(le,v.state)}}catch(Rt){T={error:Rt}}finally{try{z&&!z.done&&(N=B.return)&&N.call(B)}finally{if(T)throw T.error}}}),this.children.forEach(function(S){I(S.stop)&&S.stop()}),this.children.clear();try{for(var O=x(Object.keys(this.delayedEventsMap)),U=O.next();!U.done;U=O.next()){var b=U.value;this.clock.clearTimeout(this.delayedEventsMap[b])}}catch(S){f={error:S}}finally{try{U&&!U.done&&(u=O.return)&&u.call(O)}finally{if(f)throw f.error}}return this.scheduler.clear(),this.scheduler=new Nr({deferEvents:this.options.deferEvents}),this.initialized=!1,this.status=V.Stopped,this._initialState=void 0,st.free(this.sessionId),this},t.prototype.batch=function(e){var r=this;if(!(this.status===V.NotStarted&&this.options.deferEvents)){if(this.status!==V.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}this.scheduler.schedule(function(){var n,i,s=r.state,o=!1,a=[],c=function(d){var l=q(d);r.forward(l),s=Be(r,function(){return r.machine.transition(s,l)}),a.push.apply(a,C([],A(s.actions.map(function(h){return ai(h,s)})),!1)),o=o||!!s.changed};try{for(var f=x(e),u=f.next();!u.done;u=f.next()){var v=u.value;c(v)}}catch(d){n={error:d}}finally{try{u&&!u.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}s.changed=o,s.actions=a,r.update(s,q(e[e.length-1]))})},t.prototype.sender=function(e){return this.send.bind(this,e)},t.prototype.nextState=function(e){var r=this,n=q(e);if(n.name.indexOf(hr)===0&&!this.state.nextEvents.some(function(s){return s.indexOf(hr)===0}))throw n.data.data;var i=Be(this,function(){return r.machine.transition(r.state,n)});return i},t.prototype.forward=function(e){var r,n;try{for(var i=x(this.forwardTo),s=i.next();!s.done;s=i.next()){var o=s.value,a=this.children.get(o);if(!a)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));a.send(e)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.defer=function(e){var r=this;this.delayedEventsMap[e.id]=this.clock.setTimeout(function(){e.to?r.sendTo(e._event,e.to):r.send(e._event)},e.delay)},t.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},t.prototype.exec=function(e,r,n){n===void 0&&(n=this.machine.options.actions);var i=r.context,s=r._event,o=e.exec||Lt(e.type,n),a=I(o)?o:o?o.exec:e.exec;if(a)try{return a(i,s.data,{action:e,state:this.state,_event:s})}catch(P){throw this.parent&&this.parent.send({type:"xstate.error",data:P}),P}switch(e.type){case ze:var c=e;if(typeof c.delay=="number"){this.defer(c);return}else c.to?this.sendTo(c._event,c.to):this.send(c._event);break;case fr:this.cancel(e.sendId);break;case _t:{if(this.status!==V.Running)return;var f=e.activity;if(!this.state.activities[f.id||f.type])break;if(f.type===_.Invoke){var u=Rr(f.src),v=this.machine.options.services?this.machine.options.services[u.type]:void 0,d=f.id,l=f.data,h="autoForward"in f?f.autoForward:!!f.forward;if(!v)return;var p=l?Xe(l,i,s):void 0;if(typeof v=="string")return;var y=I(v)?v(i,s.data,{data:p,src:u,meta:f.meta}):v;if(!y)return;var E=void 0;fe(y)&&(y=p?y.withContext(p):y,E={autoForward:h}),this.spawn(y,d,E)}else this.spawnActivity(f);break}case It:{this.stopChild(e.activity.id);break}case dr:var g=e.label,w=e.value;g?this.logger(g,w):this.logger(w);break}},t.prototype.removeChild=function(e){var r;this.children.delete(e),this.forwardTo.delete(e),(r=this.state)===null||r===void 0||delete r.children[e]},t.prototype.stopChild=function(e){var r=this.children.get(e);!r||(this.removeChild(e),I(r.stop)&&r.stop())},t.prototype.spawn=function(e,r,n){if(wr(e))return this.spawnPromise(Promise.resolve(e),r);if(I(e))return this.spawnCallback(e,r);if(ti(e))return this.spawnActor(e,r);if(Mn(e))return this.spawnObservable(e,r);if(fe(e))return this.spawnMachine(e,m(m({},n),{id:r}));if(Ln(e))return this.spawnBehavior(e,r);throw new Error('Unable to spawn entity "'.concat(r,'" of type "').concat(typeof e,'".'))},t.prototype.spawnMachine=function(e,r){var n=this;r===void 0&&(r={});var i=new t(e,m(m({},this.options),{parent:this,id:r.id||e.id})),s=m(m({},hi),r);s.sync&&i.onTransition(function(a){n.send(vr,{state:a,id:i.id})});var o=i;return this.children.set(i.id,o),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(a){n.removeChild(i.id),n.send(q(a,{origin:i.id}))}).start(),o},t.prototype.spawnBehavior=function(e,r){var n=di(e,{id:r,parent:this});return this.children.set(r,n),n},t.prototype.spawnPromise=function(e,r){var n,i=this,s=!1,o;e.then(function(c){s||(o=c,i.removeChild(r),i.send(q(rt(r,c),{origin:r})))},function(c){if(!s){i.removeChild(r);var f=Me(r,c);try{i.send(q(f,{origin:r}))}catch{i.devTools&&i.devTools.send(f,i.state),i.machine.strict&&i.stop()}}});var a=(n={id:r,send:function(){},subscribe:function(c,f,u){var v=jt(c,f,u),d=!1;return e.then(function(l){d||(v.next(l),!d&&v.complete())},function(l){d||v.error(l)}),{unsubscribe:function(){return d=!0}}},stop:function(){s=!0},toJSON:function(){return{id:r}},getSnapshot:function(){return o}},n[se]=function(){return this},n);return this.children.set(r,a),a},t.prototype.spawnCallback=function(e,r){var n,i=this,s=!1,o=new Set,a=new Set,c,f=function(d){c=d,a.forEach(function(l){return l(d)}),!s&&i.send(q(d,{origin:r}))},u;try{u=e(f,function(d){o.add(d)})}catch(d){this.send(Me(r,d))}if(wr(u))return this.spawnPromise(u,r);var v=(n={id:r,send:function(d){return o.forEach(function(l){return l(d)})},subscribe:function(d){var l=jt(d);return a.add(l.next),{unsubscribe:function(){a.delete(l.next)}}},stop:function(){s=!0,I(u)&&u()},toJSON:function(){return{id:r}},getSnapshot:function(){return c}},n[se]=function(){return this},n);return this.children.set(r,v),v},t.prototype.spawnObservable=function(e,r){var n,i=this,s,o=e.subscribe(function(c){s=c,i.send(q(c,{origin:r}))},function(c){i.removeChild(r),i.send(q(Me(r,c),{origin:r}))},function(){i.removeChild(r),i.send(q(rt(r),{origin:r}))}),a=(n={id:r,send:function(){},subscribe:function(c,f,u){return e.subscribe(c,f,u)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:r}}},n[se]=function(){return this},n);return this.children.set(r,a),a},t.prototype.spawnActor=function(e,r){return this.children.set(r,e),e},t.prototype.spawnActivity=function(e){var r=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(!!r){var n=r(this.state.context,e);this.spawnEffect(e.id,n)}},t.prototype.spawnEffect=function(e,r){var n;this.children.set(e,(n={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:r||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},n[se]=function(){return this},n))},t.prototype.attachDev=function(){var e=Vt();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var r=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(m(m({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},r),{features:m({jump:!1,skip:!1},r?r.features:void 0)}),this.machine),this.devTools.init(this.state)}fi(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[se]=function(){return this},t.prototype.getSnapshot=function(){return this.status===V.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,r){return setTimeout(e,r)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},t.interpret=Ee,t}();function Ee(t,e){var r=new vi(t,e);return r}function pi(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function ot(t){return m(m({type:kt},t),{toJSON:function(){t.onDone,t.onError;var e=At(t,["onDone","onError"]);return m(m({},e),{type:kt,src:pi(t.src)})}})}var we="",Kt="#",qe="*",Se={},be=function(t){return t[0]===Kt},yi=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},mi=function(t,e,r){var n=r.slice(0,-1).some(function(s){return!("cond"in s)&&!("in"in s)&&(R(s.target)||fe(s.target))}),i=e===we?"the transient event":"event '".concat(e,"'");Le(!n,"One or more transitions for ".concat(i," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},gi=function(){function t(e,r,n,i){var s=this;n===void 0&&(n="context"in e?e.context:void 0);var o;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(yi(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:pr),this.id=this.config.id||C([this.machine.key],A(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?je(this.config.states,function(f,u){var v,d=new t(f,{},void 0,{parent:s,key:u});return Object.assign(s.idMap,m((v={},v[d.id]=d,v),d.idMap)),d}):Se;var a=0;function c(f){var u,v;f.order=a++;try{for(var d=x(me(f)),l=d.next();!l.done;l=d.next()){var h=l.value;c(h)}}catch(p){u={error:p}}finally{try{l&&!l.done&&(v=d.return)&&v.call(d)}finally{if(u)throw u.error}}}c(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(f){var u=f.event;return u===we}):we in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=Y(this.config.entry||this.config.onEntry).map(function(f){return $e(f)}),this.onExit=Y(this.config.exit||this.config.onExit).map(function(f){return $e(f)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=Y(this.config.invoke).map(function(f,u){var v,d;if(fe(f)){var l=Qe(s.id,u);return s.machine.options.services=m((v={},v[l]=f,v),s.machine.options.services),ot({src:l,id:l})}else if(R(f.src)){var l=f.id||Qe(s.id,u);return ot(m(m({},f),{id:l,src:f.src}))}else if(fe(f.src)||I(f.src)){var l=f.id||Qe(s.id,u);return s.machine.options.services=m((d={},d[l]=f.src,d),s.machine.options.services),ot(m(m({id:l},f),{src:l}))}else{var h=f.src;return ot(m(m({id:Qe(s.id,u)},f),{src:h}))}}),this.activities=Y(this.config.activities).concat(this.invoke).map(function(f){return $t(f)}),this.transition=this.transition.bind(this),this.tags=Y(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||_r(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,i=n.actions,s=n.activities,o=n.guards,a=n.services,c=n.delays;return new t(this.config,{actions:m(m({},i),e.actions),activities:m(m({},s),e.activities),guards:m(m({},o),e.guards),services:m(m({},a),e.services),delays:m(m({},c),e.delays)},r!=null?r:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return I(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:je(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===we,n=this.transitions.filter(function(i){var s=i.eventType===e;return r?s:s||i.eventType===qe});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(s,o){var a=I(s)?"".concat(e.id,":delay[").concat(o,"]"):s,c=Xn(a,e.id);return e.onEntry.push(Mt(c,{delay:s})),e.onExit.push(Wn(c)),c},i=pe(r)?r.map(function(s,o){var a=n(s.delay,o);return m(m({},s),{event:a})}):k(Object.keys(r).map(function(s,o){var a=r[s],c=R(a)?{target:a}:a,f=isNaN(+s)?s:+s,u=n(f,o);return Y(c).map(function(v){return m(m({},v),{event:u,delay:f})})}));return i.map(function(s){var o=s.delay;return m(m({},e.formatTransition(s)),{delay:o})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var i=e instanceof te?e.value:Ue(e,this.delimiter);if(R(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((r={},r[i]=s,r)):[this,this.states[i]]}var o=Object.keys(i),a=[this];return a.push.apply(a,C([],A(k(o.map(function(c){return n.getStateNode(c).getStateNodes(i[c])}))),!1)),a},t.prototype.handles=function(e){var r=mr(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof te?e:te.create(e),n=Array.from(ge([],this.getStateNodes(r.value)));return new te(m(m({},r),{value:this.resolve(r.value),configuration:n,done:Fe(n,this),tags:Pr(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var i=this.getStateNode(e),s=i.next(r,n);return!s||!s.transitions.length?this.next(r,n):s},t.prototype.transitionCompoundNode=function(e,r,n){var i=Object.keys(e),s=this.getStateNode(i[0]),o=s._transition(e[i[0]],r,n);return!o||!o.transitions.length?this.next(r,n):o},t.prototype.transitionParallelNode=function(e,r,n){var i,s,o={};try{for(var a=x(Object.keys(e)),c=a.next();!c.done;c=a.next()){var f=c.value,u=e[f];if(!!u){var v=this.getStateNode(f),d=v._transition(u,r,n);d&&(o[f]=d)}}}catch(g){i={error:g}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}var l=Object.keys(o).map(function(g){return o[g]}),h=k(l.map(function(g){return g.transitions})),p=l.some(function(g){return g.transitions.length>0});if(!p)return this.next(r,n);var y=k(l.map(function(g){return g.entrySet})),E=k(Object.keys(o).map(function(g){return o[g].configuration}));return{transitions:h,entrySet:y,exitSet:k(l.map(function(g){return g.exitSet})),configuration:E,source:r,actions:k(Object.keys(o).map(function(g){return o[g].actions}))}},t.prototype._transition=function(e,r,n){return R(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,q(r))},t.prototype.next=function(e,r){var n,i,s=this,o=r.name,a=[],c=[],f;try{for(var u=x(this.getCandidates(o)),v=u.next();!v.done;v=u.next()){var d=v.value,l=d.cond,h=d.in,p=e.context,y=h?R(h)&&be(h)?e.matches(Ue(this.getStateNodeById(h).path,this.delimiter)):Ct(Ue(h,this.delimiter),Dn(this.path.slice(0,-2))(e.value)):!0,E=!1;try{E=!l||Or(this.machine,l,p,r,e)}catch(O){throw new Error("Unable to evaluate guard '".concat(l.name||l.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(O.message))}if(E&&y){d.target!==void 0&&(c=d.target),a.push.apply(a,C([],A(d.actions),!1)),f=d;break}}}catch(O){n={error:O}}finally{try{v&&!v.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(!!f){if(!c.length)return{transitions:[f],entrySet:[],exitSet:[],configuration:e.value?[this]:[],source:e,actions:a};var g=k(c.map(function(O){return s.getRelativeStateNodes(O,e.historyValue)})),w=!!f.internal,P=w?[]:k(g.map(function(O){return s.nodesFromChild(O)}));return{transitions:[f],entrySet:P,exitSet:w?[]:[this],configuration:g,source:e,actions:a}}},t.prototype.nodesFromChild=function(e){if(e.escapes(this))return[];for(var r=[],n=e;n&&n!==this;)r.push(n),n=n.parent;return r.push(this),r},t.prototype.escapes=function(e){if(this===e)return!1;for(var r=this.parent;r;){if(r===e)return!1;r=r.parent}return!0},t.prototype.getActions=function(e,r,n,i){var s,o,a,c,f=ge([],i?this.getStateNodes(i.value):[this]),u=e.configuration.length?ge(f,e.configuration):f;try{for(var v=x(u),d=v.next();!d.done;d=v.next()){var l=d.value;it(f,l)||e.entrySet.push(l)}}catch(b){s={error:b}}finally{try{d&&!d.done&&(o=v.return)&&o.call(v)}finally{if(s)throw s.error}}try{for(var h=x(f),p=h.next();!p.done;p=h.next()){var l=p.value;(!it(u,l)||it(e.exitSet,l.parent))&&e.exitSet.push(l)}}catch(b){a={error:b}}finally{try{p&&!p.done&&(c=h.return)&&c.call(h)}finally{if(a)throw a.error}}var y=k(e.entrySet.map(function(b){var S=[];if(b.type!=="final")return S;var T=b.parent;if(!T.parent)return S;S.push(tt(b.id,b.doneData),tt(T.id,b.doneData?Xe(b.doneData,r,n):void 0));var N=T.parent;return N.type==="parallel"&&me(N).every(function(B){return Fe(e.configuration,B)})&&S.push(tt(N.id)),S}));e.exitSet.sort(function(b,S){return S.order-b.order}),e.entrySet.sort(function(b,S){return b.order-S.order});var E=new Set(e.entrySet),g=new Set(e.exitSet),w=A([k(Array.from(E).map(function(b){return C(C([],A(b.activities.map(function(S){return zn(S)})),!1),A(b.onEntry),!1)})).concat(y.map(qn)),k(Array.from(g).map(function(b){return C(C([],A(b.onExit),!1),A(b.activities.map(function(S){return Gn(S)})),!1)}))],2),P=w[0],O=w[1],U=et(O.concat(e.actions).concat(P),this.machine.options.actions);return U},t.prototype.transition=function(e,r,n){e===void 0&&(e=this.initialState);var i=q(r),s;if(e instanceof te)s=n===void 0?e:this.resolveState(te.from(e,n));else{var o=R(e)?this.resolve(Je(this.getResolvedPath(e))):this.resolve(e),a=n!=null?n:this.machine.context;s=this.resolveState(te.from(o,a))}if(!De&&i.name===qe)throw new Error("An event cannot have the wildcard type ('".concat(qe,"')"));if(this.strict&&!this.events.includes(i.name)&&!jn(i.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(i.name,"'"));var c=this._transition(s.value,s,i)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:s,actions:[]},f=ge([],this.getStateNodes(s.value)),u=c.configuration.length?ge(f,c.configuration):f;return c.configuration=C([],A(u),!1),this.resolveTransition(c,s,s.context,i)},t.prototype.resolveRaisedTransition=function(e,r,n){var i,s=e.actions;return e=this.transition(e,r),e._event=n,e.event=n.data,(i=e.actions).unshift.apply(i,C([],A(s),!1)),e},t.prototype.resolveTransition=function(e,r,n,i){var s,o,a=this;i===void 0&&(i=Ze);var c=e.configuration,f=!r||e.transitions.length>0,u=f?ni(this.machine,c):void 0,v=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,d=this.getActions(e,n,i,r),l=r?m({},r.activities):{};try{for(var h=x(d),p=h.next();!p.done;p=h.next()){var y=p.value;y.type===_t?l[y.activity.id||y.activity.type]=y:y.type===It&&(l[y.activity.id||y.activity.type]=!1)}}catch(G){s={error:G}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(s)throw s.error}}var E=A(Bt(this,r,n,i,d,this.machine.config.preserveActionOrder),2),g=E[0],w=E[1],P=A(Sr(g,function(G){return G.type===We||G.type===ze&&G.to===Ce.Internal}),2),O=P[0],U=P[1],b=g.filter(function(G){var Pe;return G.type===_t&&((Pe=G.activity)===null||Pe===void 0?void 0:Pe.type)===kt}),S=b.reduce(function(G,Pe){return G[Pe.activity.id]=Qn(Pe.activity,a.machine,w,i),G},r?m({},r.children):{}),T=f?e.configuration:r?r.configuration:[],N=Fe(T,this),B=new te({value:u||r.value,context:w,_event:i,_sessionid:r?r._sessionid:null,historyValue:u?v?$n(v,u):void 0:r?r.historyValue:void 0,history:!u||e.source?r:void 0,actions:u?U:[],activities:u?l:r?r.activities:{},events:[],configuration:T,transitions:e.transitions,children:S,done:N,tags:Pr(T),machine:this}),z=n!==w;B.changed=i.name===vr||z;var le=B.history;le&&delete le.history;var Rt=!N&&(this._transient||c.some(function(G){return G._transient}));if(!f&&(!Rt||i.name===we))return B;var Z=B;if(!N)for(Rt&&(Z=this.resolveRaisedTransition(Z,{type:An},i));O.length;){var Do=O.shift();Z=this.resolveRaisedTransition(Z,Do._event,i)}var Uo=Z.changed||(le?!!Z.actions.length||z||typeof le.value!=typeof Z.value||!kr(Z.value,le.value):void 0);return Z.changed=Uo,Z.history=le,Z},t.prototype.getStateNode=function(e){if(be(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=be(e)?e.slice(Kt.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&be(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=Dt(e,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||Se;switch(this.type){case"parallel":return je(this.initialStateValue,function(s,o){return s?n.getStateNode(o).resolve(e[o]||s):Se});case"compound":if(R(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(r={},r[e]=i.initialStateValue,r):e}return Object.keys(e).length?je(e,function(s,o){return s?n.getStateNode(o).resolve(s):Se}):this.initialStateValue||{};default:return e||Se}},t.prototype.getResolvedPath=function(e){if(be(e)){var r=this.machine.idMap[e.slice(Kt.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return Dt(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=gr(this.states,function(n){return n.initialStateValue||Se},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=nt(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,entrySet:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;R(r.target)?e=be(r.target)?Je(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(nt(this))return[this];if(this.type==="compound"&&!this.initial)return De||Le(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var r=Ye(this.initialStateValue);return k(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=A(e),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var s=this.getStateNode(n);if(s.type==="history")return s.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(!!Object.keys(this.states).length)return{current:e||this.initialStateValue,states:gr(this.states,function(r,n){if(!e)return r.historyValue();var i=R(e)?void 0:e[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?k(Ye(i).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var s=Un(n.path,"states")(e).current;return R(s)?[n.getStateNode(s)]:k(Ye(s).map(function(o){return r.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=k(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,i;if(this.__cache.events)return this.__cache.events;var s=this.states,o=new Set(this.ownEvents);if(s)try{for(var a=x(Object.keys(s)),c=a.next();!c.done;c=a.next()){var f=c.value,u=s[f];if(u.states)try{for(var v=(n=void 0,x(u.events)),d=v.next();!d.done;d=v.next()){var l=d.value;o.add("".concat(l))}}catch(h){n={error:h}}finally{try{d&&!d.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}}catch(h){e={error:h}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!R(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var s=i?r.key+n:n;if(r.parent)try{var o=r.parent.getStateNodeByPath(s);return o}catch(a){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(a.message))}else return r.getStateNodeByPath(s)})},t.prototype.formatTransition=function(e){var r=this,n=Fn(e.target),i="internal"in e?e.internal:n?n.some(function(c){return R(c)&&c[0]===r.delimiter}):!0,s=this.machine.options.guards,o=this.resolveTarget(n),a=m(m({},e),{actions:et(Y(e.actions)),cond:xr(e.cond,s),target:o,source:this,internal:i,eventType:e.event,toJSON:function(){return m(m({},a),{target:a.target?a.target.map(function(c){return"#".concat(c.id)}):void 0,source:"#".concat(r.id)})}});return a},t.prototype.formatTransitions=function(){var e,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,o=qe,a=s[o],c=a===void 0?[]:a,f=At(s,[typeof o=="symbol"?o:o+""]);i=k(Object.keys(f).map(function(g){!De&&g===we&&Le(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var w=ye(g,f[g]);return De||mi(n,g,w),w}).concat(ye(qe,c)))}var u=this.config.always?ye("",this.config.always):[],v=this.config.onDone?ye(String(tt(this.id)),this.config.onDone):[];De||Le(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var d=k(this.invoke.map(function(g){var w=[];return g.onDone&&w.push.apply(w,C([],A(ye(String(rt(g.id)),g.onDone)),!1)),g.onError&&w.push.apply(w,C([],A(ye(String(Me(g.id)),g.onError)),!1)),w})),l=this.after,h=k(C(C(C(C([],A(v),!1),A(d),!1),A(i),!1),A(u),!1).map(function(g){return Y(g).map(function(w){return n.formatTransition(w)})}));try{for(var p=x(l),y=p.next();!y.done;y=p.next()){var E=y.value;h.push(E)}}catch(g){e={error:g}}finally{try{y&&!y.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}return h},t}();function Ve(t,e){return new gi(t,e)}var j=Yn,X=Mt,Ht={exports:{}},Cr=function(e,r){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return e.apply(r,i)}},Ei=Cr,Wt=Object.prototype.toString,zt=function(t){return function(e){var r=Wt.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function de(t){return t=t.toLowerCase(),function(r){return zt(r)===t}}function Gt(t){return Array.isArray(t)}function at(t){return typeof t=="undefined"}function wi(t){return t!==null&&!at(t)&&t.constructor!==null&&!at(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var Dr=de("ArrayBuffer");function Si(t){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Dr(t.buffer),e}function bi(t){return typeof t=="string"}function Ti(t){return typeof t=="number"}function Ur(t){return t!==null&&typeof t=="object"}function ut(t){if(zt(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var xi=de("Date"),Oi=de("File"),Ri=de("Blob"),Ai=de("FileList");function Jt(t){return Wt.call(t)==="[object Function]"}function _i(t){return Ur(t)&&Jt(t.pipe)}function Ii(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||Wt.call(t)===e||Jt(t.toString)&&t.toString()===e)}var Pi=de("URLSearchParams");function ki(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Ni(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function Yt(t,e){if(!(t===null||typeof t=="undefined"))if(typeof t!="object"&&(t=[t]),Gt(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function Xt(){var t={};function e(i,s){ut(t[s])&&ut(i)?t[s]=Xt(t[s],i):ut(i)?t[s]=Xt({},i):Gt(i)?t[s]=i.slice():t[s]=i}for(var r=0,n=arguments.length;r<n;r++)Yt(arguments[r],e);return t}function Ci(t,e,r){return Yt(e,function(i,s){r&&typeof i=="function"?t[s]=Ei(i,r):t[s]=i}),t}function Di(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function Ui(t,e,r,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,r&&Object.assign(t.prototype,r)}function ji(t,e,r){var n,i,s,o={};e=e||{};do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)s=n[i],o[s]||(e[s]=t[s],o[s]=!0);t=Object.getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e}function Li(t,e,r){t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;var n=t.indexOf(e,r);return n!==-1&&n===r}function $i(t){if(!t)return null;var e=t.length;if(at(e))return null;for(var r=new Array(e);e-- >0;)r[e]=t[e];return r}var Mi=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array!="undefined"&&Object.getPrototypeOf(Uint8Array)),$={isArray:Gt,isArrayBuffer:Dr,isBuffer:wi,isFormData:Ii,isArrayBufferView:Si,isString:bi,isNumber:Ti,isObject:Ur,isPlainObject:ut,isUndefined:at,isDate:xi,isFile:Oi,isBlob:Ri,isFunction:Jt,isStream:_i,isURLSearchParams:Pi,isStandardBrowserEnv:Ni,forEach:Yt,merge:Xt,extend:Ci,trim:ki,stripBOM:Di,inherits:Ui,toFlatObject:ji,kindOf:zt,kindOfTest:de,endsWith:Li,toArray:$i,isTypedArray:Mi,isFileList:Ai},Te=$;function jr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Lr=function(e,r,n){if(!r)return e;var i;if(n)i=n(r);else if(Te.isURLSearchParams(r))i=r.toString();else{var s=[];Te.forEach(r,function(c,f){c===null||typeof c=="undefined"||(Te.isArray(c)?f=f+"[]":c=[c],Te.forEach(c,function(v){Te.isDate(v)?v=v.toISOString():Te.isObject(v)&&(v=JSON.stringify(v)),s.push(jr(f)+"="+jr(v))}))}),i=s.join("&")}if(i){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},Bi=$;function ct(){this.handlers=[]}ct.prototype.use=function(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1},ct.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},ct.prototype.forEach=function(e){Bi.forEach(this.handlers,function(n){n!==null&&e(n)})};var Fi=ct,qi=$,Vi=function(e,r){qi.forEach(e,function(i,s){s!==r&&s.toUpperCase()===r.toUpperCase()&&(e[r]=i,delete e[s])})},$r=$;function xe(t,e,r,n,i){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}$r.inherits(xe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Mr=xe.prototype,Br={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){Br[t]={value:t}}),Object.defineProperties(xe,Br),Object.defineProperty(Mr,"isAxiosError",{value:!0}),xe.from=function(t,e,r,n,i,s){var o=Object.create(Mr);return $r.toFlatObject(t,o,function(c){return c!==Error.prototype}),xe.call(o,t.message,e,r,n,i),o.name=t.name,s&&Object.assign(o,s),o};var Oe=xe,Fr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q=$;function Ki(t,e){e=e||new FormData;var r=[];function n(s){return s===null?"":Q.isDate(s)?s.toISOString():Q.isArrayBuffer(s)||Q.isTypedArray(s)?typeof Blob=="function"?new Blob([s]):Buffer.from(s):s}function i(s,o){if(Q.isPlainObject(s)||Q.isArray(s)){if(r.indexOf(s)!==-1)throw Error("Circular reference detected in "+o);r.push(s),Q.forEach(s,function(c,f){if(!Q.isUndefined(c)){var u=o?o+"."+f:f,v;if(c&&!o&&typeof c=="object"){if(Q.endsWith(f,"{}"))c=JSON.stringify(c);else if(Q.endsWith(f,"[]")&&(v=Q.toArray(c))){v.forEach(function(d){!Q.isUndefined(d)&&e.append(u,n(d))});return}}i(c,u)}}),r.pop()}else e.append(o,n(s))}return i(t),e}var qr=Ki,Qt=Oe,Hi=function(e,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):r(new Qt("Request failed with status code "+n.status,[Qt.ERR_BAD_REQUEST,Qt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))},lt=$,Wi=lt.isStandardBrowserEnv()?function(){return{write:function(r,n,i,s,o,a){var c=[];c.push(r+"="+encodeURIComponent(n)),lt.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),lt.isString(s)&&c.push("path="+s),lt.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),zi=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Gi=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e},Ji=zi,Yi=Gi,Vr=function(e,r){return e&&!Ji(r)?Yi(e,r):r},Zt=$,Xi=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Qi=function(e){var r={},n,i,s;return e&&Zt.forEach(e.split(`
`),function(a){if(s=a.indexOf(":"),n=Zt.trim(a.substr(0,s)).toLowerCase(),i=Zt.trim(a.substr(s+1)),n){if(r[n]&&Xi.indexOf(n)>=0)return;n==="set-cookie"?r[n]=(r[n]?r[n]:[]).concat([i]):r[n]=r[n]?r[n]+", "+i:i}}),r},Kr=$,Zi=Kr.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(s){var o=s;return e&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(o){var a=Kr.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}(),er=Oe,es=$;function Hr(t){er.call(this,t==null?"canceled":t,er.ERR_CANCELED),this.name="CanceledError"}es.inherits(Hr,er,{__CANCEL__:!0});var ft=Hr,ts=function(e){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""},Ke=$,rs=Hi,ns=Wi,is=Lr,ss=Vr,os=Qi,as=Zi,us=Fr,re=Oe,cs=ft,ls=ts,Wr=function(e){return new Promise(function(n,i){var s=e.data,o=e.headers,a=e.responseType,c;function f(){e.cancelToken&&e.cancelToken.unsubscribe(c),e.signal&&e.signal.removeEventListener("abort",c)}Ke.isFormData(s)&&Ke.isStandardBrowserEnv()&&delete o["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var v=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(v+":"+d)}var l=ss(e.baseURL,e.url);u.open(e.method.toUpperCase(),is(l,e.params,e.paramsSerializer),!0),u.timeout=e.timeout;function h(){if(!!u){var E="getAllResponseHeaders"in u?os(u.getAllResponseHeaders()):null,g=!a||a==="text"||a==="json"?u.responseText:u.response,w={data:g,status:u.status,statusText:u.statusText,headers:E,config:e,request:u};rs(function(O){n(O),f()},function(O){i(O),f()},w),u=null}}if("onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(h)},u.onabort=function(){!u||(i(new re("Request aborted",re.ECONNABORTED,e,u)),u=null)},u.onerror=function(){i(new re("Network Error",re.ERR_NETWORK,e,u,u)),u=null},u.ontimeout=function(){var g=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",w=e.transitional||us;e.timeoutErrorMessage&&(g=e.timeoutErrorMessage),i(new re(g,w.clarifyTimeoutError?re.ETIMEDOUT:re.ECONNABORTED,e,u)),u=null},Ke.isStandardBrowserEnv()){var p=(e.withCredentials||as(l))&&e.xsrfCookieName?ns.read(e.xsrfCookieName):void 0;p&&(o[e.xsrfHeaderName]=p)}"setRequestHeader"in u&&Ke.forEach(o,function(g,w){typeof s=="undefined"&&w.toLowerCase()==="content-type"?delete o[w]:u.setRequestHeader(w,g)}),Ke.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),a&&a!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(c=function(E){!u||(i(!E||E&&E.type?new cs:E),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(c),e.signal&&(e.signal.aborted?c():e.signal.addEventListener("abort",c))),s||(s=null);var y=ls(l);if(y&&["http","https","file"].indexOf(y)===-1){i(new re("Unsupported protocol "+y+":",re.ERR_BAD_REQUEST,e));return}u.send(s)})},fs=null,L=$,zr=Vi,Gr=Oe,ds=Fr,hs=qr,vs={"Content-Type":"application/x-www-form-urlencoded"};function Jr(t,e){!L.isUndefined(t)&&L.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function ps(){var t;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(t=Wr),t}function ys(t,e,r){if(L.isString(t))try{return(e||JSON.parse)(t),L.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var dt={transitional:ds,adapter:ps(),transformRequest:[function(e,r){if(zr(r,"Accept"),zr(r,"Content-Type"),L.isFormData(e)||L.isArrayBuffer(e)||L.isBuffer(e)||L.isStream(e)||L.isFile(e)||L.isBlob(e))return e;if(L.isArrayBufferView(e))return e.buffer;if(L.isURLSearchParams(e))return Jr(r,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n=L.isObject(e),i=r&&r["Content-Type"],s;if((s=L.isFileList(e))||n&&i==="multipart/form-data"){var o=this.env&&this.env.FormData;return hs(s?{"files[]":e}:e,o&&new o)}else if(n||i==="application/json")return Jr(r,"application/json"),ys(e);return e}],transformResponse:[function(e){var r=this.transitional||dt.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&L.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(s)throw o.name==="SyntaxError"?Gr.from(o,Gr.ERR_BAD_RESPONSE,this,null,this.response):o}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fs},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};L.forEach(["delete","get","head"],function(e){dt.headers[e]={}}),L.forEach(["post","put","patch"],function(e){dt.headers[e]=L.merge(vs)});var tr=dt,ms=$,gs=tr,Es=function(e,r,n){var i=this||gs;return ms.forEach(n,function(o){e=o.call(i,e,r)}),e},Yr=function(e){return!!(e&&e.__CANCEL__)},Xr=$,rr=Es,ws=Yr,Ss=tr,bs=ft;function nr(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new bs}var Ts=function(e){nr(e),e.headers=e.headers||{},e.data=rr.call(e,e.data,e.headers,e.transformRequest),e.headers=Xr.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Xr.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var r=e.adapter||Ss.adapter;return r(e).then(function(i){return nr(e),i.data=rr.call(e,i.data,i.headers,e.transformResponse),i},function(i){return ws(i)||(nr(e),i&&i.response&&(i.response.data=rr.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},W=$,Qr=function(e,r){r=r||{};var n={};function i(u,v){return W.isPlainObject(u)&&W.isPlainObject(v)?W.merge(u,v):W.isPlainObject(v)?W.merge({},v):W.isArray(v)?v.slice():v}function s(u){if(W.isUndefined(r[u])){if(!W.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],r[u])}function o(u){if(!W.isUndefined(r[u]))return i(void 0,r[u])}function a(u){if(W.isUndefined(r[u])){if(!W.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,r[u])}function c(u){if(u in r)return i(e[u],r[u]);if(u in e)return i(void 0,e[u])}var f={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return W.forEach(Object.keys(e).concat(Object.keys(r)),function(v){var d=f[v]||s,l=d(v);W.isUndefined(l)&&d!==c||(n[v]=l)}),n},Zr={version:"0.27.2"},xs=Zr.version,oe=Oe,ir={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){ir[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var en={};ir.transitional=function(e,r,n){function i(s,o){return"[Axios v"+xs+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return function(s,o,a){if(e===!1)throw new oe(i(o," has been removed"+(r?" in "+r:"")),oe.ERR_DEPRECATED);return r&&!en[o]&&(en[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Os(t,e,r){if(typeof t!="object")throw new oe("options must be an object",oe.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),i=n.length;i-- >0;){var s=n[i],o=e[s];if(o){var a=t[s],c=a===void 0||o(a,s,t);if(c!==!0)throw new oe("option "+s+" must be "+c,oe.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new oe("Unknown option "+s,oe.ERR_BAD_OPTION)}}var Rs={assertOptions:Os,validators:ir},tn=$,As=Lr,rn=Fi,nn=Ts,ht=Qr,_s=Vr,sn=Rs,Re=sn.validators;function Ae(t){this.defaults=t,this.interceptors={request:new rn,response:new rn}}Ae.prototype.request=function(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=ht(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&sn.assertOptions(n,{silentJSONParsing:Re.transitional(Re.boolean),forcedJSONParsing:Re.transitional(Re.boolean),clarifyTimeoutError:Re.transitional(Re.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(l){typeof l.runWhen=="function"&&l.runWhen(r)===!1||(s=s&&l.synchronous,i.unshift(l.fulfilled,l.rejected))});var o=[];this.interceptors.response.forEach(function(l){o.push(l.fulfilled,l.rejected)});var a;if(!s){var c=[nn,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(o),a=Promise.resolve(r);c.length;)a=a.then(c.shift(),c.shift());return a}for(var f=r;i.length;){var u=i.shift(),v=i.shift();try{f=u(f)}catch(d){v(d);break}}try{a=nn(f)}catch(d){return Promise.reject(d)}for(;o.length;)a=a.then(o.shift(),o.shift());return a},Ae.prototype.getUri=function(e){e=ht(this.defaults,e);var r=_s(e.baseURL,e.url);return As(r,e.params,e.paramsSerializer)},tn.forEach(["delete","get","head","options"],function(e){Ae.prototype[e]=function(r,n){return this.request(ht(n||{},{method:e,url:r,data:(n||{}).data}))}}),tn.forEach(["post","put","patch"],function(e){function r(n){return function(s,o,a){return this.request(ht(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Ae.prototype[e]=r(),Ae.prototype[e+"Form"]=r(!0)});var Is=Ae,Ps=ft;function _e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(i){e=i});var r=this;this.promise.then(function(n){if(!!r._listeners){var i,s=r._listeners.length;for(i=0;i<s;i++)r._listeners[i](n);r._listeners=null}}),this.promise.then=function(n){var i,s=new Promise(function(o){r.subscribe(o),i=o}).then(n);return s.cancel=function(){r.unsubscribe(i)},s},t(function(i){r.reason||(r.reason=new Ps(i),e(r.reason))})}_e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},_e.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]},_e.prototype.unsubscribe=function(e){if(!!this._listeners){var r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}},_e.source=function(){var e,r=new _e(function(i){e=i});return{token:r,cancel:e}};var ks=_e,Ns=function(e){return function(n){return e.apply(null,n)}},Cs=$,Ds=function(e){return Cs.isObject(e)&&e.isAxiosError===!0},on=$,Us=Cr,vt=Is,js=Qr,Ls=tr;function an(t){var e=new vt(t),r=Us(vt.prototype.request,e);return on.extend(r,vt.prototype,e),on.extend(r,e),r.create=function(i){return an(js(t,i))},r}var K=an(Ls);K.Axios=vt,K.CanceledError=ft,K.CancelToken=ks,K.isCancel=Yr,K.VERSION=Zr.version,K.toFormData=qr,K.AxiosError=Oe,K.Cancel=K.CanceledError,K.all=function(e){return Promise.all(e)},K.spread=Ns,K.isAxiosError=Ds,Ht.exports=K,Ht.exports.default=K;var $s=Ht.exports;/*! js-cookie v3.0.1 | MIT */function pt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}var Ms={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function sr(t,e){function r(i,s,o){if(typeof document!="undefined"){o=pt({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in o)!o[c]||(a+="; "+c,o[c]!==!0&&(a+="="+o[c].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+a}}function n(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],o={},a=0;a<s.length;a++){var c=s[a].split("="),f=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(o[u]=t.read(f,u),i===u)break}catch{}}return i?o[i]:o}}return Object.create({set:r,get:n,remove:function(i,s){r(i,"",pt({},s,{expires:-1}))},withAttributes:function(i){return sr(this.converter,pt({},this.attributes,i))},withConverter:function(i){return sr(pt({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var or=sr(Ms,{path:"/"}),Bs=Object.defineProperty,Fs=Object.defineProperties,qs=Object.getOwnPropertyDescriptors,yt=Object.getOwnPropertySymbols,un=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable,ln=(t,e,r)=>e in t?Bs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,J=(t,e)=>{for(var r in e||(e={}))un.call(e,r)&&ln(t,r,e[r]);if(yt)for(var r of yt(e))cn.call(e,r)&&ln(t,r,e[r]);return t},ne=(t,e)=>Fs(t,qs(e)),fn=(t,e)=>{var r={};for(var n in t)un.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&yt)for(var n of yt(t))e.indexOf(n)<0&&cn.call(t,n)&&(r[n]=t[n]);return r};function Vs(t){return new TextEncoder().encode(t)}function he(t){const e=new Uint8Array(t);let r="";for(const i of e)r+=String.fromCharCode(i);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ar(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4,n=e.padEnd(e.length+r,"="),i=atob(n),s=new ArrayBuffer(i.length),o=new Uint8Array(s);for(let a=0;a<i.length;a++)o[a]=i.charCodeAt(a);return s}function dn(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function hn(t){const{id:e}=t;return ne(J({},t),{id:ar(e),transports:t.transports})}function vn(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}class M extends Error{constructor(e,r="WebAuthnError"){super(e),this.name=r}}function Ks({error:t,options:e}){var r,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new M("Registration ceremony was sent an abort signal","AbortError")}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new M("Discoverable credentials were required but no available authenticator supported it","ConstraintError");if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new M("User verification was required but no available authenticator supported it","ConstraintError")}else{if(t.name==="InvalidStateError")return new M("The authenticator was previously registered","InvalidStateError");if(t.name==="NotAllowedError")return new M("User clicked cancel, or the registration ceremony timed out","NotAllowedError");if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new M('No entry in pubKeyCredParams was of type "public-key"',"NotSupportedError"):new M("No available authenticator supported any of the specified pubKeyCredParams algorithms","NotSupportedError");if(t.name==="SecurityError"){const s=window.location.hostname;if(vn(s)){if(i.rp.id!==s)return new M(`The RP ID "${i.rp.id}" is invalid for this domain`,"SecurityError")}else return new M(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new M("User ID was not between 1 and 64 characters","TypeError")}else if(t.name==="UnknownError")return new M("The authenticator was unable to process the specified options, or could not create a new credential","UnknownError")}return t}class Hs{createNewAbortSignal(){return this.controller&&this.controller.abort(),this.controller=new AbortController,this.controller.signal}reset(){this.controller=void 0}}const mt=new Hs;async function pn(t){if(!dn())throw new Error("WebAuthn is not supported in this browser");const r={publicKey:ne(J({},t),{challenge:ar(t.challenge),user:ne(J({},t.user),{id:Vs(t.user.id)}),excludeCredentials:t.excludeCredentials.map(hn)})};r.signal=mt.createNewAbortSignal();let n;try{n=await navigator.credentials.create(r)}catch(f){throw Ks({error:f,options:r})}finally{mt.reset()}if(!n)throw new Error("Registration was not completed");const{id:i,rawId:s,response:o,type:a}=n,c={id:i,rawId:he(s),response:{attestationObject:he(o.attestationObject),clientDataJSON:he(o.clientDataJSON)},type:a,clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:n.authenticatorAttachment};return typeof o.getTransports=="function"&&(c.transports=o.getTransports()),c}function Ws(t){return new TextDecoder("utf-8").decode(t)}async function zs(){if(navigator.credentials.conditionalMediationSupported)return!0;const t=window.PublicKeyCredential;return t.isConditionalMediationAvailable!==void 0&&t.isConditionalMediationAvailable()}function Gs({error:t,options:e}){var r;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new M("Authentication ceremony was sent an abort signal","AbortError")}else{if(t.name==="NotAllowedError")return!((r=n.allowCredentials)===null||r===void 0)&&r.length?new M("No available authenticator recognized any of the allowed credentials","NotAllowedError"):new M("User clicked cancel, or the authentication ceremony timed out","NotAllowedError");if(t.name==="SecurityError"){const i=window.location.hostname;if(vn(i)){if(n.rpId!==i)return new M(`The RP ID "${n.rpId}" is invalid for this domain`,"SecurityError")}else return new M(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="UnknownError")return new M("The authenticator was unable to process the specified options, or could not create a new assertion signature","UnknownError")}return t}async function Js(t,e=!1){var r,n;if(!dn())throw new Error("WebAuthn is not supported in this browser");let i;((r=t.allowCredentials)===null||r===void 0?void 0:r.length)!==0&&(i=(n=t.allowCredentials)===null||n===void 0?void 0:n.map(hn));const s=ne(J({},t),{challenge:ar(t.challenge),allowCredentials:i}),o={};if(e){if(!await zs())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');o.mediation="conditional",s.allowCredentials=[]}o.publicKey=s,o.signal=mt.createNewAbortSignal();let a;try{a=await navigator.credentials.get(o)}catch(l){throw Gs({error:l,options:o})}finally{mt.reset()}if(!a)throw new Error("Authentication was not completed");const{id:c,rawId:f,response:u,type:v}=a;let d;return u.userHandle&&(d=Ws(u.userHandle)),{id:c,rawId:he(f),response:{authenticatorData:he(u.authenticatorData),clientDataJSON:he(u.clientDataJSON),signature:he(u.signature),userHandle:d},type:v,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:a.authenticatorAttachment}}const gt="nhostRefreshToken",Et="nhostRefreshTokenExpiresAt",Ys=3,Xs=300,Qs=5,Zs=0,eo=1,ae=10,wt=20;class St extends Error{constructor(e){super(e.message),Error.captureStackTrace(this,this.constructor),e instanceof Error?(this.name=e.name,this.error={error:e.name,status:eo,message:e.message}):(this.name=e.error,this.error=e)}}const ue={status:ae,error:"invalid-email",message:"Email is incorrectly formatted"},ur={status:ae,error:"invalid-password",message:"Password is incorrectly formatted"},yn={status:ae,error:"invalid-phone-number",message:"Phone number is incorrectly formatted"},to={status:ae,error:"invalid-mfa-ticket",message:"MFA ticket is invalid"},ro={status:ae,error:"no-mfa-ticket",message:"No MFA ticket has been provided"},no={status:ae,error:"no-refresh-token",message:"No refresh token has been provided"},io={status:wt,error:"refresher-already-running",message:"The token refresher is already running. You must wait until is has finished before submitting a new token."},ie={status:wt,error:"already-signed-in",message:"User is already signed in"},so={status:wt,error:"unauthenticated-user",message:"User is not authenticated"},oo={status:wt,error:"unverified-user",message:"Email needs verification"},ao={status:ae,error:"invalid-refresh-token",message:"Invalid or expired refresh token"},Ie=t=>{const e=$s.create({baseURL:t});return e.interceptors.response.use(r=>r,r=>{var n,i,s,o,a,c,f,u,v,d;return Promise.reject({error:{message:(a=(o=(s=(i=(n=r.response)==null?void 0:n.data)==null?void 0:i.message)!=null?s:r.message)!=null?o:r.request.responseText)!=null?a:JSON.stringify(r),status:(v=(u=(c=r.response)==null?void 0:c.status)!=null?u:(f=r.response)==null?void 0:f.data.statusCode)!=null?v:Zs,error:((d=r.response)==null?void 0:d.data.error)||r.request.statusText||"network"}})}),e},bt=typeof window!="undefined",Tt=new Map,uo=t=>{var e;return bt&&typeof localStorage!="undefined"?localStorage.getItem(t):(e=Tt.get(t))!=null?e:null},co=(t,e)=>{bt&&typeof localStorage!="undefined"?e?localStorage.setItem(t,e):localStorage.removeItem(t):e?Tt.set(t,e):Tt.has(t)&&Tt.delete(t)},lo=(t,e)=>{if(t==="localStorage"||t==="web")return uo;if(t==="cookie")return r=>{var n;return bt&&(n=or.get(r))!=null?n:null};if(!e)throw Error(`clientStorageType is set to '${t}' but no clientStorage has been given`);if(t==="react-native")return r=>{var n;return(n=e.getItem)==null?void 0:n.call(e,r)};if(t==="capacitor")return r=>{var n;return(n=e.get)==null?void 0:n.call(e,{key:r})};if(t==="expo-secure-storage")return r=>{var n;return(n=e.getItemAsync)==null?void 0:n.call(e,r)};if(t==="custom"){if(e.getItem&&e.removeItem)return e.getItem;if(e.getItemAsync)return e.getItemAsync;throw Error(`clientStorageType is set to 'custom' but clientStorage is missing either "getItem" and "removeItem" properties or "getItemAsync" property`)}throw Error(`Unknown storage type: ${t}`)},fo=(t,e)=>{if(t==="localStorage"||t==="web")return co;if(t==="cookie")return(r,n)=>{bt&&(n?or.set(r,n,{expires:30}):or.remove(r))};if(!e)throw Error(`clientStorageType is set to '${t}' but no clienStorage has been given`);if(t==="react-native")return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(t==="capacitor")return(r,n)=>{var i,s;return n?(i=e.set)==null?void 0:i.call(e,{key:r,value:n}):(s=e.remove)==null?void 0:s.call(e,{key:r})};if(t==="expo-secure-storage")return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.deleteItemAsync)==null?void 0:s.call(e,r)};if(t==="custom"){if(!e.removeItem)throw Error("clientStorageType is set to 'custom' but clientStorage is missing a removeItem property");if(e.setItem)return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(e.setItemAsync)return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};throw Error("clientStorageType is set to 'custom' but clientStorage is missing setItem or setItemAsync property")}throw Error(`Unknown storage type: ${t}`)},mn=(t,e)=>{const r=e&&Object.entries(e).map(([n,i])=>{const s=Array.isArray(i)?i.join(","):typeof i=="object"?JSON.stringify(i):i;return`${n}=${encodeURIComponent(s)}`}).join("&");return r?`${t}?${r}`:t},ee=(t,e)=>{if(!(e!=null&&e.redirectTo))return e;const r=e,{redirectTo:n}=r,i=fn(r,["redirectTo"]);if(!t)return n.startsWith("/")?i:e;const s=new URL(t),o=Object.fromEntries(new URLSearchParams(s.search)),a=new URL(n.startsWith("/")?s.origin+n:n),c=new URLSearchParams(a.search);let f=Object.fromEntries(c);n.startsWith("/")&&(f=J(J({},o),f));let u=s.pathname;return a.pathname.length>1&&(u+=a.pathname.slice(1)),ne(J({},i),{redirectTo:mn(a.origin+u,f)})};function xt(t,e){var r;if(!e){if(typeof window=="undefined")return;e=((r=window.location)==null?void 0:r.href)||""}t=t.replace(/[\[\]]/g,"\\$&");const n=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)"),i=n.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function gn(t){var e;if(typeof window=="undefined")return;const r=window==null?void 0:window.location;if(!!r&&r){const n=new URLSearchParams(r.search),i=new URLSearchParams((e=r.hash)==null?void 0:e.slice(1));n.delete(t),i.delete(t);let s=window.location.pathname;Array.from(n).length&&(s+=`?${n.toString()}`),Array.from(i).length&&(s+=`#${i.toString()}`),window.history.pushState({},"",s)}}const ce=t=>!!t&&typeof t=="string"&&!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),cr=t=>!!t&&typeof t=="string"&&t.length>=Ys,En=t=>!!t&&typeof t=="string",ho=t=>t&&typeof t=="string"&&t.match(/^mfaTotp:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i),lr={user:null,mfa:null,accessToken:{value:null,expiresAt:null},refreshTimer:{startedAt:null,attempts:0,lastAttempt:null},refreshToken:{value:null},errors:{}},vo=({backendUrl:t,clientUrl:e,interpreter:r})=>{const n=Ie(t);return Ve({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"changeEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:j({error:i=>ue}),saveRequestError:j({error:(i,{data:{error:s}})=>s}),reportError:X(i=>({type:"ERROR",error:i.error})),reportSuccess:X("SUCCESS")},guards:{invalidEmail:(i,{email:s})=>!ce(s)},services:{requestChange:async(i,{email:s,options:o})=>(await n.post("/user/email/change",{newEmail:s,options:ee(e,o)},{headers:{authorization:`Bearer ${r==null?void 0:r.state.context.accessToken.value}`}})).data}})},po=({backendUrl:t,interpreter:e})=>{const r=Ie(t);return Ve({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidPassword",actions:"saveInvalidPasswordError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidPasswordError:j({error:n=>ur}),saveRequestError:j({error:(n,{data:{error:i}})=>i}),reportError:X(n=>({type:"ERROR",error:n.error})),reportSuccess:X("SUCCESS")},guards:{invalidPassword:(n,{password:i})=>!cr(i)},services:{requestChange:(n,{password:i,ticket:s})=>r.post("/user/password",{newPassword:i,ticket:s},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}})}})},yo=({backendUrl:t,clientUrl:e})=>{const r=Ie(t);return Ve({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:j({error:n=>ue}),saveRequestError:j({error:(n,{data:{error:i}})=>i}),reportError:X(n=>({type:"ERROR",error:n.error})),reportSuccess:X("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!ce(i)},services:{requestChange:(n,{email:i,options:s})=>r.post("/user/password/reset",{email:i,options:ee(e,s)})}})},mo=({backendUrl:t,clientUrl:e})=>{const r=Ie(t);return Ve({schema:{context:{},events:{},services:{}},tsTypes:{},preserveActionOrder:!0,id:"sendVerificationEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"request",id:"request",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:j({error:n=>ue}),saveRequestError:j({error:(n,{data:{error:i}})=>i}),reportError:X(n=>({type:"ERROR",error:n.error})),reportSuccess:X("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!ce(i)},services:{request:async(n,{email:i,options:s})=>(await r.post("/user/email/send-verification-email",{email:i,options:ee(e,s)})).data}})},go=({backendUrl:t,clientUrl:e,clientStorageGetter:r,clientStorageSetter:n,clientStorageType:i="web",clientStorage:s,refreshIntervalTime:o,autoRefreshToken:a=!0,autoSignIn:c=!0})=>{const f=r||lo(i,s),u=n||fo(i,s),v=Ie(t),d=async(l,h,p)=>(await v.post(l,h,p)).data;return Ve({schema:{context:{},events:{},services:{}},tsTypes:{},context:lr,preserveActionOrder:!0,id:"nhost",type:"parallel",states:{authentication:{initial:"starting",on:{SESSION_UPDATE:[{cond:"hasSession",actions:["saveSession","resetTimer","reportTokenChanged"],target:".signedIn"}]},states:{starting:{entry:"resetErrors",tags:["loading"],always:{cond:"isSignedIn",target:"signedIn"},invoke:{id:"importRefreshToken",src:"importRefreshToken",onDone:{actions:["saveSession","reportTokenChanged"],target:"signedIn"},onError:{actions:["saveAuthenticationError"],target:"signedOut"}}},signedOut:{initial:"noErrors",entry:"reportSignedOut",states:{noErrors:{},success:{},needsSmsOtp:{},needsMfa:{},failed:{},signingOut:{entry:["clearContextExceptRefreshToken"],exit:["destroyRefreshToken","reportTokenChanged"],invoke:{src:"signout",id:"signingOut",onDone:{target:"success"},onError:{target:"failed",actions:["saveAuthenticationError"]}}}},on:{SIGNIN_PASSWORD:"authenticating.password",SIGNIN_ANONYMOUS:"authenticating.anonymous",SIGNIN_SECURITY_KEY_EMAIL:"authenticating.securityKeyEmail",SIGNIN_MFA_TOTP:"authenticating.mfa.totp"}},authenticating:{entry:"resetErrors",states:{password:{invoke:{src:"signInPassword",id:"authenticateUserWithPassword",onDone:[{cond:"hasMfaTicket",actions:["saveMfaTicket"],target:"#nhost.authentication.signedOut.needsMfa"},{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"}],onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}},anonymous:{invoke:{src:"signInAnonymous",id:"authenticateAnonymously",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},mfa:{states:{totp:{invoke:{src:"signInMfaTotp",id:"signInMfaTotp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:["saveAuthenticationError"],target:"#nhost.authentication.signedOut.failed"}}}}},securityKeyEmail:{invoke:{src:"signInSecurityKeyEmail",id:"authenticateUserWithSecurityKey",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}}}},signedIn:{type:"parallel",entry:["reportSignedIn","cleanUrl","broadcastToken","resetErrors"],on:{SIGNOUT:"signedOut.signingOut"},states:{refreshTimer:{id:"timer",initial:"idle",states:{disabled:{type:"final"},stopped:{always:{cond:"noToken",target:"idle"}},idle:{always:[{cond:"isAutoRefreshDisabled",target:"disabled"},{cond:"hasRefreshToken",target:"running"}]},running:{initial:"pending",entry:"resetTimer",states:{pending:{after:{"1000":{internal:!1,target:"pending"}},always:{cond:"refreshTimerShouldRefresh",target:"refreshing"}},refreshing:{invoke:{src:"refreshToken",id:"refreshToken",onDone:{actions:["saveSession","resetTimer","reportTokenChanged"],target:"pending"},onError:[{actions:"saveRefreshAttempt",target:"pending"}]}}}}}}}}}},token:{initial:"idle",states:{idle:{on:{TRY_TOKEN:"running"},initial:"noErrors",states:{noErrors:{},error:{}}},running:{invoke:{src:"refreshToken",id:"authenticateWithToken",onDone:{actions:["saveSession","reportTokenChanged"],target:["#nhost.authentication.signedIn","idle.noErrors"]},onError:[{cond:"isSignedIn",target:"idle.error"},{actions:"saveAuthenticationError",target:["#nhost.authentication.signedOut.failed","idle.error"]}]}}}},registration:{initial:"incomplete",on:{SIGNED_IN:[{cond:"isAnonymous",target:".incomplete"},".complete"]},states:{incomplete:{on:{SIGNUP_EMAIL_PASSWORD:"emailPassword",SIGNUP_SECURITY_KEY:"securityKey",PASSWORDLESS_EMAIL:"passwordlessEmail",PASSWORDLESS_SMS:"passwordlessSms",PASSWORDLESS_SMS_OTP:"passwordlessSmsOtp"},initial:"noErrors",states:{noErrors:{},needsEmailVerification:{},needsOtp:{},failed:{}}},emailPassword:{entry:["resetErrors"],invoke:{src:"signUpEmailPassword",id:"signUpEmailPassword",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},securityKey:{entry:["resetErrors"],invoke:{src:"signUpSecurityKey",id:"signUpSecurityKey",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},passwordlessEmail:{entry:["resetErrors"],invoke:{src:"passwordlessEmail",id:"passwordlessEmail",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSms:{entry:["resetErrors"],invoke:{src:"passwordlessSms",id:"passwordlessSms",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsOtp"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSmsOtp:{entry:["resetErrors"],invoke:{src:"passwordlessSmsOtp",id:"passwordlessSmsOtp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},complete:{on:{SIGNED_OUT:"incomplete"}}}}}},{actions:{reportSignedIn:X("SIGNED_IN"),reportSignedOut:X("SIGNED_OUT"),reportTokenChanged:X("TOKEN_CHANGED"),clearContext:j(()=>(u(Et,null),u(gt,null),J({},lr))),clearContextExceptRefreshToken:j(({refreshToken:{value:l}})=>(u(Et,null),ne(J({},lr),{refreshToken:{value:l}}))),saveSession:j({user:(l,{data:h})=>{var p;return((p=h==null?void 0:h.session)==null?void 0:p.user)||null},accessToken:(l,{data:h})=>{if(h.session){const{accessTokenExpiresIn:p,accessToken:y}=h.session,E=new Date(Date.now()+p*1e3);return u(Et,E.toISOString()),{value:y,expiresAt:E}}return u(Et,null),{value:null,expiresAt:null}},refreshToken:(l,{data:h})=>{var p;const y=((p=h.session)==null?void 0:p.refreshToken)||null;return y&&u(gt,y),{value:y}}}),saveMfaTicket:j({mfa:(l,h)=>{var p;return(p=h.data)==null?void 0:p.mfa}}),resetTimer:j({refreshTimer:l=>({startedAt:new Date,attempts:0,lastAttempt:null})}),saveRefreshAttempt:j({refreshTimer:(l,h)=>({startedAt:l.refreshTimer.startedAt,attempts:l.refreshTimer.attempts+1,lastAttempt:new Date})}),saveAuthenticationError:j({errors:({errors:l},{data:{error:h}})=>ne(J({},l),{authentication:h})}),resetErrors:j({errors:l=>({})}),saveRegistrationError:j({errors:({errors:l},{data:{error:h}})=>ne(J({},l),{registration:h})}),destroyRefreshToken:j({refreshToken:l=>(u(gt,null),{value:null})}),cleanUrl:()=>{c&&xt("refreshToken")&&(gn("refreshToken"),gn("type"))},broadcastToken:l=>{if(c)try{new BroadcastChannel("nhost").postMessage(l.refreshToken.value)}catch{}}},guards:{isAnonymous:(l,h)=>{var p;return!!((p=l.user)!=null&&p.isAnonymous)},isSignedIn:l=>!!l.user&&!!l.refreshToken.value&&!!l.accessToken.value,noToken:l=>!l.refreshToken.value,hasRefreshToken:l=>!!l.refreshToken.value,isAutoRefreshDisabled:()=>!a,refreshTimerShouldRefresh:l=>{const{expiresAt:h}=l.accessToken;return h?l.refreshTimer.lastAttempt?Date.now()-l.refreshTimer.lastAttempt.getTime()>Qs*1e3:o&&Date.now()-l.refreshTimer.startedAt.getTime()>o*1e3?!0:h.getTime()-Date.now()-1e3*Xs<=0:!1},unverified:(l,{data:{error:h}})=>h.status===401&&(h.message==="Email is not verified"||h.error==="unverified-user"),hasSession:(l,h)=>{var p;return!!((p=h.data)!=null&&p.session)},hasMfaTicket:(l,h)=>{var p;return!!((p=h.data)!=null&&p.mfa)}},services:{signInPassword:(l,{email:h,password:p})=>ce(h)?cr(p)?d("/signin/email-password",{email:h,password:p}):Promise.reject({error:ur}):Promise.reject({error:ue}),passwordlessSms:(l,{phoneNumber:h,options:p})=>{var y;return En(h)?(y=l.user)!=null&&y.isAnonymous?(console.warn("Deanonymisation from a phone number is not yet implemented in hasura-auth"),d("/user/deanonymize",{signInMethod:"passwordless",connection:"sms",phoneNumber:h,options:ee(e,p)},{headers:{authorization:`Bearer ${l.accessToken.value}`}})):d("/signin/passwordless/sms",{phoneNumber:h,options:ee(e,p)}):Promise.reject({error:yn})},passwordlessSmsOtp:(l,{phoneNumber:h,otp:p})=>En(h)?d("/signin/passwordless/sms/otp",{phoneNumber:h,otp:p}):Promise.reject({error:yn}),passwordlessEmail:(l,{email:h,options:p})=>{var y;return ce(h)?(y=l.user)!=null&&y.isAnonymous?d("/user/deanonymize",{signInMethod:"passwordless",connection:"email",email:h,options:ee(e,p)},{headers:{authorization:`Bearer ${l.accessToken.value}`}}):d("/signin/passwordless/email",{email:h,options:ee(e,p)}):Promise.reject({error:ue})},signInAnonymous:l=>d("/signin/anonymous"),signInMfaTotp:(l,h)=>{var p;const y=h.ticket||((p=l.mfa)==null?void 0:p.ticket);return y?ho(y)?d("/signin/mfa/totp",{ticket:y,otp:h.otp}):Promise.reject({error:to}):Promise.reject({error:ro})},signInSecurityKeyEmail:async(l,{email:h})=>{if(!ce(h))throw new St(ue);const p=await d("/signin/webauthn",{email:h});let y;try{y=await Js(p)}catch(E){throw new St(E)}return d("/signin/webauthn/verify",{email:h,credential:y})},refreshToken:async(l,h)=>{const p=h.type==="TRY_TOKEN"?h.token:l.refreshToken.value;return{session:await d("/token",{refreshToken:p}),error:null}},signout:(l,h)=>d("/signout",{refreshToken:l.refreshToken.value,all:!!h.all}),signUpEmailPassword:async(l,{email:h,password:p,options:y})=>{var E;return ce(h)?cr(p)?(E=l.user)!=null&&E.isAnonymous?d("/user/deanonymize",{signInMethod:"email-password",email:h,password:p,options:ee(e,y)},{headers:{authorization:`Bearer ${l.accessToken.value}`}}):d("/signup/email-password",{email:h,password:p,options:ee(e,y)}):Promise.reject({error:ur}):Promise.reject({error:ue})},signUpSecurityKey:async(l,{email:h,options:p})=>{if(!ce(h))return Promise.reject({error:ue});const y=p==null?void 0:p.nickname;y&&delete p.nickname;const E=await d("/signup/webauthn",{email:h,options:p});let g;try{g=await pn(E)}catch(w){throw new St(w)}return d("/signup/webauthn/verify",{credential:g,options:{redirectTo:p==null?void 0:p.redirectTo,nickname:y}})},importRefreshToken:async()=>{let l=null;if(c){const p=xt("refreshToken")||null;if(p)try{return{session:await d("/token",{refreshToken:p}),error:null}}catch(y){l=y.error}else{const y=xt("error");if(y)return Promise.reject({session:null,error:{status:ae,error:y,message:xt("errorDescription")||y}})}}const h=await f(gt);if(h)try{return{session:await d("/token",{refreshToken:h}),error:null}}catch(p){l=p.error}return Promise.reject({error:l})}}})};class Eo{constructor(e){var r=e,{clientStorageType:n="web",autoSignIn:i=!0,autoRefreshToken:s=!0,start:o=!0,backendUrl:a,clientUrl:c,devTools:f}=r,u=fn(r,["clientStorageType","autoSignIn","autoRefreshToken","start","backendUrl","clientUrl","devTools"]);if(this._subscriptions=new Set,this.backendUrl=a,this.clientUrl=c,this.machine=go(ne(J({},u),{backendUrl:a,clientUrl:c,clientStorageType:n,autoSignIn:i,autoRefreshToken:s})),o&&(this.interpreter=Ee(this.machine,{devTools:f}),this.interpreter.start()),typeof window!="undefined"&&i)try{this._channel=new BroadcastChannel("nhost"),this._channel.addEventListener("message",v=>{var d;const l=(d=this.interpreter)==null?void 0:d.state.context.refreshToken.value;this.interpreter&&v.data!==l&&this.interpreter.send("TRY_TOKEN",{token:v.data})})}catch{}}get interpreter(){return this._interpreter}set interpreter(e){this._interpreter=e,e&&this._subscriptions.forEach(r=>r(this))}onStart(e){this.interpreter?e(this):this._subscriptions.add(e)}}const wo=async({backendUrl:t,interpreter:e},r)=>{const n=Ie(t);try{const{data:i}=await n.post("/user/webauthn/add",{},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});let s;try{s=await pn(i)}catch(a){throw new St(a)}const{data:o}=await n.post("/user/webauthn/verify",{credential:s,nickname:r},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});return{key:o,isError:!1,error:null,isSuccess:!0}}catch(i){const{error:s}=i;return{isError:!0,error:s,isSuccess:!1}}},So=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,needsEmailVerification:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,needsEmailVerification:!0})})}),bo=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{password:e,ticket:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSuccess:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSuccess:!0})})}),To=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),xo=(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),Oo=t=>new Promise(e=>{const{changed:r}=t.send("SIGNIN_ANONYMOUS");r||e({isSuccess:!1,isError:!0,error:ie,user:null,accessToken:null}),t.onTransition(n=>{n.matches({authentication:"signedIn"})&&e({isSuccess:!0,isError:!1,error:null,user:n.context.user,accessToken:n.context.accessToken.value}),n.matches({authentication:{signedOut:"failed"}})&&e({isSuccess:!1,isError:!0,error:n.context.errors.authentication||null,user:null,accessToken:null})})}),Ro=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_PASSWORD",{email:e,password:r});if(!i)return n({accessToken:s.accessToken.value,error:ie,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:s.user});t.onTransition(o=>{o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,needsMfaOtp:!1,mfa:null,user:null}):o.matches({authentication:{signedOut:"needsMfa"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!0,mfa:o.context.mfa,user:null}):o.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:null}):o.matches({authentication:"signedIn"})&&n({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:o.context.user})})}),wn=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_EMAIL",{email:e,options:r});if(!i)return n({error:ie,isError:!0,isSuccess:!1});t.onTransition(s=>{s.matches("registration.incomplete.failed")?n({error:s.context.errors.registration||null,isError:!0,isSuccess:!1}):s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})&&n({error:null,isError:!1,isSuccess:!0})})}),Ao=(t,e)=>new Promise(r=>{const{changed:n,context:i}=t.send({type:"SIGNIN_SECURITY_KEY_EMAIL",email:e});if(!n)return r({accessToken:i.accessToken.value,error:ie,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:i.user});t.onTransition(s=>{s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?r({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):s.matches({authentication:{signedOut:"failed"}})?r({accessToken:null,error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):s.matches({authentication:"signedIn"})&&r({accessToken:s.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:s.context.user})})}),_o=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_MFA_TOTP",{otp:e,ticket:r});if(!i)return n({accessToken:s.accessToken.value,error:ie,isError:!0,isSuccess:!1,user:s.user});t.onTransition(o=>{o.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null}):o.matches({authentication:"signedIn"})&&n({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,user:o.context.user})})}),Sn=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_SMS",{phoneNumber:e,options:r});if(!i)return n({error:ie,isError:!0,isSuccess:!1,needsOtp:!1});t.onTransition(s=>{s.matches("registration.incomplete.needsOtp")?n({error:null,isError:!1,isSuccess:!1,needsOtp:!0}):s.matches("registration.incomplete.failed")&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsOtp:!1})})}),Io=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send({type:"PASSWORDLESS_SMS_OTP",phoneNumber:e,otp:r});if(!i)return n({error:ie,isError:!0,isSuccess:!1,user:null,accessToken:null});t.onTransition(s=>{s.matches({authentication:"signedIn"})?n({error:null,isError:!1,isSuccess:!0,user:s.context.user,accessToken:s.context.accessToken.value}):s.matches({registration:{incomplete:"failed"}})&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null,accessToken:null})})}),Po=async(t,e)=>new Promise(r=>{const{event:n}=t.send("SIGNOUT",{all:e});if(n.type!=="SIGNED_OUT")return r({isSuccess:!1,isError:!0,error:so});t.onTransition(i=>{i.matches({authentication:{signedOut:"success"}})?r({isSuccess:!0,isError:!1,error:null}):i.matches("authentication.signedOut.failed")&&r({isSuccess:!1,isError:!0,error:i.context.errors.signout||null})})}),bn=(t,e,r,n)=>new Promise(i=>{const{changed:s,context:o}=t.send("SIGNUP_EMAIL_PASSWORD",{email:e,password:r,options:n});if(!s)return i({error:ie,accessToken:o.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:o.user});t.onTransition(a=>{a.matches("registration.incomplete.failed")?i({accessToken:null,error:a.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):a.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?i({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):a.matches({authentication:"signedIn",registration:"complete"})&&i({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:a.context.user})})}),ko=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNUP_SECURITY_KEY",{email:e,options:r});if(!i)return n({error:ie,accessToken:s.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:s.user});t.onTransition(o=>{o.matches("registration.incomplete.failed")?n({accessToken:null,error:o.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):o.matches({authentication:"signedIn",registration:"complete"})&&n({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:o.context.user})})}),No=()=>typeof window!="undefined",Ot=t=>!t||!t.accessToken.value||!t.refreshToken.value||!t.accessToken.expiresAt||!t.user?null:{accessToken:t.accessToken.value,accessTokenExpiresIn:(t.accessToken.expiresAt.getTime()-Date.now())/1e3,refreshToken:t.refreshToken.value,user:t.user},ve=({accessToken:t,isError:e,user:r,error:n})=>e?{session:null,error:n}:r&&t?{session:{accessToken:t,accessTokenExpiresIn:0,refreshToken:"",user:r},error:null}:{session:null,error:null};class Co{constructor({url:e,autoRefreshToken:r=!0,autoSignIn:n=!0,autoLogin:i,clientStorage:s,clientStorageType:o,clientStorageGetter:a,clientStorageSetter:c,refreshIntervalTime:f,start:u=!0}){var v;this.url=e,this._client=new Eo({backendUrl:e,clientUrl:typeof window!="undefined"&&((v=window.location)==null?void 0:v.origin)||"",autoRefreshToken:r,autoSignIn:typeof i=="boolean"?i:n,start:u,clientStorage:s,clientStorageType:o,clientStorageGetter:a,clientStorageSetter:c,refreshIntervalTime:f})}async signUp(e){const r=await this.waitUntilReady(),{email:n,options:i}=e;return"securityKey"in e?ve(await ko(r,n,i)):ve(await bn(r,n,e.password,i))}async signIn(e){const r=await this.waitUntilReady();if("provider"in e){const{provider:i,options:s}=e,o=mn(`${this._client.backendUrl}/signin/provider/${i}`,ee(this._client.clientUrl,s));return No()&&(window.location.href=o),{providerUrl:o,provider:i,session:null,mfa:null,error:null}}if("email"in e&&"password"in e){const i=await Ro(r,e.email,e.password);return i.needsEmailVerification?{session:null,mfa:null,error:oo}:i.needsMfaOtp?{session:null,mfa:i.mfa,error:null}:Ne(ke({},ve(i)),{mfa:null})}if("email"in e&&"securityKey"in e){if(e.securityKey!==!0)throw Error("securityKey must be true");const i=await Ao(r,e.email);return Ne(ke({},ve(i)),{mfa:null})}if("email"in e){const{email:i,options:s}=e,{error:o}=await wn(r,i,s);return{session:null,mfa:null,error:o}}if("phoneNumber"in e&&"otp"in e){const i=await Io(r,e.phoneNumber,e.otp);return Ne(ke({},ve(i)),{mfa:null})}if("phoneNumber"in e){const{error:i}=await Sn(r,e.phoneNumber,e.options);return{error:i,mfa:null,session:null}}if("otp"in e){const i=await _o(r,e.otp,e.ticket);return Ne(ke({},ve(i)),{mfa:null})}const n=await Oo(r);return Ne(ke({},ve(n)),{mfa:null})}async signOut(e){const r=await this.waitUntilReady(),{error:n}=await Po(r,e==null?void 0:e.all);return{error:n}}async resetPassword({email:e,options:r}){const n=Ee(yo(this._client)).start(),{error:i}=await To(n,e,r);return{error:i}}async changePassword({newPassword:e,ticket:r}){const n=Ee(po(this._client)).start(),{error:i}=await bo(n,e,r);return{error:i}}async sendVerificationEmail({email:e,options:r}){const n=Ee(mo(this._client)).start(),{error:i}=await xo(n,e,r);return{error:i}}async changeEmail({newEmail:e,options:r}){const n=Ee(vo(this._client)).start(),{error:i}=await So(n,e,r);return{error:i}}async deanonymize(e){const r=await this.waitUntilReady();if(e.signInMethod==="passwordless"){if(e.connection==="email"){const{error:n}=await wn(r,e.email,e.options);return{error:n}}if(e.connection==="sms"){const{error:n}=await Sn(r,e.phoneNumber,e.options);return{error:n}}}if(e.signInMethod==="email-password"){const{error:n}=await bn(r,e.email,e.password,e.options);return{error:n}}throw Error("Unknown deanonymization method")}async addSecurityKey(e){const{error:r,key:n}=await wo(this._client,e);return{error:r,key:n}}onTokenChanged(e){const r=n=>n.onTransition(({event:i,context:s})=>{i.type==="TOKEN_CHANGED"&&e(Ot(s))});if(this._client.interpreter){const n=r(this._client.interpreter);return()=>n.stop()}else return this._client.onStart(n=>{r(n.interpreter)}),()=>{console.log("onTokenChanged was added before the interpreter started. Cannot unsubscribe listener.")}}onAuthStateChanged(e){const r=n=>n.onTransition(({event:i,context:s})=>{(i.type==="SIGNED_IN"||i.type==="SIGNED_OUT")&&e(i.type,Ot(s))});if(this._client.interpreter){const n=r(this._client.interpreter);return()=>n.stop()}else return this._client.onStart(n=>{r(n.interpreter)}),()=>{console.log("onAuthStateChanged was added before the interpreter started. Cannot unsubscribe listener.")}}isAuthenticated(){var e;return!!((e=this._client.interpreter)!=null&&e.state.matches({authentication:"signedIn"}))}async isAuthenticatedAsync(){return(await this.waitUntilReady()).state.matches({authentication:"signedIn"})}getAuthenticationStatus(){return this.isReady()?{isAuthenticated:this.isAuthenticated(),isLoading:!1}:{isAuthenticated:!1,isLoading:!0}}getJWTToken(){return this.getAccessToken()}getAccessToken(){var e,r;return(r=(e=this._client.interpreter)==null?void 0:e.state.context.accessToken.value)!=null?r:void 0}getDecodedAccessToken(){const e=this.getAccessToken();return e?Rn(e):null}getHasuraClaims(){var e;return((e=this.getDecodedAccessToken())==null?void 0:e["https://hasura.io/jwt/claims"])||null}getHasuraClaim(e){var r;return((r=this.getHasuraClaims())==null?void 0:r[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null}async refreshSession(e){try{const r=await this.waitUntilReady();return new Promise(n=>{const i=e||r.state.context.refreshToken.value;if(!i)return n({session:null,error:no});const{changed:s}=r.send("TRY_TOKEN",{token:i});if(!s)return n({session:null,error:io});r.onTransition(o=>{o.matches({token:{idle:"error"}})?n({session:null,error:ao}):o.event.type==="TOKEN_CHANGED"&&n({session:Ot(o.context),error:null})})})}catch(r){return{session:null,error:r.message}}}getSession(){var e,r;return Ot((r=(e=this._client.interpreter)==null?void 0:e.state)==null?void 0:r.context)}getUser(){var e,r,n;return((n=(r=(e=this._client.interpreter)==null?void 0:e.state)==null?void 0:r.context)==null?void 0:n.user)||null}waitUntilReady(){const r=this._client.interpreter;if(!r)throw Error("Auth interpreter not set");return r.state.hasTag("loading")?new Promise((n,i)=>{let s=setTimeout(()=>i(`The state machine is not yet ready after ${15} seconds.`),15e3);r.onTransition(o=>{if(!o.hasTag("loading"))return clearTimeout(s),n(r)})}):Promise.resolve(r)}isReady(){var e,r;return!((r=(e=this._client.interpreter)==null?void 0:e.state)!=null&&r.hasTag("loading"))}get client(){return this._client}}F.HasuraAuthClient=Co,Object.defineProperties(F,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=hasura-auth-js.umd.js.map
