"use strict";var Q=Object.defineProperty,$=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var k=(e,s,t)=>s in e?Q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,w=(e,s)=>{for(var t in s||(s={}))C.call(s,t)&&k(e,t,s[t]);if(x)for(var t of x(s))T.call(s,t)&&k(e,t,s[t]);return e},M=(e,s)=>$(e,B(s));var O=(e,s)=>{var t={};for(var c in e)C.call(e,c)&&s.indexOf(c)<0&&(t[c]=e[c]);if(e!=null&&x)for(var c of x(e))s.indexOf(c)<0&&T.call(e,c)&&(t[c]=e[c]);return t};Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var G=require("@nhost/nhost-js"),W=require("immer"),E=require("react"),r=require("@xstate/react"),y=require("@nhost/core"),Y=require("jwt-decode"),U=require("@nhost/hasura-storage-js");function A(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var z=A(W),X=A(E),Z=A(Y);class b extends G.NhostClient{constructor(s){super(M(w({},s),{start:!1}))}}const P=E.createContext({}),ee=c=>{var h=c,{nhost:e,initial:s}=h,t=O(h,["nhost","initial"]);const m=e.auth.client.machine,a=r.useInterpret(m,{devTools:e.devTools,context:z.default(m.context,l=>{var o,n;s&&(l.user=s.user,l.refreshToken.value=(o=s.refreshToken)!=null?o:null,l.accessToken.value=(n=s.accessToken)!=null?n:null,l.accessToken.expiresAt=new Date(Date.now()+s.accessTokenExpiresIn*1e3))})}).start(),S=E.useRef(!0);return E.useEffect(()=>{S.current?S.current=!1:s&&a.send("SESSION_UPDATE",{data:{session:s}})},[s,a]),e.auth.client.interpreter=a,X.default.createElement(P.Provider,{value:e},t.children)},v=()=>{var t;const s=(t=E.useContext(P).auth)==null?void 0:t.client.interpreter;if(!s)throw Error("No interpreter");return s},L=()=>{const e=v();return r.useSelector(e,s=>s.context.accessToken.value)},I=()=>E.useContext(P),se=()=>{const e=I(),[s,t]=E.useState(null),c=!s,h=!!s,[m,a]=E.useState(!1);return{add:async l=>{a(!0);const o=await y.addSecurityKeyPromise(e.auth.client,l),{error:n}=o;return n&&t(n),a(!1),o},isLoading:m,isSuccess:c,isError:h,error:s}},te=()=>{const e=v(),[s,t]=E.useState(!!e.status&&e.state.matches({authentication:"signedIn"}));return E.useEffect(()=>e.subscribe(h=>{const m=h.matches({authentication:"signedIn"});t(m)}).unsubscribe,[e]),s},N=()=>{const e=v();return r.useSelector(e,s=>({isAuthenticated:s.matches({authentication:"signedIn"}),isLoading:s.hasTag("loading"),error:s.context.errors.authentication||null,isError:s.matches({authentication:{signedOut:"failed"}})}),(s,t)=>s.isAuthenticated===t.isAuthenticated&&s.isLoading===t.isLoading)},re=()=>{const e=v();return r.useSelector(e,s=>s.hasTag("loading"))};function oe(e,s){const t=E.useMemo(()=>typeof e=="string"?e:void 0,[e]),c=E.useMemo(()=>typeof e!="string"?e:s,[e,s]),h=I(),m=E.useMemo(()=>y.createChangeEmailMachine(h.auth.client),[h]),a=r.useInterpret(m),S=r.useSelector(a,u=>u.matches("requesting")),l=r.useSelector(a,u=>u.context.error),o=r.useSelector(a,u=>u.matches("idle.error")),n=r.useSelector(a,u=>u.matches("idle.success"));return{changeEmail:E.useCallback(async(u,g=c)=>y.changeEmailPromise(a,typeof u=="string"?u:t,g),[a,t,c]),isLoading:S,needsEmailVerification:n,isError:o,error:l}}const ne=e=>{const s=I(),t=E.useMemo(()=>y.createChangePasswordMachine(s.auth.client),[s]),c=r.useInterpret(t),h=r.useSelector(c,o=>o.matches({idle:"error"})),m=r.useSelector(c,o=>o.matches({idle:"success"})),a=r.useSelector(c,o=>o.context.error),S=r.useSelector(c,o=>o.matches("requesting"));return{changePassword:o=>y.changePasswordPromise(c,typeof o=="string"?o:e),isLoading:S,isSuccess:m,isError:h,error:a}},ce=()=>{const e=I(),s=E.useMemo(()=>y.createEnableMfaMachine(e.auth.client),[e]),t=r.useInterpret(s),c=r.useSelector(t,u=>u.matches({idle:"error"})||u.matches({generated:{idle:"error"}})),h=r.useSelector(t,u=>u.matches("generating")),m=r.useSelector(t,u=>u.matches("generated")),a=r.useSelector(t,u=>u.matches({generated:"activating"})),S=r.useSelector(t,u=>u.matches({generated:"activated"})),l=r.useSelector(t,u=>u.context.error),o=r.useSelector(t,u=>u.context.imageUrl||"");return{generateQrCode:()=>y.generateQrCodePromise(t),isGenerating:h,qrCodeDataUrl:o,isGenerated:m,activateMfa:u=>y.activateMfaPromise(t,u),isActivating:a,isActivated:S,isError:c,error:l}},R=()=>{const e=L();return e?Z.default(e):null},D=e=>{const s=I(),t=p=>{e.send({type:"ADD",file:p.file,bucketId:p.bucketId||u})},c=p=>U.uploadFilePromise(s,e,{file:p.file,bucketId:p.bucketId||u,id:d,name:g}),h=()=>{e.send("CANCEL")},m=()=>{e.send("DESTROY")},a=r.useSelector(e,p=>p.matches("uploading")),S=r.useSelector(e,p=>p.matches("uploaded")),l=r.useSelector(e,p=>p.matches("error")),o=r.useSelector(e,p=>p.context.error||null),n=r.useSelector(e,p=>p.context.progress),d=r.useSelector(e,p=>p.context.id),u=r.useSelector(e,p=>p.context.bucketId),g=r.useSelector(e,p=>{var i;return(i=p.context.file)==null?void 0:i.name});return{add:t,upload:c,cancel:h,destroy:m,isUploaded:S,isUploading:a,isError:l,error:o,progress:n,id:d,bucketId:u,name:g}},ie=()=>{const e=r.useInterpret(U.createFileUploadMachine);return D(e)},V=()=>{const e=R();return(e==null?void 0:e["https://hasura.io/jwt/claims"])||null},ue=e=>{const s=V();return(s==null?void 0:s[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null},ae=()=>{const e=I(),[s,t]=E.useState([]),c=r.useInterpret(U.createMultipleFilesUploadMachine,{},g=>{g.event.type==="UPLOAD_ERROR"?t(g.context.files.filter(p=>{var i;return(i=p.getSnapshot())==null?void 0:i.context.error})):(g.matches("uploaded")||g.event.type==="CLEAR")&&s.length>0&&t([])}),h=g=>{c.send(w({type:"ADD"},g))},m=g=>U.uploadMultipleFilesPromise(e,c,g),a=()=>{c.send("CANCEL")},S=()=>{c.send("CLEAR")},l=r.useSelector(c,g=>g.matches("uploading")),o=r.useSelector(c,g=>g.matches("uploaded")),n=r.useSelector(c,g=>g.matches("error")),d=r.useSelector(c,g=>g.context.progress),u=r.useSelector(c,g=>g.context.files);return{upload:m,add:h,clear:S,cancel:a,progress:d,isUploaded:o,isUploading:l,files:u,isError:n,errors:s}},_=()=>{const e=v();return r.useSelector(e,s=>s.context.user,(s,t)=>(s&&JSON.stringify(s))===(t&&JSON.stringify(t)))},le=()=>{const{isLoading:e,isAuthenticated:s}=N(),t=_();return E.useMemo(()=>({isLoading:e,isAuthenticated:s,user:t}),[e,s,t])},de=()=>E.useContext(P).auth.client.backendUrl.replace("/v1/auth",""),me=e=>{const[s,t]=E.useState(!0);E.useEffect(()=>{t(!1)},[]);const c=E.useContext(P);return new Proxy({},{get(h,m){return y.encodeQueryParameters(`${c.auth.client.backendUrl}/signin/provider/${m}`,y.rewriteRedirectTo(s?void 0:c.auth.client.clientUrl,e))}})},he=(e,s)=>{const t=typeof e=="string"?e:void 0,c=typeof e!="string"?e:s,h=I(),m=E.useMemo(()=>y.createResetPasswordMachine(h.auth.client),[h]),a=r.useInterpret(m),S=r.useSelector(a,u=>u.matches("requesting")),l=r.useSelector(a,u=>u.context.error),o=r.useSelector(a,u=>u.matches("idle.error")),n=r.useSelector(a,u=>u.matches("idle.success"));return{resetPassword:(u,g=c)=>y.resetPasswordPromise(a,typeof u=="string"?u:t,g),isLoading:S,isSent:n,isError:o,error:l}},ge=(e,s)=>{const t=typeof e=="string"?e:void 0,c=typeof e!="string"?e:s,h=I(),m=E.useMemo(()=>y.createSendVerificationEmailMachine(h.auth.client),[h]),a=r.useInterpret(m),S=r.useSelector(a,u=>u.matches({idle:"error"})),l=r.useSelector(a,u=>u.matches({idle:"success"})),o=r.useSelector(a,u=>u.context.error),n=r.useSelector(a,u=>u.matches("requesting"));return{sendEmail:(u,g=c)=>y.sendVerificationEmailPromise(a,typeof u=="string"?u:t,g),isLoading:n,isSent:l,isError:S,error:o}},Se=()=>{const e=v(),s=()=>y.signInAnonymousPromise(e),t=r.useSelector(e,l=>l.context.errors.authentication||null,(l,o)=>(l==null?void 0:l.error)===(o==null?void 0:o.error)),c=r.useSelector(e,l=>l.matches({authentication:{authenticating:"anonymous"}})),h=r.useSelector(e,l=>l.matches({authentication:"signedIn"})),m=r.useSelector(e,l=>l.matches({authentication:{signedOut:"failed"}})),a=r.useSelector(e,l=>l.context.user,(l,o)=>(l==null?void 0:l.id)===(o==null?void 0:o.id));return{accessToken:r.useSelector(e,l=>l.context.accessToken.value),error:t,isError:m,isLoading:c,isSuccess:h,signInAnonymous:s,user:a}},pe=(e,s,t)=>{const c=v(),h=(i,f)=>y.signInEmailPasswordPromise(c,typeof i=="string"?i:e,typeof f=="string"?f:s),m=i=>y.signInMfaTotpPromise(c,typeof i=="string"?i:t),a=r.useSelector(c,i=>i.context.user,(i,f)=>(i==null?void 0:i.id)===(f==null?void 0:f.id)),S=r.useSelector(c,i=>i.context.accessToken.value),l=r.useSelector(c,i=>i.context.errors.authentication||null,(i,f)=>(i==null?void 0:i.error)===(f==null?void 0:f.error)),o=r.useSelector(c,i=>i.matches({authentication:"signedIn"})),n=r.useSelector(c,i=>i.matches({authentication:{authenticating:"password"}}),(i,f)=>i===f),d=r.useSelector(c,i=>i.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(i,f)=>i===f),u=r.useSelector(c,i=>i.matches({authentication:{signedOut:"needsMfa"}}),(i,f)=>i===f),g=r.useSelector(c,i=>i.matches({authentication:{signedOut:"failed"}}),(i,f)=>i===f),p=r.useSelector(c,i=>i.context.mfa);return{accessToken:S,error:l,isError:g,isLoading:n,isSuccess:o,needsEmailVerification:d,needsMfaOtp:u,mfa:p,sendMfaOtp:m,signInEmailPassword:h,user:a}};function fe(e,s){const t=typeof e=="string"?e:void 0,c=typeof e=="string"?s:e,h=v(),m=(n,d=c)=>y.signInEmailPasswordlessPromise(h,typeof n=="string"?n:t,d),a=r.useSelector(h,n=>n.context.errors.registration||null,(n,d)=>(n==null?void 0:n.error)===(d==null?void 0:d.error)),S=r.useSelector(h,n=>n.matches("registration.passwordlessEmail")),l=r.useSelector(h,n=>n.matches("registration.incomplete.needsEmailVerification")),o=r.useSelector(h,n=>n.matches("registration.incomplete.failed"));return{signInEmailPasswordless:m,isLoading:S,isSuccess:l,isError:o,error:a}}const Ee=()=>{const e=v(),s=o=>y.signInEmailSecurityKeyPromise(e,o),t=r.useSelector(e,o=>o.context.user,(o,n)=>(o==null?void 0:o.id)===(n==null?void 0:n.id)),c=r.useSelector(e,o=>o.context.accessToken.value),h=r.useSelector(e,o=>o.context.errors.authentication||null,(o,n)=>(o==null?void 0:o.error)===(n==null?void 0:n.error)),m=r.useSelector(e,o=>o.matches({authentication:"signedIn"})),a=r.useSelector(e,o=>o.matches({authentication:{authenticating:"securityKeyEmail"}}),(o,n)=>o===n),S=r.useSelector(e,o=>o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(o,n)=>o===n),l=r.useSelector(e,o=>o.matches({authentication:{signedOut:"failed"}}),(o,n)=>o===n);return{accessToken:c,error:h,isError:l,isLoading:a,isSuccess:m,needsEmailVerification:S,signInEmailSecurityKey:s,user:t}};function ye(e){const s=v(),[t,c]=E.useState(""),h=(d,u=e)=>(c(d),y.signInSmsPasswordlessPromise(s,d,u)),m=async(...d)=>{if(d.length===2){const[g,p]=d;return y.signInSmsPasswordlessOtpPromise(s,g,p)}const[u]=d;return y.signInSmsPasswordlessOtpPromise(s,t,u)},a=r.useSelector(s,d=>d.context.errors.registration||null,(d,u)=>(d==null?void 0:d.error)===(u==null?void 0:u.error)),S=r.useSelector(s,d=>d.matches("registration.passwordlessSms")||d.matches("registration.passwordlessSmsOtp")),l=r.useSelector(s,d=>d.matches("authentication.signedIn")),o=r.useSelector(s,d=>d.matches("registration.incomplete.needsOtp")),n=r.useSelector(s,d=>d.matches("registration.incomplete.failed"));return{signInSmsPasswordless:h,sendOtp:m,isLoading:S,isSuccess:l,needsOtp:o,isError:n,error:a}}const ve=(e=!1)=>{const s=v(),t=m=>y.signOutPromise(s,typeof m=="boolean"?m:e),c=r.useSelector(s,m=>m.matches({authentication:{signedOut:"success"}}),(m,a)=>m===a),h=r.useSelector(s,m=>m.context.errors.signout||null,(m,a)=>(m==null?void 0:m.error)===(a==null?void 0:a.error));return{signOut:t,isSuccess:c,error:h}},Ie=(e,s,t)=>{const c=typeof e=="string"?e:void 0,h=typeof s=="string"?s:void 0,m=t||(typeof e!="string"?e:void 0),a=v(),S=r.useSelector(a,i=>!!i.context.errors.registration),l=r.useSelector(a,i=>i.context.errors.registration||null,(i,f)=>(i==null?void 0:i.error)===(f==null?void 0:f.error)),o=r.useSelector(a,i=>i.matches("registration.emailPassword")),n=r.useSelector(a,i=>i.matches("registration.incomplete.needsEmailVerification")),d=r.useSelector(a,i=>i.matches({authentication:"signedIn",registration:"complete"})),u=(i,f=h,J=m)=>y.signUpEmailPasswordPromise(a,typeof i=="string"?i:c,f,J),g=r.useSelector(a,i=>i.context.user,(i,f)=>(i==null?void 0:i.id)===(f==null?void 0:f.id));return{accessToken:r.useSelector(a,i=>i.context.accessToken.value),error:l,isError:S,isLoading:o,isSuccess:d,needsEmailVerification:n,signUpEmailPassword:u,user:g}},Pe=e=>{const s=v(),t=r.useSelector(s,n=>!!n.context.errors.registration),c=r.useSelector(s,n=>n.context.errors.registration||null,(n,d)=>(n==null?void 0:n.error)===(d==null?void 0:d.error)),h=r.useSelector(s,n=>n.matches("registration.securityKey")),m=r.useSelector(s,n=>n.matches("registration.incomplete.needsEmailVerification")),a=r.useSelector(s,n=>n.matches({authentication:"signedIn",registration:"complete"})),S=(n,d=e)=>y.signUpEmailSecurityKeyPromise(s,n,d),l=r.useSelector(s,n=>n.context.user,(n,d)=>(n==null?void 0:n.id)===(d==null?void 0:d.id));return{accessToken:r.useSelector(s,n=>n.context.accessToken.value),error:c,isError:t,isLoading:h,isSuccess:a,needsEmailVerification:m,signUpEmailSecurityKey:S,user:l}},K=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.avatarUrl},(s,t)=>s===t)},xe=K,q=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.defaultRole},(s,t)=>s===t)},Ue=q,F=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.displayName},(s,t)=>s===t)},we=F,j=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.email},(s,t)=>s===t)},Ae=j,ke=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.id},(s,t)=>s===t)},H=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.isAnonymous},(s,t)=>s===t)},Ce=H,Te=()=>{const e=v();return r.useSelector(e,s=>{var t;return(t=s.context.user)==null?void 0:t.locale},(s,t)=>s===t)},Me=()=>{const e=v();return r.useSelector(e,s=>{var t;return((t=s.context.user)==null?void 0:t.roles)||[]},(s,t)=>s.every(c=>t.includes(c)&&t.every(h=>s.includes(h))))};exports.NhostClient=b;exports.NhostReactContext=P;exports.NhostReactProvider=ee;exports.useAccessToken=L;exports.useAddSecurityKey=se;exports.useAuthInterpreter=v;exports.useAuthLoading=re;exports.useAuthenticated=te;exports.useAuthenticationStatus=N;exports.useAvatarUrl=xe;exports.useChangeEmail=oe;exports.useChangePassword=ne;exports.useConfigMfa=ce;exports.useDecodedAccessToken=R;exports.useDefaultRole=Ue;exports.useDisplayName=we;exports.useEmail=Ae;exports.useFileUpload=ie;exports.useFileUploadItem=D;exports.useHasuraClaim=ue;exports.useHasuraClaims=V;exports.useIsAnonymous=Ce;exports.useMultipleFilesUpload=ae;exports.useNhostAuth=le;exports.useNhostBackendUrl=de;exports.useNhostClient=I;exports.useProviderLink=me;exports.useResetPassword=he;exports.useSendVerificationEmail=ge;exports.useSignInAnonymous=Se;exports.useSignInEmailPassword=pe;exports.useSignInEmailPasswordless=fe;exports.useSignInEmailSecurityKey=Ee;exports.useSignInSmsPasswordless=ye;exports.useSignOut=ve;exports.useSignUpEmailPassword=Ie;exports.useSignUpEmailSecurityKeyEmail=Pe;exports.useUserAvatarUrl=K;exports.useUserData=_;exports.useUserDefaultRole=q;exports.useUserDisplayName=F;exports.useUserEmail=j;exports.useUserId=ke;exports.useUserIsAnonymous=H;exports.useUserLocale=Te;exports.useUserRoles=Me;
//# sourceMappingURL=index.cjs.js.map
