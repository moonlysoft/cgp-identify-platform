(function(T,D){typeof exports=="object"&&typeof module!="undefined"?D(exports):typeof define=="function"&&define.amd?define(["exports"],D):(T=typeof globalThis!="undefined"?globalThis:T||self,D(T["@nhost/hasura-storage-js"]={}))})(this,function(T){"use strict";var ra=Object.defineProperty,na=Object.defineProperties;var ia=Object.getOwnPropertyDescriptors;var Jr=Object.getOwnPropertySymbols;var aa=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable;var zr=(T,D,k)=>D in T?ra(T,D,{enumerable:!0,configurable:!0,writable:!0,value:k}):T[D]=k,G=(T,D)=>{for(var k in D||(D={}))aa.call(D,k)&&zr(T,k,D[k]);if(Jr)for(var k of Jr(D))oa.call(D,k)&&zr(T,k,D[k]);return T},Ae=(T,D)=>na(T,ia(D));var D={exports:{}},k=function(e,r){return function(){for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];return e.apply(r,i)}},Vr=k,Ke=Object.prototype.toString,Qe=function(t){return function(e){var r=Ke.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function Z(t){return t=t.toLowerCase(),function(r){return Qe(r)===t}}function Ze(t){return Array.isArray(t)}function Re(t){return typeof t=="undefined"}function Wr(t){return t!==null&&!Re(t)&&t.constructor!==null&&!Re(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var Rt=Z("ArrayBuffer");function Gr(t){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Rt(t.buffer),e}function Xr(t){return typeof t=="string"}function Yr(t){return typeof t=="number"}function Pt(t){return t!==null&&typeof t=="object"}function Pe(t){if(Qe(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var Kr=Z("Date"),Qr=Z("File"),Zr=Z("Blob"),en=Z("FileList");function et(t){return Ke.call(t)==="[object Function]"}function tn(t){return Pt(t)&&et(t.pipe)}function rn(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||Ke.call(t)===e||et(t.toString)&&t.toString()===e)}var nn=Z("URLSearchParams");function an(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function on(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function tt(t,e){if(!(t===null||typeof t=="undefined"))if(typeof t!="object"&&(t=[t]),Ze(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function rt(){var t={};function e(i,a){Pe(t[a])&&Pe(i)?t[a]=rt(t[a],i):Pe(i)?t[a]=rt({},i):Ze(i)?t[a]=i.slice():t[a]=i}for(var r=0,n=arguments.length;r<n;r++)tt(arguments[r],e);return t}function sn(t,e,r){return tt(e,function(i,a){r&&typeof i=="function"?t[a]=Vr(i,r):t[a]=i}),t}function un(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function ln(t,e,r,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,r&&Object.assign(t.prototype,r)}function fn(t,e,r){var n,i,a,o={};e=e||{};do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)a=n[i],o[a]||(e[a]=t[a],o[a]=!0);t=Object.getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e}function cn(t,e,r){t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;var n=t.indexOf(e,r);return n!==-1&&n===r}function dn(t){if(!t)return null;var e=t.length;if(Re(e))return null;for(var r=new Array(e);e-- >0;)r[e]=t[e];return r}var hn=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array!="undefined"&&Object.getPrototypeOf(Uint8Array)),L={isArray:Ze,isArrayBuffer:Rt,isBuffer:Wr,isFormData:rn,isArrayBufferView:Gr,isString:Xr,isNumber:Yr,isObject:Pt,isPlainObject:Pe,isUndefined:Re,isDate:Kr,isFile:Qr,isBlob:Zr,isFunction:et,isStream:tn,isURLSearchParams:nn,isStandardBrowserEnv:on,forEach:tt,merge:rt,extend:sn,trim:an,stripBOM:un,inherits:ln,toFlatObject:fn,kindOf:Qe,kindOfTest:Z,endsWith:cn,toArray:dn,isTypedArray:hn,isFileList:en},te=L;function Tt(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Nt=function(e,r,n){if(!r)return e;var i;if(n)i=n(r);else if(te.isURLSearchParams(r))i=r.toString();else{var a=[];te.forEach(r,function(l,f){l===null||typeof l=="undefined"||(te.isArray(l)?f=f+"[]":l=[l],te.forEach(l,function(d){te.isDate(d)?d=d.toISOString():te.isObject(d)&&(d=JSON.stringify(d)),a.push(Tt(f)+"="+Tt(d))}))}),i=a.join("&")}if(i){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},vn=L;function Te(){this.handlers=[]}Te.prototype.use=function(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1},Te.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Te.prototype.forEach=function(e){vn.forEach(this.handlers,function(n){n!==null&&e(n)})};var pn=Te,yn=L,mn=function(e,r){yn.forEach(e,function(i,a){a!==r&&a.toUpperCase()===r.toUpperCase()&&(e[r]=i,delete e[a])})},Dt=L;function re(t,e,r,n,i){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}Dt.inherits(re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Ut=re.prototype,Ct={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){Ct[t]={value:t}}),Object.defineProperties(re,Ct),Object.defineProperty(Ut,"isAxiosError",{value:!0}),re.from=function(t,e,r,n,i,a){var o=Object.create(Ut);return Dt.toFlatObject(t,o,function(l){return l!==Error.prototype}),re.call(o,t.message,e,r,n,i),o.name=t.name,a&&Object.assign(o,a),o};var ne=re,_t={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},J=L;function gn(t,e){e=e||new FormData;var r=[];function n(a){return a===null?"":J.isDate(a)?a.toISOString():J.isArrayBuffer(a)||J.isTypedArray(a)?typeof Blob=="function"?new Blob([a]):Buffer.from(a):a}function i(a,o){if(J.isPlainObject(a)||J.isArray(a)){if(r.indexOf(a)!==-1)throw Error("Circular reference detected in "+o);r.push(a),J.forEach(a,function(l,f){if(!J.isUndefined(l)){var u=o?o+"."+f:f,d;if(l&&!o&&typeof l=="object"){if(J.endsWith(f,"{}"))l=JSON.stringify(l);else if(J.endsWith(f,"[]")&&(d=J.toArray(l))){d.forEach(function(c){!J.isUndefined(c)&&e.append(u,n(c))});return}}i(l,u)}}),r.pop()}else e.append(o,n(a))}return i(t),e}var jt=gn,nt=ne,En=function(e,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):r(new nt("Request failed with status code "+n.status,[nt.ERR_BAD_REQUEST,nt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))},Ne=L,Sn=Ne.isStandardBrowserEnv()?function(){return{write:function(r,n,i,a,o,s){var l=[];l.push(r+"="+encodeURIComponent(n)),Ne.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),Ne.isString(a)&&l.push("path="+a),Ne.isString(o)&&l.push("domain="+o),s===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),wn=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},bn=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e},xn=wn,On=bn,Lt=function(e,r){return e&&!xn(r)?On(e,r):r},it=L,An=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Rn=function(e){var r={},n,i,a;return e&&it.forEach(e.split(`
`),function(s){if(a=s.indexOf(":"),n=it.trim(s.substr(0,a)).toLowerCase(),i=it.trim(s.substr(a+1)),n){if(r[n]&&An.indexOf(n)>=0)return;n==="set-cookie"?r[n]=(r[n]?r[n]:[]).concat([i]):r[n]=r[n]?r[n]+", "+i:i}}),r},$t=L,Pn=$t.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(a){var o=a;return e&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(o){var s=$t.isString(o)?i(o):o;return s.protocol===n.protocol&&s.host===n.host}}():function(){return function(){return!0}}(),at=ne,Tn=L;function It(t){at.call(this,t==null?"canceled":t,at.ERR_CANCELED),this.name="CanceledError"}Tn.inherits(It,at,{__CANCEL__:!0});var De=It,Nn=function(e){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""},me=L,Dn=En,Un=Sn,Cn=Nt,_n=Lt,jn=Rn,Ln=Pn,$n=_t,X=ne,In=De,Fn=Nn,Ft=function(e){return new Promise(function(n,i){var a=e.data,o=e.headers,s=e.responseType,l;function f(){e.cancelToken&&e.cancelToken.unsubscribe(l),e.signal&&e.signal.removeEventListener("abort",l)}me.isFormData(a)&&me.isStandardBrowserEnv()&&delete o["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var d=e.auth.username||"",c=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(d+":"+c)}var h=_n(e.baseURL,e.url);u.open(e.method.toUpperCase(),Cn(h,e.params,e.paramsSerializer),!0),u.timeout=e.timeout;function g(){if(!!u){var x="getAllResponseHeaders"in u?jn(u.getAllResponseHeaders()):null,p=!s||s==="text"||s==="json"?u.responseText:u.response,E={data:p,status:u.status,statusText:u.statusText,headers:x,config:e,request:u};Dn(function(R){n(R),f()},function(R){i(R),f()},E),u=null}}if("onloadend"in u?u.onloadend=g:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(g)},u.onabort=function(){!u||(i(new X("Request aborted",X.ECONNABORTED,e,u)),u=null)},u.onerror=function(){i(new X("Network Error",X.ERR_NETWORK,e,u,u)),u=null},u.ontimeout=function(){var p=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",E=e.transitional||$n;e.timeoutErrorMessage&&(p=e.timeoutErrorMessage),i(new X(p,E.clarifyTimeoutError?X.ETIMEDOUT:X.ECONNABORTED,e,u)),u=null},me.isStandardBrowserEnv()){var y=(e.withCredentials||Ln(h))&&e.xsrfCookieName?Un.read(e.xsrfCookieName):void 0;y&&(o[e.xsrfHeaderName]=y)}"setRequestHeader"in u&&me.forEach(o,function(p,E){typeof a=="undefined"&&E.toLowerCase()==="content-type"?delete o[E]:u.setRequestHeader(E,p)}),me.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),s&&s!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(l=function(x){!u||(i(!x||x&&x.type?new In:x),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(l),e.signal&&(e.signal.aborted?l():e.signal.addEventListener("abort",l))),a||(a=null);var m=Fn(h);if(m&&["http","https","file"].indexOf(m)===-1){i(new X("Unsupported protocol "+m+":",X.ERR_BAD_REQUEST,e));return}u.send(a)})},kn=null,j=L,kt=mn,Bt=ne,Bn=_t,Mn=jt,Hn={"Content-Type":"application/x-www-form-urlencoded"};function Mt(t,e){!j.isUndefined(t)&&j.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function qn(){var t;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(t=Ft),t}function Jn(t,e,r){if(j.isString(t))try{return(e||JSON.parse)(t),j.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var Ue={transitional:Bn,adapter:qn(),transformRequest:[function(e,r){if(kt(r,"Accept"),kt(r,"Content-Type"),j.isFormData(e)||j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return Mt(r,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n=j.isObject(e),i=r&&r["Content-Type"],a;if((a=j.isFileList(e))||n&&i==="multipart/form-data"){var o=this.env&&this.env.FormData;return Mn(a?{"files[]":e}:e,o&&new o)}else if(n||i==="application/json")return Mt(r,"application/json"),Jn(e);return e}],transformResponse:[function(e){var r=this.transitional||Ue.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,a=!n&&this.responseType==="json";if(a||i&&j.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?Bt.from(o,Bt.ERR_BAD_RESPONSE,this,null,this.response):o}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kn},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};j.forEach(["delete","get","head"],function(e){Ue.headers[e]={}}),j.forEach(["post","put","patch"],function(e){Ue.headers[e]=j.merge(Hn)});var ot=Ue,zn=L,Vn=ot,Wn=function(e,r,n){var i=this||Vn;return zn.forEach(n,function(o){e=o.call(i,e,r)}),e},Ht=function(e){return!!(e&&e.__CANCEL__)},qt=L,st=Wn,Gn=Ht,Xn=ot,Yn=De;function ut(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Yn}var Kn=function(e){ut(e),e.headers=e.headers||{},e.data=st.call(e,e.data,e.headers,e.transformRequest),e.headers=qt.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),qt.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var r=e.adapter||Xn.adapter;return r(e).then(function(i){return ut(e),i.data=st.call(e,i.data,i.headers,e.transformResponse),i},function(i){return Gn(i)||(ut(e),i&&i.response&&(i.response.data=st.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},B=L,Jt=function(e,r){r=r||{};var n={};function i(u,d){return B.isPlainObject(u)&&B.isPlainObject(d)?B.merge(u,d):B.isPlainObject(d)?B.merge({},d):B.isArray(d)?d.slice():d}function a(u){if(B.isUndefined(r[u])){if(!B.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],r[u])}function o(u){if(!B.isUndefined(r[u]))return i(void 0,r[u])}function s(u){if(B.isUndefined(r[u])){if(!B.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,r[u])}function l(u){if(u in r)return i(e[u],r[u]);if(u in e)return i(void 0,e[u])}var f={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:l};return B.forEach(Object.keys(e).concat(Object.keys(r)),function(d){var c=f[d]||a,h=c(d);B.isUndefined(h)&&c!==l||(n[d]=h)}),n},zt={version:"0.27.2"},Qn=zt.version,Y=ne,lt={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){lt[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var Vt={};lt.transitional=function(e,r,n){function i(a,o){return"[Axios v"+Qn+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return function(a,o,s){if(e===!1)throw new Y(i(o," has been removed"+(r?" in "+r:"")),Y.ERR_DEPRECATED);return r&&!Vt[o]&&(Vt[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(a,o,s):!0}};function Zn(t,e,r){if(typeof t!="object")throw new Y("options must be an object",Y.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),i=n.length;i-- >0;){var a=n[i],o=e[a];if(o){var s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new Y("option "+a+" must be "+l,Y.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Y("Unknown option "+a,Y.ERR_BAD_OPTION)}}var ei={assertOptions:Zn,validators:lt},Wt=L,ti=Nt,Gt=pn,Xt=Kn,Ce=Jt,ri=Lt,Yt=ei,ie=Yt.validators;function ae(t){this.defaults=t,this.interceptors={request:new Gt,response:new Gt}}ae.prototype.request=function(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=Ce(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&Yt.assertOptions(n,{silentJSONParsing:ie.transitional(ie.boolean),forcedJSONParsing:ie.transitional(ie.boolean),clarifyTimeoutError:ie.transitional(ie.boolean)},!1);var i=[],a=!0;this.interceptors.request.forEach(function(h){typeof h.runWhen=="function"&&h.runWhen(r)===!1||(a=a&&h.synchronous,i.unshift(h.fulfilled,h.rejected))});var o=[];this.interceptors.response.forEach(function(h){o.push(h.fulfilled,h.rejected)});var s;if(!a){var l=[Xt,void 0];for(Array.prototype.unshift.apply(l,i),l=l.concat(o),s=Promise.resolve(r);l.length;)s=s.then(l.shift(),l.shift());return s}for(var f=r;i.length;){var u=i.shift(),d=i.shift();try{f=u(f)}catch(c){d(c);break}}try{s=Xt(f)}catch(c){return Promise.reject(c)}for(;o.length;)s=s.then(o.shift(),o.shift());return s},ae.prototype.getUri=function(e){e=Ce(this.defaults,e);var r=ri(e.baseURL,e.url);return ti(r,e.params,e.paramsSerializer)},Wt.forEach(["delete","get","head","options"],function(e){ae.prototype[e]=function(r,n){return this.request(Ce(n||{},{method:e,url:r,data:(n||{}).data}))}}),Wt.forEach(["post","put","patch"],function(e){function r(n){return function(a,o,s){return this.request(Ce(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}ae.prototype[e]=r(),ae.prototype[e+"Form"]=r(!0)});var ni=ae,ii=De;function oe(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(i){e=i});var r=this;this.promise.then(function(n){if(!!r._listeners){var i,a=r._listeners.length;for(i=0;i<a;i++)r._listeners[i](n);r._listeners=null}}),this.promise.then=function(n){var i,a=new Promise(function(o){r.subscribe(o),i=o}).then(n);return a.cancel=function(){r.unsubscribe(i)},a},t(function(i){r.reason||(r.reason=new ii(i),e(r.reason))})}oe.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},oe.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]},oe.prototype.unsubscribe=function(e){if(!!this._listeners){var r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}},oe.source=function(){var e,r=new oe(function(i){e=i});return{token:r,cancel:e}};var ai=oe,oi=function(e){return function(n){return e.apply(null,n)}},si=L,ui=function(e){return si.isObject(e)&&e.isAxiosError===!0},Kt=L,li=k,_e=ni,fi=Jt,ci=ot;function Qt(t){var e=new _e(t),r=li(_e.prototype.request,e);return Kt.extend(r,_e.prototype,e),Kt.extend(r,e),r.create=function(i){return Qt(fi(t,i))},r}var F=Qt(ci);F.Axios=_e,F.CanceledError=De,F.CancelToken=ai,F.isCancel=Ht,F.VERSION=zt.version,F.toFormData=jt,F.AxiosError=ne,F.Cancel=F.CanceledError,F.all=function(e){return Promise.all(e)},F.spread=oi,F.isAxiosError=ui,D.exports=F,D.exports.default=F;var Zt=D.exports;class er{constructor({url:e}){this.url=e,this.httpClient=Zt.create({baseURL:this.url})}async upload(e){const{formData:r}=e;try{return{fileMetadata:(await this.httpClient.post("/files",r,{headers:Ae(G(G({},this.generateUploadHeaders(e)),this.generateAuthHeaders()),{"Content-Type":"multipart/form-data"})})).data,error:null}}catch(n){return{fileMetadata:null,error:n}}}async getPresignedUrl(e){try{const{fileId:r}=e;return{presignedUrl:(await this.httpClient.get(`/files/${r}/presignedurl`,{headers:G({},this.generateAuthHeaders())})).data,error:null}}catch(r){return{presignedUrl:null,error:r}}}async delete(e){try{const{fileId:r}=e;return await this.httpClient.delete(`/files/${r}`,{headers:G({},this.generateAuthHeaders())}),{error:null}}catch(r){return{error:r}}}setAccessToken(e){return this.accessToken=e,this}setAdminSecret(e){return this.adminSecret=e,this}generateUploadHeaders(e){const{bucketId:r,name:n,id:i}=e,a={};return r&&(a["x-nhost-bucket-id"]=r),i&&(a["x-nhost-file-id"]=i),n&&(a["x-nhost-file-name"]=n),a}generateAuthHeaders(){return!this.adminSecret&&!this.accessToken?null:this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:{Authorization:`Bearer ${this.accessToken}`}}}var di=typeof self=="object"?self.FormData:window.FormData;class hi{constructor({url:e,adminSecret:r}){this.url=e,this.api=new er({url:e}),this.setAdminSecret(r)}async upload(e){let r;"file"in e?(r=new di,r.append("file",e.file)):r=e.formData;const{fileMetadata:n,error:i}=await this.api.upload(Ae(G({},e),{formData:r}));return i?{fileMetadata:null,error:i}:n?{fileMetadata:n,error:null}:{fileMetadata:null,error:new Error("Invalid file returned")}}getUrl(e){return this.getPublicUrl(e)}getPublicUrl(e){const{fileId:r}=e;return`${this.url}/files/${r}`}async getPresignedUrl(e){const{presignedUrl:r,error:n}=await this.api.getPresignedUrl(e);return n?{presignedUrl:null,error:n}:r?{presignedUrl:r,error:null}:{presignedUrl:null,error:new Error("Invalid file id")}}async delete(e){const{error:r}=await this.api.delete(e);return r?{error:r}:{error:null}}setAccessToken(e){return this.api.setAccessToken(e),this}setAdminSecret(e){return this.api.setAdminSecret(e),this}}/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var v=function(){return v=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},v.apply(this,arguments)};function ft(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function U(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,a=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a}function C(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,a;n<i;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return t.concat(a||Array.prototype.slice.call(e))}var b;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(b||(b={}));var se;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(se||(se={}));var ct=b.Start,dt=b.Stop,ge=b.Raise,je=b.Send,tr=b.Cancel,rr=b.NullEvent,Le=b.Assign,vi=b.After,pi=b.DoneState,ht=b.Log,nr=b.Init,$e=b.Invoke,yi=b.ErrorExecution,mi=b.ErrorPlatform,ir=b.ErrorCustom,vt=b.Update,ar=b.Choose,or=b.Pure,gi=Object.freeze(Object.defineProperty({__proto__:null,after:vi,assign:Le,cancel:tr,choose:ar,doneState:pi,error:ir,errorExecution:yi,errorPlatform:mi,init:nr,invoke:$e,log:ht,nullEvent:rr,pure:or,raise:ge,send:je,start:ct,stop:dt,update:vt},Symbol.toStringTag,{value:"Module"})),sr=".",ur={},pt="xstate.guard",Ei="",Si=!0,Ie;function yt(t,e,r){r===void 0&&(r=sr);var n=Ee(t,r),i=Ee(e,r);return w(i)?w(n)?i===n:!1:w(n)?n in i:Object.keys(n).every(function(a){return a in i?yt(n[a],i[a]):!1})}function lr(t){try{return w(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function mt(t,e){try{return we(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function wi(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function Ee(t,e){if(wi(t))return t.value;if(we(t))return Fe(t);if(typeof t!="string")return t;var r=mt(t,e);return Fe(r)}function Fe(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function Se(t,e){for(var r={},n=Object.keys(t),i=0;i<n.length;i++){var a=n[i];r[a]=e(t[a],a,t,i)}return r}function fr(t,e,r){var n,i,a={};try{for(var o=U(Object.keys(t)),s=o.next();!s.done;s=o.next()){var l=s.value,f=t[l];!r(f)||(a[l]=e(f,l,t))}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}var bi=function(t){return function(e){var r,n,i=e;try{for(var a=U(t),o=a.next();!o.done;o=a.next()){var s=o.value;i=i[s]}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i}};function xi(t,e){return function(r){var n,i,a=r;try{for(var o=U(t),s=o.next();!s.done;s=o.next()){var l=s.value;a=a[e][l]}}catch(f){n={error:f}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}}function ke(t){if(!t)return[[]];if(w(t))return[[t]];var e=A(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:ke(t[r]).map(function(i){return[r].concat(i)})}));return e}function A(t){var e;return(e=[]).concat.apply(e,C([],O(t),!1))}function cr(t){return we(t)?t:[t]}function z(t){return t===void 0?[]:cr(t)}function dr(t,e,r){var n,i;if(N(t))return t(e,r.data);var a={};try{for(var o=U(Object.keys(t)),s=o.next();!s.done;s=o.next()){var l=s.value,f=t[l];N(f)?a[l]=f(e,r.data):a[l]=f}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}function Oi(t){return/^(done|error)\./.test(t)}function hr(t,e){var r,n,i=O([[],[]],2),a=i[0],o=i[1];try{for(var s=U(t),l=s.next();!l.done;l=s.next()){var f=l.value;e(f)?a.push(f):o.push(f)}}catch(u){r={error:u}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return[a,o]}function vr(t,e){return Se(t.states,function(r,n){if(!!r){var i=(w(e)?void 0:e[n])||(r?r.current:void 0);if(!!i)return{current:i,states:vr(r,i)}}})}function Ai(t,e){return{current:e,states:vr(t,e)}}function pr(t,e,r,n){var i=t&&r.reduce(function(a,o){var s,l,f=o.assignment,u={state:n,action:o,_event:e},d={};if(N(f))d=f(a,e.data,u);else try{for(var c=U(Object.keys(f)),h=c.next();!h.done;h=c.next()){var g=h.value,y=f[g];d[g]=N(y)?y(a,e.data,u):y}}catch(m){s={error:m}}finally{try{h&&!h.done&&(l=c.return)&&l.call(c)}finally{if(s)throw s.error}}return Object.assign({},a,d)},t);return i}var yr=function(){};function we(t){return Array.isArray(t)}function N(t){return typeof t=="function"}function w(t){return typeof t=="string"}function mr(t,e){if(!!t)return w(t)?{type:pt,name:t,predicate:e?e[t]:void 0}:N(t)?{type:pt,name:t.name,predicate:t}:t}var gr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Ie={},Ie[gr]=function(){return this},Ie[Symbol.observable]=function(){return this};function ue(t){return!!t&&"__xstatenode"in t}var Ri=function(){var t=0;return function(){return t++,t.toString(16)}}();function Er(t,e){return w(t)||typeof t=="number"?v({type:t},e):t}function be(t,e){if(!w(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=Er(t);return v({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function le(t,e){var r=cr(e).map(function(n){return typeof n=="undefined"||typeof n=="string"||ue(n)?{target:n,event:t}:v(v({},n),{event:t})});return r}function Pi(t){if(!(t===void 0||t===Ei))return z(t)}function Sr(t,e,r,n,i){var a=t.options.guards,o={state:i,cond:e,_event:n};if(e.type===pt)return((a==null?void 0:a[e.name])||e.predicate)(r,n.data,o);var s=a==null?void 0:a[e.type];if(!s)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return s(r,n.data,o)}function Ti(t){return typeof t=="string"?{type:t}:t}function Be(t,e){return"".concat(t,":invocation[").concat(e,"]")}var Me=be({type:nr});function gt(t,e){return e&&e[t]||void 0}function fe(t,e){var r;if(w(t)||typeof t=="number"){var n=gt(t,e);N(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(N(t))r={type:t.name||t.toString(),exec:t};else{var n=gt(t.type,e);if(N(n))r=v(v({},t),{exec:n});else if(n){var i=n.type||t.type;r=v(v(v({},n),t),{type:i})}else r=t}return r}var xe=function(t,e){if(!t)return[];var r=we(t)?t:[t];return r.map(function(n){return fe(n,e)})};function He(t){var e=fe(t);return v(v({id:w(t)?t:e.id},e),{type:e.type})}function wr(t){return w(t)?{type:ge,event:t}:K(t,{to:se.Internal})}function br(t){return{type:ge,_event:be(t.event)}}function K(t,e){return{to:e?e.to:void 0,type:je,event:N(t)?t:Er(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:N(t)?t.name:lr(t)}}function xr(t,e,r,n){var i={_event:r},a=be(N(t.event)?t.event(e,r.data,i):t.event),o;if(w(t.delay)){var s=n&&n[t.delay];o=N(s)?s(e,r.data,i):s}else o=N(t.delay)?t.delay(e,r.data,i):t.delay;var l=N(t.to)?t.to(e,r.data,i):t.to;return v(v({},t),{to:l,_event:a,event:a.data,delay:o})}function Et(t,e){return K(t,v(v({},e),{to:se.Parent}))}function Ni(t,e,r){return K(e,v(v({},r),{to:t}))}function Di(){return Et(vt)}function Ui(t,e){return K(t,v(v({},e),{to:function(r,n,i){var a=i._event;return a.origin}}))}var Ci=function(t,e){return{context:t,event:e}};function _i(t,e){return t===void 0&&(t=Ci),{type:ht,label:e,expr:t}}var Or=function(t,e,r){return v(v({},t),{value:w(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},Ar=function(t){return{type:tr,sendId:t}};function Rr(t){var e=He(t);return{type:b.Start,activity:e,exec:void 0}}function Pr(t){var e=N(t)?t:He(t);return{type:b.Stop,activity:e,exec:void 0}}function Tr(t,e,r){var n=N(t.activity)?t.activity(e,r.data):t.activity,i=typeof n=="string"?{id:n}:n,a={type:b.Stop,activity:i};return a}var Nr=function(t){return{type:Le,assignment:t}};function ji(t){return typeof t=="object"&&"type"in t}function Dr(t,e){var r=e?"#".concat(e):"";return"".concat(b.After,"(").concat(t,")").concat(r)}function Oe(t,e){var r="".concat(b.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Ur(t,e){var r="".concat(b.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Cr(t,e){var r="".concat(b.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Li(t){return{type:b.Pure,get:t}}function $i(t,e){return K(function(r,n){return n},v(v({},e),{to:t}))}function Ii(t,e){return Et(function(r,n,i){return{type:ir,data:N(t)?t(r,n,i):t}},v(v({},e),{to:se.Parent}))}function Fi(t){return{type:b.Choose,conds:t}}function qe(t,e,r,n,i,a){a===void 0&&(a=!1);var o=O(a?[[],i]:hr(i,function(c){return c.type===Le}),2),s=o[0],l=o[1],f=s.length?pr(r,n,s,e):r,u=a?[r]:void 0,d=A(l.map(function(c){var h;switch(c.type){case ge:return br(c);case je:var g=xr(c,f,n,t.options.delays);return g;case ht:return Or(c,f,n);case ar:{var y=c,m=(h=y.conds.find(function(_){var q=mr(_.cond,t.options.guards);return!q||Sr(t,q,f,n,e)}))===null||h===void 0?void 0:h.actions;if(!m)return[];var x=O(qe(t,e,f,n,xe(z(m),t.options.actions),a),2),p=x[0],E=x[1];return f=E,u==null||u.push(f),p}case or:{var m=c.get(f,n.data);if(!m)return[];var $=O(qe(t,e,f,n,xe(z(m),t.options.actions),a),2),R=$[0],V=$[1];return f=V,u==null||u.push(f),R}case dt:return Tr(c,f,n);case Le:{f=pr(f,n,[c],e),u==null||u.push(f);break}default:var S=fe(c,t.options.actions),P=S.exec;if(P&&u){var I=u.length-1;S=v(v({},S),{exec:function(_){for(var q=[],ee=1;ee<arguments.length;ee++)q[ee-1]=arguments[ee];P.apply(void 0,C([u[I]],O(q),!1))}})}return S}}).filter(function(c){return!!c}));return[d,f]}var ki=Object.freeze(Object.defineProperty({__proto__:null,actionTypes:gi,after:Dr,assign:Nr,cancel:Ar,choose:Fi,done:Oe,doneInvoke:Ur,error:Cr,escalate:Ii,forwardTo:$i,getActionFunction:gt,initEvent:Me,isActionObject:ji,log:_i,pure:Li,raise:wr,resolveActions:qe,resolveLog:Or,resolveRaise:br,resolveSend:xr,resolveStop:Tr,respond:Ui,send:K,sendParent:Et,sendTo:Ni,sendUpdate:Di,start:Rr,stop:Pr,toActionObject:fe,toActionObjects:xe,toActivityDefinition:He},Symbol.toStringTag,{value:"Module"})),Je=[],Bi=function(t,e){Je.push(t);var r=e(t);return Je.pop(),r},Mi=function(t){return t(Je[Je.length-1])};function _r(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[gr]=function(){return this},e}function Hi(t,e,r,n){var i,a=Ti(t.src),o=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[a.type],s=t.data?dr(t.data,r,n):void 0,l=o?jr(o,t.id,s):_r(t.id);return l.meta=t,l}function jr(t,e,r){var n=_r(e);if(n.deferred=!0,ue(t)){var i=n.state=Bi(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return i}}return n}var ze=function(t){return t.type==="atomic"||t.type==="final"};function ce(t){return Object.keys(t.states).map(function(e){return t.states[e]}).filter(function(e){return e.type!=="history"})}function Lr(t){var e=[t];return ze(t)?e:e.concat(A(ce(t).map(Lr)))}function de(t,e){var r,n,i,a,o,s,l,f,u=new Set(t),d=St(u),c=new Set(e);try{for(var h=U(c),g=h.next();!g.done;g=h.next())for(var y=g.value,m=y.parent;m&&!c.has(m);)c.add(m),m=m.parent}catch(I){r={error:I}}finally{try{g&&!g.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}var x=St(c);try{for(var p=U(c),E=p.next();!E.done;E=p.next()){var y=E.value;if(y.type==="compound"&&(!x.get(y)||!x.get(y).length))d.get(y)?d.get(y).forEach(function(_){return c.add(_)}):y.initialStateNodes.forEach(function(_){return c.add(_)});else if(y.type==="parallel")try{for(var $=(o=void 0,U(ce(y))),R=$.next();!R.done;R=$.next()){var V=R.value;c.has(V)||(c.add(V),d.get(V)?d.get(V).forEach(function(_){return c.add(_)}):V.initialStateNodes.forEach(function(_){return c.add(_)}))}}catch(_){o={error:_}}finally{try{R&&!R.done&&(s=$.return)&&s.call($)}finally{if(o)throw o.error}}}}catch(I){i={error:I}}finally{try{E&&!E.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}try{for(var S=U(c),P=S.next();!P.done;P=S.next())for(var y=P.value,m=y.parent;m&&!c.has(m);)c.add(m),m=m.parent}catch(I){l={error:I}}finally{try{P&&!P.done&&(f=S.return)&&f.call(S)}finally{if(l)throw l.error}}return c}function $r(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(ze(n))return n.key}else return{}}var i={};return r.forEach(function(a){i[a.key]=$r(a,e)}),i}function St(t){var e,r,n=new Map;try{for(var i=U(t),a=i.next();!a.done;a=i.next()){var o=a.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(s){e={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}function qi(t,e){var r=de([t],e);return $r(t,St(r))}function Ve(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function Ji(t){return C([],O(new Set(A(C([],O(t.map(function(e){return e.ownEvents})),!1)))),!1)}function We(t,e){return e.type==="compound"?ce(e).some(function(r){return r.type==="final"&&Ve(t,r)}):e.type==="parallel"?ce(e).every(function(r){return We(t,r)}):!1}function zi(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function Ir(t){return new Set(A(t.map(function(e){return e.tags})))}function Fr(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(w(t)||w(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(i){return Fr(t[i],e[i])})}var Q=function(){function t(e){var r=this,n;this.actions=[],this.activities=ur,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||ur,this.meta=zi(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Ji(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=Me;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=Me;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),w(e))return[e];var i=Object.keys(e);return i.concat.apply(i,C([],O(i.map(function(a){return n.toStrings(e[a],r).map(function(o){return a+r+o})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=ft(e,["configuration","transitions","tags","machine"]);return v(v({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return yt(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;yr(!!this.machine);var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),kr={sync:!1,autoForward:!1},Br;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(Br||(Br={}));var Vi=function(t){return w(t)?v(v({},kr),{name:t}):v(v(v({},kr),{name:Ri()}),t)};function Wi(t,e){var r=Vi(e);return Mi(function(n){if(!Si){var i=ue(t)||N(t);yr(!!n||i,'Attempted to spawn an Actor (ID: "'.concat(ue(t)?t.id:"undefined",'") outside of a service. This will have no effect.'))}return n?n.spawn(t,r.name,r):jr(t,r.name)})}function Gi(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function Ge(t){return v(v({type:$e},t),{toJSON:function(){t.onDone,t.onError;var e=ft(t,["onDone","onError"]);return v(v({},e),{type:$e,src:Gi(t.src)})}})}var Xe="",wt="#",bt="*",he={},ve=function(t){return t[0]===wt},Xi=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Yi=function(){function t(e,r,n,i){var a=this;n===void 0&&(n="context"in e?e.context:void 0);var o;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Xi(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:sr),this.id=this.config.id||C([this.machine.key],O(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?Se(this.config.states,function(f,u){var d,c=new t(f,{},void 0,{parent:a,key:u});return Object.assign(a.idMap,v((d={},d[c.id]=c,d),c.idMap)),c}):he;var s=0;function l(f){var u,d;f.order=s++;try{for(var c=U(ce(f)),h=c.next();!h.done;h=c.next()){var g=h.value;l(g)}}catch(y){u={error:y}}finally{try{h&&!h.done&&(d=c.return)&&d.call(c)}finally{if(u)throw u.error}}}l(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(f){var u=f.event;return u===Xe}):Xe in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=z(this.config.entry||this.config.onEntry).map(function(f){return fe(f)}),this.onExit=z(this.config.exit||this.config.onExit).map(function(f){return fe(f)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=z(this.config.invoke).map(function(f,u){var d,c;if(ue(f)){var h=Be(a.id,u);return a.machine.options.services=v((d={},d[h]=f,d),a.machine.options.services),Ge({src:h,id:h})}else if(w(f.src)){var h=f.id||Be(a.id,u);return Ge(v(v({},f),{id:h,src:f.src}))}else if(ue(f.src)||N(f.src)){var h=f.id||Be(a.id,u);return a.machine.options.services=v((c={},c[h]=f.src,c),a.machine.options.services),Ge(v(v({id:h},f),{src:h}))}else{var g=f.src;return Ge(v(v({id:Be(a.id,u)},f),{src:g}))}}),this.activities=z(this.config.activities).concat(this.invoke).map(function(f){return He(f)}),this.transition=this.transition.bind(this),this.tags=z(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||Lr(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,i=n.actions,a=n.activities,o=n.guards,s=n.services,l=n.delays;return new t(this.config,{actions:v(v({},i),e.actions),activities:v(v({},a),e.activities),guards:v(v({},o),e.guards),services:v(v({},s),e.services),delays:v(v({},l),e.delays)},r!=null?r:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return N(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Se(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===Xe,n=this.transitions.filter(function(i){var a=i.eventType===e;return r?a:a||i.eventType===bt});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(a,o){var s=N(a)?"".concat(e.id,":delay[").concat(o,"]"):a,l=Dr(s,e.id);return e.onEntry.push(K(l,{delay:a})),e.onExit.push(Ar(l)),l},i=we(r)?r.map(function(a,o){var s=n(a.delay,o);return v(v({},a),{event:s})}):A(Object.keys(r).map(function(a,o){var s=r[a],l=w(s)?{target:s}:s,f=isNaN(+a)?a:+a,u=n(f,o);return z(l).map(function(d){return v(v({},d),{event:u,delay:f})})}));return i.map(function(a){var o=a.delay;return v(v({},e.formatTransition(a)),{delay:o})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var i=e instanceof Q?e.value:Ee(e,this.delimiter);if(w(i)){var a=this.getStateNode(i).initial;return a!==void 0?this.getStateNodes((r={},r[i]=a,r)):[this,this.states[i]]}var o=Object.keys(i),s=[this];return s.push.apply(s,C([],O(A(o.map(function(l){return n.getStateNode(l).getStateNodes(i[l])}))),!1)),s},t.prototype.handles=function(e){var r=lr(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof Q?e:Q.create(e),n=Array.from(de([],this.getStateNodes(r.value)));return new Q(v(v({},r),{value:this.resolve(r.value),configuration:n,done:We(n,this),tags:Ir(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var i=this.getStateNode(e),a=i.next(r,n);return!a||!a.transitions.length?this.next(r,n):a},t.prototype.transitionCompoundNode=function(e,r,n){var i=Object.keys(e),a=this.getStateNode(i[0]),o=a._transition(e[i[0]],r,n);return!o||!o.transitions.length?this.next(r,n):o},t.prototype.transitionParallelNode=function(e,r,n){var i,a,o={};try{for(var s=U(Object.keys(e)),l=s.next();!l.done;l=s.next()){var f=l.value,u=e[f];if(!!u){var d=this.getStateNode(f),c=d._transition(u,r,n);c&&(o[f]=c)}}}catch(p){i={error:p}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}var h=Object.keys(o).map(function(p){return o[p]}),g=A(h.map(function(p){return p.transitions})),y=h.some(function(p){return p.transitions.length>0});if(!y)return this.next(r,n);var m=A(h.map(function(p){return p.entrySet})),x=A(Object.keys(o).map(function(p){return o[p].configuration}));return{transitions:g,entrySet:m,exitSet:A(h.map(function(p){return p.exitSet})),configuration:x,source:r,actions:A(Object.keys(o).map(function(p){return o[p].actions}))}},t.prototype._transition=function(e,r,n){return w(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,be(r))},t.prototype.next=function(e,r){var n,i,a=this,o=r.name,s=[],l=[],f;try{for(var u=U(this.getCandidates(o)),d=u.next();!d.done;d=u.next()){var c=d.value,h=c.cond,g=c.in,y=e.context,m=g?w(g)&&ve(g)?e.matches(Ee(this.getStateNodeById(g).path,this.delimiter)):yt(Ee(g,this.delimiter),bi(this.path.slice(0,-2))(e.value)):!0,x=!1;try{x=!h||Sr(this.machine,h,y,r,e)}catch(R){throw new Error("Unable to evaluate guard '".concat(h.name||h.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(R.message))}if(x&&m){c.target!==void 0&&(l=c.target),s.push.apply(s,C([],O(c.actions),!1)),f=c;break}}}catch(R){n={error:R}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(!!f){if(!l.length)return{transitions:[f],entrySet:[],exitSet:[],configuration:e.value?[this]:[],source:e,actions:s};var p=A(l.map(function(R){return a.getRelativeStateNodes(R,e.historyValue)})),E=!!f.internal,$=E?[]:A(p.map(function(R){return a.nodesFromChild(R)}));return{transitions:[f],entrySet:$,exitSet:E?[]:[this],configuration:p,source:e,actions:s}}},t.prototype.nodesFromChild=function(e){if(e.escapes(this))return[];for(var r=[],n=e;n&&n!==this;)r.push(n),n=n.parent;return r.push(this),r},t.prototype.escapes=function(e){if(this===e)return!1;for(var r=this.parent;r;){if(r===e)return!1;r=r.parent}return!0},t.prototype.getActions=function(e,r,n,i){var a,o,s,l,f=de([],i?this.getStateNodes(i.value):[this]),u=e.configuration.length?de(f,e.configuration):f;try{for(var d=U(u),c=d.next();!c.done;c=d.next()){var h=c.value;Ve(f,h)||e.entrySet.push(h)}}catch(S){a={error:S}}finally{try{c&&!c.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}try{for(var g=U(f),y=g.next();!y.done;y=g.next()){var h=y.value;(!Ve(u,h)||Ve(e.exitSet,h.parent))&&e.exitSet.push(h)}}catch(S){s={error:S}}finally{try{y&&!y.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}var m=A(e.entrySet.map(function(S){var P=[];if(S.type!=="final")return P;var I=S.parent;if(!I.parent)return P;P.push(Oe(S.id,S.doneData),Oe(I.id,S.doneData?dr(S.doneData,r,n):void 0));var _=I.parent;return _.type==="parallel"&&ce(_).every(function(q){return We(e.configuration,q)})&&P.push(Oe(_.id)),P}));e.exitSet.sort(function(S,P){return P.order-S.order}),e.entrySet.sort(function(S,P){return S.order-P.order});var x=new Set(e.entrySet),p=new Set(e.exitSet),E=O([A(Array.from(x).map(function(S){return C(C([],O(S.activities.map(function(P){return Rr(P)})),!1),O(S.onEntry),!1)})).concat(m.map(wr)),A(Array.from(p).map(function(S){return C(C([],O(S.onExit),!1),O(S.activities.map(function(P){return Pr(P)})),!1)}))],2),$=E[0],R=E[1],V=xe(R.concat(e.actions).concat($),this.machine.options.actions);return V},t.prototype.transition=function(e,r,n){e===void 0&&(e=this.initialState);var i=be(r),a;if(e instanceof Q)a=n===void 0?e:this.resolveState(Q.from(e,n));else{var o=w(e)?this.resolve(Fe(this.getResolvedPath(e))):this.resolve(e),s=n!=null?n:this.machine.context;a=this.resolveState(Q.from(o,s))}if(this.strict&&!this.events.includes(i.name)&&!Oi(i.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(i.name,"'"));var l=this._transition(a.value,a,i)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:a,actions:[]},f=de([],this.getStateNodes(a.value)),u=l.configuration.length?de(f,l.configuration):f;return l.configuration=C([],O(u),!1),this.resolveTransition(l,a,a.context,i)},t.prototype.resolveRaisedTransition=function(e,r,n){var i,a=e.actions;return e=this.transition(e,r),e._event=n,e.event=n.data,(i=e.actions).unshift.apply(i,C([],O(a),!1)),e},t.prototype.resolveTransition=function(e,r,n,i){var a,o,s=this;i===void 0&&(i=Me);var l=e.configuration,f=!r||e.transitions.length>0,u=f?qi(this.machine,l):void 0,d=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,c=this.getActions(e,n,i,r),h=r?v({},r.activities):{};try{for(var g=U(c),y=g.next();!y.done;y=g.next()){var m=y.value;m.type===ct?h[m.activity.id||m.activity.type]=m:m.type===dt&&(h[m.activity.id||m.activity.type]=!1)}}catch(H){a={error:H}}finally{try{y&&!y.done&&(o=g.return)&&o.call(g)}finally{if(a)throw a.error}}var x=O(qe(this,r,n,i,c,this.machine.config.preserveActionOrder),2),p=x[0],E=x[1],$=O(hr(p,function(H){return H.type===ge||H.type===je&&H.to===se.Internal}),2),R=$[0],V=$[1],S=p.filter(function(H){var ye;return H.type===ct&&((ye=H.activity)===null||ye===void 0?void 0:ye.type)===$e}),P=S.reduce(function(H,ye){return H[ye.activity.id]=Hi(ye.activity,s.machine,E,i),H},r?v({},r.children):{}),I=f?e.configuration:r?r.configuration:[],_=We(I,this),q=new Q({value:u||r.value,context:E,_event:i,_sessionid:r?r._sessionid:null,historyValue:u?d?Ai(d,u):void 0:r?r.historyValue:void 0,history:!u||e.source?r:void 0,actions:u?V:[],activities:u?h:r?r.activities:{},events:[],configuration:I,transitions:e.transitions,children:P,done:_,tags:Ir(I),machine:this}),ee=n!==E;q.changed=i.name===vt||ee;var pe=q.history;pe&&delete pe.history;var qr=!_&&(this._transient||l.some(function(H){return H._transient}));if(!f&&(!qr||i.name===Xe))return q;var W=q;if(!_)for(qr&&(W=this.resolveRaisedTransition(W,{type:rr},i));R.length;){var ea=R.shift();W=this.resolveRaisedTransition(W,ea._event,i)}var ta=W.changed||(pe?!!W.actions.length||ee||typeof pe.value!=typeof W.value||!Fr(W.value,pe.value):void 0);return W.changed=ta,W.history=pe,W},t.prototype.getStateNode=function(e){if(ve(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=ve(e)?e.slice(wt.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&ve(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=mt(e,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||he;switch(this.type){case"parallel":return Se(this.initialStateValue,function(a,o){return a?n.getStateNode(o).resolve(e[o]||a):he});case"compound":if(w(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(r={},r[e]=i.initialStateValue,r):e}return Object.keys(e).length?Se(e,function(a,o){return a?n.getStateNode(o).resolve(a):he}):this.initialStateValue||{};default:return e||he}},t.prototype.getResolvedPath=function(e){if(ve(e)){var r=this.machine.idMap[e.slice(wt.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return mt(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=fr(this.states,function(n){return n.initialStateValue||he},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=ze(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,entrySet:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;w(r.target)?e=ve(r.target)?Fe(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(ze(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var r=ke(this.initialStateValue);return A(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=O(e),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var a=this.getStateNode(n);if(a.type==="history")return a.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(!!Object.keys(this.states).length)return{current:e||this.initialStateValue,states:fr(this.states,function(r,n){if(!e)return r.historyValue();var i=w(e)?void 0:e[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?A(ke(i).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var a=xi(n.path,"states")(e).current;return w(a)?[n.getStateNode(a)]:A(ke(a).map(function(o){return r.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=A(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,i;if(this.__cache.events)return this.__cache.events;var a=this.states,o=new Set(this.ownEvents);if(a)try{for(var s=U(Object.keys(a)),l=s.next();!l.done;l=s.next()){var f=l.value,u=a[f];if(u.states)try{for(var d=(n=void 0,U(u.events)),c=d.next();!c.done;c=d.next()){var h=c.value;o.add("".concat(h))}}catch(g){n={error:g}}finally{try{c&&!c.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}}catch(g){e={error:g}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!w(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var a=i?r.key+n:n;if(r.parent)try{var o=r.parent.getStateNodeByPath(a);return o}catch(s){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(s.message))}else return r.getStateNodeByPath(a)})},t.prototype.formatTransition=function(e){var r=this,n=Pi(e.target),i="internal"in e?e.internal:n?n.some(function(l){return w(l)&&l[0]===r.delimiter}):!0,a=this.machine.options.guards,o=this.resolveTarget(n),s=v(v({},e),{actions:xe(z(e.actions)),cond:mr(e.cond,a),target:o,source:this,internal:i,eventType:e.event,toJSON:function(){return v(v({},s),{target:s.target?s.target.map(function(l){return"#".concat(l.id)}):void 0,source:"#".concat(r.id)})}});return s},t.prototype.formatTransitions=function(){var e,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var a=this.config.on,o=bt,s=a[o],l=s===void 0?[]:s,f=ft(a,[typeof o=="symbol"?o:o+""]);i=A(Object.keys(f).map(function(p){var E=le(p,f[p]);return E}).concat(le(bt,l)))}var u=this.config.always?le("",this.config.always):[],d=this.config.onDone?le(String(Oe(this.id)),this.config.onDone):[],c=A(this.invoke.map(function(p){var E=[];return p.onDone&&E.push.apply(E,C([],O(le(String(Ur(p.id)),p.onDone)),!1)),p.onError&&E.push.apply(E,C([],O(le(String(Cr(p.id)),p.onError)),!1)),E})),h=this.after,g=A(C(C(C(C([],O(d),!1),O(c),!1),O(i),!1),O(u),!1).map(function(p){return z(p).map(function(E){return n.formatTransition(E)})}));try{for(var y=U(h),m=y.next();!m.done;m=y.next()){var x=m.value;g.push(x)}}catch(p){e={error:p}}finally{try{m&&!m.done&&(r=y.return)&&r.call(y)}finally{if(e)throw e.error}}return g},t}();function Mr(t,e){return new Yi(t,e)}var M=Nr,xt=K;const Ot={progress:null,loaded:0,error:null},Hr=()=>Mr({preserveActionOrder:!0,schema:{context:{},events:{}},tsTypes:{},context:G({},Ot),initial:"idle",on:{DESTROY:{actions:"sendDestroy",target:"stopped"}},states:{idle:{on:{ADD:{actions:"addFile"},UPLOAD:{cond:"hasFile",target:"uploading"}}},uploading:{entry:"resetProgress",on:{UPLOAD_PROGRESS:{actions:["incrementProgress","sendProgress"]},UPLOAD_DONE:"uploaded",UPLOAD_ERROR:"error",CANCEL:"idle"},invoke:{src:"uploadFile"}},uploaded:{entry:["setFileMetadata","sendDone"]},error:{entry:["setError","sendError"]},stopped:{type:"final"}}},{guards:{hasFile:(t,e)=>!!t.file||!!e.file},actions:{incrementProgress:M({loaded:(t,{loaded:e})=>e,progress:(t,{progress:e})=>e}),setFileMetadata:M({id:(t,{id:e})=>e,bucketId:(t,{bucketId:e})=>e,progress:t=>100}),setError:M({error:(t,{error:e})=>e}),sendProgress:()=>{},sendError:()=>{},sendDestroy:()=>{},sendDone:()=>{},resetProgress:M({progress:t=>null,loaded:t=>0}),addFile:M({file:(t,{file:e})=>e,bucketId:(t,{bucketId:e})=>e,id:(t,{id:e})=>e})},services:{uploadFile:(t,e)=>r=>{const n={"Content-Type":"multipart/form-data"},i=e.id||t.id;i&&(n["x-nhost-file-id"]=i);const a=e.bucketId||t.bucketId;a&&(n["x-nhost-bucket-id"]=a);const o=e.file||t.file;n["x-nhost-file-name"]=e.name||o.name;const s=new FormData;s.append("file",o),e.adminSecret&&(n["x-hasura-admin-secret"]=e.adminSecret),e.accessToken&&(n.Authorization=`Bearer ${e.accessToken}`);let l=0;const f=new AbortController;return Zt.post(e.url+"/files",s,{headers:n,signal:f.signal,onUploadProgress:u=>{const d=Math.round(u.loaded*o.size/u.total),c=d-l;l=d,r({type:"UPLOAD_PROGRESS",progress:Math.round(d*100/u.total),loaded:d,additions:c})}}).then(({data:{id:u,bucketId:d}})=>{r({type:"UPLOAD_DONE",id:u,bucketId:d})}).catch(({response:u,message:d})=>{var c,h,g,y,m;r({type:"UPLOAD_ERROR",error:{status:(c=u==null?void 0:u.status)!=null?c:0,message:((g=(h=u==null?void 0:u.data)==null?void 0:h.error)==null?void 0:g.message)||d,error:((m=(y=u==null?void 0:u.data)==null?void 0:y.error)==null?void 0:m.message)||d}})}),()=>{f.abort()}}}}),{pure:At,sendParent:Ye}=ki,Ki=()=>Mr({id:"files-list",schema:{context:{},events:{}},tsTypes:{},context:{progress:null,files:[],loaded:0,total:0},initial:"idle",on:{UPLOAD:{cond:"hasFileToDownload",actions:"addItem",target:"uploading"},ADD:{actions:"addItem"},REMOVE:{actions:"removeItem"}},states:{idle:{entry:["resetProgress","resetLoaded","resetTotal"],on:{CLEAR:{actions:"clearList",target:"idle"}}},uploading:{entry:["upload","startProgress","resetLoaded","resetTotal"],on:{UPLOAD_PROGRESS:{actions:["incrementProgress"]},UPLOAD_DONE:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],UPLOAD_ERROR:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],CANCEL:{actions:"cancel",target:"idle"}}},uploaded:{entry:"setUploaded",on:{CLEAR:{actions:"clearList",target:"idle"}}},error:{on:{CLEAR:{actions:"clearList",target:"idle"}}}}},{guards:{hasFileToDownload:(t,e)=>t.files.some(r=>r.getSnapshot().matches("idle"))||!!e.files,isAllUploaded:t=>t.files.every(e=>{var r;return(r=e.getSnapshot())==null?void 0:r.matches("uploaded")}),isAllUploadedOrError:t=>t.files.every(e=>{const r=e.getSnapshot();return(r==null?void 0:r.matches("error"))||(r==null?void 0:r.matches("uploaded"))})},actions:{incrementProgress:M((t,e)=>{const r=t.loaded+e.additions,n=Math.round(r*100/t.total);return Ae(G({},t),{loaded:r,progress:n})}),setUploaded:M({progress:t=>100,loaded:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>e.matches("uploaded")).reduce((e,r)=>{var n;return e+((n=r.context.file)==null?void 0:n.size)},0)}),resetTotal:M({total:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>!e.matches("uploaded")).reduce((e,r)=>{var n;return e+((n=r.context.file)==null?void 0:n.size)},0)}),resetLoaded:M({loaded:t=>0}),startProgress:M({progress:t=>0}),resetProgress:M({progress:t=>null}),addItem:M((t,{files:e,bucketId:r})=>{const n=e?Array.isArray(e)?e:"length"in e?Array.from(e):[e]:[],i=t.total+n.reduce((o,s)=>o+s.size,0),a=Math.round(t.loaded*100/i);return{files:[...t.files,...n.map(o=>Wi(Hr().withConfig({actions:{sendProgress:Ye((s,{additions:l})=>({type:"UPLOAD_PROGRESS",additions:l})),sendDone:Ye("UPLOAD_DONE"),sendError:Ye("UPLOAD_ERROR"),sendDestroy:Ye("REMOVE")}}).withContext(Ae(G({},Ot),{file:o,bucketId:r})),{sync:!0}))],total:i,loaded:t.loaded,progress:a}}),removeItem:M({files:t=>t.files.filter(e=>{var n,i;const r=(n=e.getSnapshot())==null?void 0:n.matches("stopped");return r&&((i=e.stop)==null||i.call(e)),!r})}),clearList:At(t=>t.files.map(e=>xt({type:"DESTROY"},{to:e.id}))),upload:At((t,e)=>t.files.map(r=>xt(e,{to:r.id}))),cancel:At(t=>t.files.map(e=>xt({type:"CANCEL"},{to:e.id})))}}),Qi=async(t,e,r)=>new Promise(n=>{e.send(G({type:"UPLOAD",url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret},r)),e.subscribe(i=>{var a;i.matches("error")?n({error:i.context.error,isError:!0,isUploaded:!1}):i.matches("uploaded")&&n({error:null,isError:!1,isUploaded:!0,id:i.context.id,bucketId:i.context.id,name:(a=i.context.file)==null?void 0:a.name})})}),Zi=async(t,e,r)=>new Promise(n=>{e.send({type:"UPLOAD",url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,bucketId:r==null?void 0:r.bucketId,files:r==null?void 0:r.files}),e.onTransition(i=>{i.matches("error")?n({errors:i.context.files.filter(a=>{var o;return(o=a.getSnapshot())==null?void 0:o.context.error}),isError:!0,files:[]}):i.matches("uploaded")&&n({errors:[],isError:!1,files:i.context.files})})});T.HasuraStorageApi=er,T.HasuraStorageClient=hi,T.INITIAL_FILE_CONTEXT=Ot,T.createFileUploadMachine=Hr,T.createMultipleFilesUploadMachine=Ki,T.uploadFilePromise=Qi,T.uploadMultipleFilesPromise=Zi,Object.defineProperties(T,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=hasura-storage-js.umd.js.map
